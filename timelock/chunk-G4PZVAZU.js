import{e as Z}from"./chunk-7OBPMN2E.js";import{a as X}from"./chunk-EQO7HR7Z.js";import{b as B,c as L,f as W,i as U,j as q,k as H,o as Y,p as J,q as K}from"./chunk-4C6H6CFH.js";import{Aa as w,B as f,Ba as x,D as p,Da as S,E as m,Ea as y,Fa as b,L as v,R as d,Ra as P,W as j,Ya as A,Za as Q,_,bb as N,c as T,eb as R,ha as g,ia as a,ja as s,kb as z,mb as G,oa as C,pa as h,qa as u,ra as I,sa as V,ta as D,va as F,ya as l,za as M}from"./chunk-EZJSWEPC.js";var ee=["taskEditor"];function te(c,t){if(c&1){let e=C();a(0,"button",28),h("click",function(){p(e);let r=u();return m(r.clearSearch())}),l(1," \u2715 "),s()}}function ne(c,t){if(c&1&&(a(0,"option",29),l(1),s()),c&2){let e=t.$implicit;g("value",e.id),d(),x(" ",e.icon," ",e.name," ")}}function re(c,t){if(c&1&&(a(0,"span"),l(1),s()),c&2){let e=u(2);d(),w('for "',e.searchQuery(),'"')}}function oe(c,t){if(c&1&&(a(0,"div",30)(1,"h2"),l(2),_(3,re,2,1,"span",31),s()()),c&2){let e=u();d(2),x(" ",e.searchResults().length," result",e.searchResults().length!==1?"s":""," "),d(),g("ngIf",e.searchQuery())}}function ie(c,t){if(c&1&&(a(0,"div",43)(1,"span",44),l(2,"\u21B3 Subtask of:"),s(),a(3,"span",45),l(4),s()()),c&2){let e,n=u().$implicit,r=u(3);d(4),M(((e=r.getParentTask(n))==null?null:e.title)||"Unknown Parent")}}function ae(c,t){if(c&1){let e=C();a(0,"div",40),_(1,ie,5,1,"div",41),a(2,"app-todo-item",42),h("edit",function(){let r=p(e).$implicit,i=u(3);return m(i.onEditTodo(r))})("toggle",function(r){p(e);let i=u(3);return m(i.onToggleTodo(r))})("delete",function(r){p(e);let i=u(3);return m(i.onDeleteTodo(r))})("update",function(r){p(e);let i=u(3);return m(i.onUpdateTodo(r))})("addSubtaskEvent",function(r){p(e);let i=u(3);return m(i.onAddSubtask(r))})("toggleExpanded",function(r){p(e);let i=u(3);return m(i.onToggleExpanded(r))})("archive",function(r){p(e);let i=u(3);return m(i.onArchiveTodo(r))})("unarchive",function(r){p(e);let i=u(3);return m(i.onUnarchiveTodo(r))}),s()()}if(c&2){let e=t.$implicit,n=u(3);d(),g("ngIf",n.isSubtask(e)),d(),g("todo",e)("isSubtask",n.isSubtask(e))}}function se(c,t){if(c&1&&(a(0,"div",34)(1,"div",35)(2,"span",36),l(3),s(),a(4,"h3"),l(5),s(),a(6,"span",37),l(7),s()(),a(8,"div",38),_(9,ae,3,3,"div",39),s()()),c&2){let e=t.$implicit,n=u(2);d(2),F("color",e.project==null?null:e.project.color),d(),w(" ",(e.project==null?null:e.project.icon)||"\u{1F4CB}"," "),d(2),M((e.project==null?null:e.project.name)||"No Project"),d(2),x("",e.tasks.length," task",e.tasks.length!==1?"s":""),d(2),g("ngForOf",e.tasks)("ngForTrackBy",n.trackByTodoId)}}function ce(c,t){if(c&1&&(a(0,"div",32),_(1,se,10,8,"div",33),s()),c&2){let e=u();d(),g("ngForOf",e.groupedResults())}}function le(c,t){c&1&&(a(0,"div",46)(1,"div",47),l(2,"\u{1F50D}"),s(),a(3,"h3"),l(4,"Start searching"),s(),a(5,"p"),l(6,"Enter a search term to find tasks across all your projects"),s()())}function de(c,t){c&1&&(a(0,"div",46)(1,"div",47),l(2,"\u{1F4ED}"),s(),a(3,"h3"),l(4,"No results found"),s(),a(5,"p"),l(6,"No tasks match your search criteria. Try different keywords or check your filters."),s()())}var $=class c{taskEditor;todoService=f(K);projectService=f(G);confirmationService=f(J);route=f(R);searchQuery=v("");selectedProjectId=v("");selectedStatus=v("all");editingTodo=null;ngOnInit(){this.route.queryParams.subscribe(t=>{t.q&&this.searchQuery.set(t.q)})}searchResults=P(()=>{let t=this.searchQuery().toLowerCase().trim(),e=this.selectedProjectId();if(!t)return[];let n=this.flattenTodos(this.todoService.todos());console.log("=== SEARCH DEBUG ==="),console.log("Query:",t),console.log("Total flattened todos:",n.length),console.log("Todos with parentId (subtasks):",n.filter(o=>o.parentId).length),n.forEach(o=>{o.title.toLowerCase().includes(t)&&console.log("MATCH FOUND:",o.title,"parentId:",o.parentId)});let r=n.filter(o=>this.todoMatchesSearch(o,t));switch(e&&(r=r.filter(o=>o.projectId===e)),this.selectedStatus()){case"active":r=r.filter(o=>!o.completed&&!o.archived);break;case"completed":r=r.filter(o=>o.completed&&!o.archived);break;case"archived":r=r.filter(o=>o.archived);break;case"all":default:r=r.filter(o=>!o.archived);break}return console.log("Search results found:",r.length),r.forEach(o=>console.log("Result:",o.title,"parentId:",o.parentId)),r.sort((o,k)=>{let O=o.title.toLowerCase()===t,E=k.title.toLowerCase()===t;return O&&!E?-1:!O&&E?1:new Date(k.createdAt).getTime()-new Date(o.createdAt).getTime()})});groupedResults=P(()=>{let t=this.searchResults(),e=new Map;for(let n of t){let r=n.projectId||"",i=r?this.projectService.getProjectById(r):null;e.has(r)||e.set(r,{project:i,tasks:[]}),e.get(r).tasks.push(n)}return Array.from(e.values()).sort((n,r)=>{let i=n.project?.name||"No Project",o=r.project?.name||"No Project";return i.localeCompare(o)})});onSearchInput(t){let e=t.target;this.searchQuery.set(e.value)}clearSearch(){this.searchQuery.set("")}onProjectFilterChange(){}onStatusFilterChange(){}trackByTodoId(t,e){return e.id}onToggleTodo(t){this.todoService.toggleTodo(t)}onDeleteTodo(t){return T(this,null,function*(){let e=this.findTodoById(t);if(!e)return;(yield this.confirmationService.open("Delete Task",`Are you sure you want to delete "${e.title}"? This will also delete all its subtasks.`,"Delete","Cancel",!1))==="confirm"&&this.todoService.deleteTodo(t)})}onEditTodo(t){this.editingTodo=t,this.taskEditor.open()}onUpdateTodo(t){this.todoService.updateTodo(t.id,t.updates)}onAddSubtask(t){this.todoService.addSubtask(t.parentId,t.subtaskData)}onToggleExpanded(t){this.todoService.toggleExpanded(t)}onArchiveTodo(t){this.todoService.archiveTodo(t)}onUnarchiveTodo(t){this.todoService.unarchiveTodo(t)}onSaveTask(t){return T(this,null,function*(){if(this.editingTodo)try{yield this.todoService.updateTodo(this.editingTodo.id,t),this.taskEditor.closeAndReset(),this.closeEditor()}catch(e){if(e?.message==="OVERLAP_CANCELLED")return;console.error("Failed to save todo:",e)}})}closeEditor(){this.editingTodo=null}findTodoById(t){return this.flattenTodos(this.todoService.todos()).find(n=>n.id===t)}isSubtask(t){return!!t.parentId}getParentTask(t){if(t.parentId)return this.findTodoById(t.parentId)}flattenTodos(t){let e=[],n=r=>{for(let i of r)e.push(i),i.subtasks&&i.subtasks.length>0&&n(i.subtasks)};return n(t),e}todoMatchesSearch(t,e){let n=t.title.toLowerCase().includes(e),r=t.description?.toLowerCase().includes(e)??!1,i=t.category?.toLowerCase().includes(e)??!1;return n||r||i}static \u0275fac=function(e){return new(e||c)};static \u0275cmp=j({type:c,selectors:[["app-search"]],viewQuery:function(e,n){if(e&1&&I(ee,5),e&2){let r;V(r=D())&&(n.taskEditor=r.first)}},decls:40,vars:10,consts:[["searchInput",""],["taskEditor",""],[1,"search-container"],[1,"search-header"],[1,"search-subtitle"],[1,"search-input-container"],[1,"search-input-wrapper"],[1,"search-icon"],["type","text","placeholder","Search tasks, descriptions, categories...",1,"search-input",3,"ngModelChange","input","ngModel"],["class","clear-search-btn","title","Clear search",3,"click",4,"ngIf"],[1,"search-filters"],[1,"status-filter"],["for","status-select"],["id","status-select",3,"ngModelChange","change","ngModel"],["value","all"],["value","active"],["value","completed"],["value","archived"],[1,"project-filter"],["for","project-select"],["id","project-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"search-results"],["class","results-header",4,"ngIf"],["class","results-by-project",4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"save","close","todo"],["title","Clear search",1,"clear-search-btn",3,"click"],[3,"value"],[1,"results-header"],[4,"ngIf"],[1,"results-by-project"],["class","project-group",4,"ngFor","ngForOf"],[1,"project-group"],[1,"project-group-header"],[1,"project-icon"],[1,"task-count"],[1,"project-tasks"],["class","search-result-wrapper",4,"ngFor","ngForOf","ngForTrackBy"],[1,"search-result-wrapper"],["class","parent-context",4,"ngIf"],[1,"search-result-item",3,"edit","toggle","delete","update","addSubtaskEvent","toggleExpanded","archive","unarchive","todo","isSubtask"],[1,"parent-context"],[1,"parent-indicator"],[1,"parent-title"],[1,"empty-state"],[1,"empty-icon"]],template:function(e,n){if(e&1){let r=C();a(0,"div",2)(1,"header",3)(2,"h1"),l(3,"Search Tasks"),s(),a(4,"p",4),l(5,"Search across all projects and tasks"),s()(),a(6,"div",5)(7,"div",6)(8,"span",7),l(9,"\u{1F50D}"),s(),a(10,"input",8,0),b("ngModelChange",function(o){return p(r),y(n.searchQuery,o)||(n.searchQuery=o),m(o)}),h("input",function(o){return p(r),m(n.onSearchInput(o))}),s(),_(12,te,2,0,"button",9),s()(),a(13,"div",10)(14,"div",11)(15,"label",12),l(16,"Status:"),s(),a(17,"select",13),b("ngModelChange",function(o){return p(r),y(n.selectedStatus,o)||(n.selectedStatus=o),m(o)}),h("change",function(){return p(r),m(n.onStatusFilterChange())}),a(18,"option",14),l(19,"All Tasks"),s(),a(20,"option",15),l(21,"Active"),s(),a(22,"option",16),l(23,"Completed"),s(),a(24,"option",17),l(25,"Archived"),s()()(),a(26,"div",18)(27,"label",19),l(28,"Project:"),s(),a(29,"select",20),b("ngModelChange",function(o){return p(r),y(n.selectedProjectId,o)||(n.selectedProjectId=o),m(o)}),h("change",function(){return p(r),m(n.onProjectFilterChange())}),a(30,"option",21),l(31,"All Projects"),s(),_(32,ne,2,3,"option",22),s()()(),a(33,"div",23),_(34,oe,4,3,"div",24)(35,ce,2,1,"div",25)(36,le,7,0,"div",26)(37,de,7,0,"div",26),s()(),a(38,"app-task-editor",27,1),h("save",function(o){return p(r),m(n.onSaveTask(o))})("close",function(){return p(r),m(n.closeEditor())}),s()}e&2&&(d(10),S("ngModel",n.searchQuery),d(2),g("ngIf",n.searchQuery),d(5),S("ngModel",n.selectedStatus),d(12),S("ngModel",n.selectedProjectId),d(3),g("ngForOf",n.projectService.activeProjects()),d(2),g("ngIf",n.searchQuery),d(),g("ngIf",n.searchQuery()&&n.searchResults().length>0),d(),g("ngIf",!n.searchQuery()),d(),g("ngIf",n.searchQuery()&&n.searchResults().length===0),d(),g("todo",n.editingTodo))},dependencies:[N,A,Q,Y,q,H,B,U,L,W,z,Z,X],styles:[".search-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.search-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.search-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:var(--text-primary);margin-bottom:.5rem}.search-subtitle[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--text-secondary);margin:0}.search-input-container[_ngcontent-%COMP%]{margin-bottom:2rem}.search-input-wrapper[_ngcontent-%COMP%]{position:relative;max-width:600px;margin:0 auto}.search-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;top:50%;transform:translateY(-50%);font-size:1.2rem;color:var(--text-secondary);pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;padding:1rem 1rem 1rem 3rem;font-size:1.1rem;border:2px solid var(--border-color);border-radius:12px;background:var(--bg-secondary);color:var(--text-primary);transition:all .2s ease}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px var(--primary-color-alpha)}.clear-search-btn[_ngcontent-%COMP%]{position:absolute;right:1rem;top:50%;transform:translateY(-50%);background:none;border:none;font-size:1.2rem;color:var(--text-secondary);cursor:pointer;padding:.25rem;border-radius:4px;transition:all .2s ease}.clear-search-btn[_ngcontent-%COMP%]:hover{background:var(--bg-tertiary);color:var(--text-primary)}.search-filters[_ngcontent-%COMP%]{display:flex;gap:2rem;align-items:center;justify-content:center;margin-bottom:2rem;flex-wrap:wrap}.status-filter[_ngcontent-%COMP%], .project-filter[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.status-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .project-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary)}.status-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .project-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid var(--border-color);border-radius:8px;background:var(--bg-secondary);color:var(--text-primary);font-size:.9rem;min-width:150px}.search-results[_ngcontent-%COMP%]{margin-top:2rem}.results-header[_ngcontent-%COMP%]{margin-bottom:1.5rem;text-align:center}.results-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:0}.results-by-project[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.project-group[_ngcontent-%COMP%]{background:var(--bg-secondary);border-radius:12px;padding:1.5rem;border:1px solid var(--border-color)}.project-group-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:1px solid var(--border-color)}.project-icon[_ngcontent-%COMP%]{font-size:1.5rem}.project-group-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0;flex:1}.task-count[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);background:var(--bg-tertiary);padding:.25rem .75rem;border-radius:20px}.project-tasks[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.search-result-wrapper[_ngcontent-%COMP%]{margin-bottom:1rem}.parent-context[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px 6px 0 0;padding:.5rem .75rem;font-size:.85rem;color:#6b7280;border-bottom:none}.parent-indicator[_ngcontent-%COMP%]{font-weight:500;margin-right:.5rem}.parent-title[_ngcontent-%COMP%]{color:#374151;font-weight:500}.search-result-item[_ngcontent-%COMP%]{background:#fff;border-radius:8px;border:1px solid #e5e7eb}.search-result-wrapper[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]{border-radius:0 0 8px 8px;margin-top:0}.search-result-wrapper[_ngcontent-%COMP%]:not(:has(.parent-context))   .search-result-item[_ngcontent-%COMP%]{border-radius:8px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;color:var(--text-secondary)}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;max-width:400px;margin:0 auto}@media (max-width: 768px){.search-container[_ngcontent-%COMP%]{padding:1rem}.search-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem}.search-filters[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.project-filter[_ngcontent-%COMP%]{width:100%;justify-content:center}.project-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:250px}.project-group[_ngcontent-%COMP%]{padding:1rem}.project-group-header[_ngcontent-%COMP%]{flex-wrap:wrap;gap:.5rem}.task-count[_ngcontent-%COMP%]{order:3;flex-basis:100%;text-align:center;margin-top:.5rem}}"]})};export{$ as SearchComponent};
