import{A as _t,C as N,e as et,h as nt,i as it,j as z,k as L,l as ot,m as rt,n as j,o as at,p as st,r as lt,s as ct,t as dt,u as mt,v as pt,w as ut,x as R,z as ft}from"./chunk-VMC4RC4D.js";import{Ab as g,Ac as xt,Bb as _,Ca as o,Cb as O,Db as $,Fb as h,Gb as x,Hb as v,Kb as Y,Na as V,Ra as w,Ta as K,Tb as b,_ as S,c as k,cb as u,da as m,db as r,ea as p,eb as a,fa as E,fb as D,ga as P,kc as tt,lc as W,mb as T,mc as F,na as I,nb as f,ob as c,qc as H,ra as q,sb as G,tb as Q,ub as J,wb as X,xb as Z,xc as gt,yc as A,zb as d,zc as ht}from"./chunk-L2PMUJ2L.js";function St(l,e){if(l&1&&(r(0,"div",8)(1,"span",9),d(2),a(),r(3,"span",10),d(4),a()()),l&2){let t=c();o(2),O("",t.workingSessions().length," ",t.translations().sessions),o(2),O("",t.translations().total,": ",t.formatDuration(t.totalActualTime()))}}function kt(l,e){if(l&1){let t=T();r(0,"div",11)(1,"div",12)(2,"span",13),d(3),a(),r(4,"span",14),d(5),a(),r(6,"span",15),d(7),a()(),r(8,"div",16)(9,"span",17),d(10),a(),r(11,"button",18),f("click",function(){m(t);let n=c();return p(n.stopWorking())}),d(12),a()()()}if(l&2){let t,i=c();o(3),_("\u{1F534} ",i.translations().currentlyWorking),o(2),O(" (",i.translations().startedAt,": ",i.formatTime(i.activeSession().startTime),")"),o(2),g(i.getCurrentSessionDuration()),o(3),g(((t=i.activeSession())==null?null:t.description)||i.translations().workingSession),o(2),g(i.translations().stop)}}function Dt(l,e){if(l&1){let t=T();r(0,"div",19)(1,"button",20),f("click",function(){m(t);let n=c();return p(n.startWorking())}),d(2),a()()}if(l&2){let t=c();o(2),_(" \u25B6\uFE0F ",t.translations().startWorking," ")}}function bt(l,e){if(l&1){let t=T();r(0,"div",26)(1,"div",27)(2,"div",28)(3,"label"),d(4),a(),r(5,"input",29),v("ngModelChange",function(n){m(t);let s=c(3);return x(s.editForm.description,n)||(s.editForm.description=n),p(n)}),a()(),r(6,"div",28)(7,"label"),d(8),a(),r(9,"input",30),v("ngModelChange",function(n){m(t);let s=c(3);return x(s.editForm.startTime,n)||(s.editForm.startTime=n),p(n)}),a()(),r(10,"div",28)(11,"label"),d(12),a(),r(13,"input",30),v("ngModelChange",function(n){m(t);let s=c(3);return x(s.editForm.endTime,n)||(s.editForm.endTime=n),p(n)}),a()(),r(14,"div",31)(15,"button",32),f("click",function(){m(t);let n=c().$implicit,s=c(2);return p(s.saveSession(n))}),d(16),a(),r(17,"button",33),f("click",function(){m(t);let n=c(3);return p(n.cancelEdit())}),d(18),a()()()()}if(l&2){let t=c(3);o(4),_("",t.translations().description,":"),o(),h("ngModel",t.editForm.description),u("placeholder",t.translations().sessionDescription),o(3),_("",t.translations().startTime,":"),o(),h("ngModel",t.editForm.startTime),o(3),_("",t.translations().endTime,":"),o(),h("ngModel",t.editForm.endTime),o(3),g(t.translations().save),o(2),g(t.translations().cancel)}}function Mt(l,e){if(l&1&&(r(0,"div",16)(1,"span",17),d(2),a()()),l&2){let t=c(2).$implicit;o(2),g(t.description)}}function Et(l,e){if(l&1){let t=T();r(0,"div",34)(1,"div",35)(2,"span",36),d(3),a(),r(4,"span",37),d(5),a(),r(6,"div",38)(7,"button",39),f("click",function(n){m(t);let s=c().$implicit,y=c(2);return p(y.startEditSession(s,n))}),E(),r(8,"svg",40),D(9,"path",41),a()(),P(),r(10,"button",42),f("click",function(n){m(t);let s=c().$implicit,y=c(2);return p(y.confirmDeleteSession(s,n))}),E(),r(11,"svg",40),D(12,"path",43),a()()()(),w(13,Mt,3,1,"div",44),P(),r(14,"div",45),d(15),a()()}if(l&2){let t=c().$implicit,i=c(2);o(3),g(i.formatSessionDate(t.startTime)),o(2),g(i.formatDuration(t.duration)),o(2),u("title",i.translations().editSession),o(3),u("title",i.translations().deleteSession),o(3),u("ngIf",t.description&&t.description!==i.translations().workingSession),o(2),O(" ",i.formatTime(t.startTime)," - ",i.formatTime(t.endTime)," ")}}function Pt(l,e){if(l&1&&(r(0,"div",23),w(1,bt,19,9,"div",24)(2,Et,16,7,"div",25),a()),l&2){let t=e.$implicit,i=c(2);o(),u("ngIf",i.editingSessionId()===t.id),o(),u("ngIf",i.editingSessionId()!==t.id)}}function It(l,e){if(l&1&&(r(0,"div",21)(1,"h4"),d(2),a(),w(3,Pt,3,2,"div",22),a()),l&2){let t=c();o(2),g(t.translations().pastSessions),o(),u("ngForOf",t.completedSessions())("ngForTrackBy",t.trackBySessionId)}}function Ot(l,e){if(l&1&&(r(0,"div",46)(1,"div",47),d(2,"\u23F1\uFE0F"),a(),r(3,"div",48),d(4),a(),r(5,"div",49),d(6),a()()),l&2){let t=c();o(4),g(t.translations().noWorkingSessionsYet),o(2),g(t.translations().startWorkingHint)}}function Vt(l,e){if(l&1&&(r(0,"div",52)(1,"span",53),d(2),a(),r(3,"span",54),d(4),a()()),l&2){let t=c(2);o(2),_("",t.translations().estimated,":"),o(2),g(t.formatDuration(t.todo.duration))}}function Wt(l,e){if(l&1&&(r(0,"div",52)(1,"span",53),d(2),a(),r(3,"span",54),d(4),a()()),l&2){let t=c(2);o(2),_("",t.translations().actual,":"),o(2),g(t.formatDuration(t.totalActualTime()))}}function Ft(l,e){if(l&1&&(r(0,"div",52)(1,"span",53),d(2),a(),r(3,"span",54),d(4),a()()),l&2){let t=c(2);o(2),_("",t.translations().difference,":"),o(),Z("over-estimate",t.totalActualTime()>t.todo.duration)("under-estimate",t.totalActualTime()<t.todo.duration),o(),_(" ",t.getDifferenceText()," ")}}function Ht(l,e){if(l&1&&(r(0,"div",50),w(1,Vt,5,2,"div",51)(2,Wt,5,2,"div",51)(3,Ft,5,6,"div",51),a()),l&2){let t=c();o(),u("ngIf",t.todo.duration),o(),u("ngIf",t.totalActualTime()>0),o(),u("ngIf",t.todo.duration&&t.totalActualTime()>0)}}var U=class l{todo=null;todoService=S(N);timeTrackingService=S(xt);translationService=S(A);translations=b(()=>({workingSessions:this.translationService.translate("workingSessions.title"),sessions:this.translationService.translate("workingSessions.sessions"),total:this.translationService.translate("common.total"),currentlyWorking:this.translationService.translate("workingSessions.currentlyWorking"),startedAt:this.translationService.translate("workingSessions.startedAt"),workingSession:this.translationService.translate("timetable.workingSession"),stop:this.translationService.translate("actions.stop"),startWorking:this.translationService.translate("workingSessions.startWorking"),pastSessions:this.translationService.translate("workingSessions.pastSessions"),description:this.translationService.translate("tasks.description"),sessionDescription:this.translationService.translate("workingSessions.sessionDescription"),startTime:this.translationService.translate("workingSessions.startTime"),endTime:this.translationService.translate("workingSessions.endTime"),save:this.translationService.translate("actions.save"),cancel:this.translationService.translate("actions.cancel"),editSession:this.translationService.translate("workingSessions.editSession"),deleteSession:this.translationService.translate("workingSessions.deleteSession"),noWorkingSessionsYet:this.translationService.translate("workingSessions.noWorkingSessionsYet"),startWorkingHint:this.translationService.translate("workingSessions.startWorkingHint"),estimated:this.translationService.translate("workingSessions.estimated"),actual:this.translationService.translate("workingSessions.actual"),difference:this.translationService.translate("workingSessions.difference"),today:this.translationService.translate("common.today"),yesterday:this.translationService.translate("common.yesterday"),over:this.translationService.translate("workingSessions.over"),under:this.translationService.translate("workingSessions.under"),exactMatch:this.translationService.translate("workingSessions.exactMatch"),endTimeAfterStart:this.translationService.translate("workingSessions.endTimeAfterStart"),sessionUpdatedSuccessfully:this.translationService.translate("workingSessions.sessionUpdatedSuccessfully"),failedToUpdateSession:this.translationService.translate("workingSessions.failedToUpdateSession"),deleteSessionConfirm:this.translationService.translate("workingSessions.deleteSessionConfirm"),date:this.translationService.translate("workingSessions.date"),duration:this.translationService.translate("tasks.duration"),time:this.translationService.translate("workingSessions.time"),sessionDeletedSuccessfully:this.translationService.translate("workingSessions.sessionDeletedSuccessfully"),failedToDeleteSession:this.translationService.translate("workingSessions.failedToDeleteSession")}));editingSessionId=I(null);editForm={description:"",startTime:"",endTime:""};workingSessions=b(()=>this.todo?this.todoService.getWorkingSessionsForTask(this.todo.id):[]);completedSessions=b(()=>this.workingSessions().filter(e=>!e.isActive));activeSession=b(()=>this.workingSessions().find(e=>e.isActive)||null);totalActualTime=b(()=>this.todo?this.todoService.getActualWorkTimeForTask(this.todo.id):0);startWorking(){return k(this,null,function*(){if(this.todo)try{yield this.todoService.startWorking(this.todo.id)}catch(e){console.error("Error starting work session:",e)}})}stopWorking(){return k(this,null,function*(){try{yield this.todoService.stopWorking()}catch(e){console.error("Error stopping work session:",e)}})}getCurrentSessionDuration(){let e=this.activeSession();if(!e)return"0m";let i=Math.round((new Date().getTime()-e.startTime.getTime())/6e4);return this.formatDuration(i)}formatDuration(e){return this.timeTrackingService.formatDuration(e)}formatSessionDate(e){let t=new Date,i=new Date(e);if(this.isSameDay(i,t))return this.translations().today;let n=new Date(t);if(n.setDate(n.getDate()-1),this.isSameDay(i,n))return this.translations().yesterday;let s=this.translationService.currentLocale();return new Intl.DateTimeFormat(s,{month:"short",day:"numeric"}).format(i)}formatTime(e){let t=this.translationService.currentLocale(),i=t==="en-US";return new Intl.DateTimeFormat(t,{hour:"numeric",minute:"2-digit",hour12:i}).format(new Date(e))}getDifferenceText(){if(!this.todo||!this.todo.duration)return"";let e=this.todo.duration,t=this.totalActualTime(),i=Math.abs(t-e);return t>e?`+${this.formatDuration(i)} ${this.translations().over}`:t<e?`${this.formatDuration(i)} ${this.translations().under}`:this.translations().exactMatch}isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}startEditSession(e,t){t&&(t.stopPropagation(),t.preventDefault()),this.editingSessionId.set(e.id),this.editForm.description=e.description||"",this.editForm.startTime=this.formatDateForInput(e.startTime),this.editForm.endTime=e.endTime?this.formatDateForInput(e.endTime):""}cancelEdit(){this.editingSessionId.set(null),this.resetEditForm()}saveSession(e){return k(this,null,function*(){try{let t=new Date(this.editForm.startTime),i=new Date(this.editForm.endTime);if(i<=t){alert(this.translations().endTimeAfterStart);return}let n=Math.round((i.getTime()-t.getTime())/6e4),s={description:this.editForm.description.trim()||this.translations().workingSession,startTime:t,endTime:i,duration:n};yield this.timeTrackingService.updateTimeEntry(e.id,s),this.editingSessionId.set(null),this.resetEditForm(),console.log(this.translations().sessionUpdatedSuccessfully)}catch(t){console.error("Error updating session:",t),alert(this.translations().failedToUpdateSession)}})}confirmDeleteSession(e,t){return k(this,null,function*(){t&&(t.stopPropagation(),t.preventDefault()),confirm(`${this.translations().deleteSessionConfirm}

${this.translations().date}: ${this.formatSessionDate(e.startTime)}
${this.translations().duration}: ${this.formatDuration(e.duration)}
${this.translations().time}: ${this.formatTime(e.startTime)} - ${this.formatTime(e.endTime)}`)&&(yield this.deleteSession(e))})}deleteSession(e){return k(this,null,function*(){try{yield this.timeTrackingService.deleteTimeEntry(e.id),console.log(this.translations().sessionDeletedSuccessfully)}catch(t){console.error("Error deleting session:",t),alert(this.translations().failedToDeleteSession)}})}resetEditForm(){this.editForm.description="",this.editForm.startTime="",this.editForm.endTime=""}formatDateForInput(e){let t=new Date(e);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)}trackBySessionId(e,t){return t.id}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=V({type:l,selectors:[["app-working-sessions"]],inputs:{todo:"todo"},decls:10,vars:7,consts:[[1,"working-sessions-container"],[1,"header"],["class","session-summary",4,"ngIf"],["class","active-session",4,"ngIf"],["class","start-working",4,"ngIf"],["class","sessions-list",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","time-comparison",4,"ngIf"],[1,"session-summary"],[1,"session-count"],[1,"total-time"],[1,"active-session"],[1,"session-header","active"],[1,"session-status"],[1,"session-start-time"],[1,"session-time"],[1,"session-details"],[1,"session-description"],["type","button",1,"stop-btn",3,"click"],[1,"start-working"],["type","button",1,"start-btn",3,"click"],[1,"sessions-list"],["class","session-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"session-item"],["class","edit-session",4,"ngIf"],["class","view-session",4,"ngIf"],[1,"edit-session"],[1,"edit-form"],[1,"edit-row"],["type","text",1,"edit-input",3,"ngModelChange","ngModel","placeholder"],["type","datetime-local",1,"edit-input",3,"ngModelChange","ngModel"],[1,"edit-actions"],["type","button",1,"save-btn",3,"click"],["type","button",1,"cancel-btn",3,"click"],[1,"view-session"],[1,"session-header"],[1,"session-date"],[1,"session-duration"],[1,"session-actions"],[1,"edit-session-btn",3,"click","title"],["width","14","height","14","viewBox","0 0 16 16","fill","currentColor"],["d","M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75 1.75 0 01.445-.758l8.61-8.61z"],[1,"delete-session-btn",3,"click","title"],["d","M6.5 1.75a.25.25 0 01.25-.25h2.5a.25.25 0 01.25.25V3h-3V1.75zm4.5 0V3h2.25a.75.75 0 010 1.5H2.75a.75.75 0 010-1.5H5V1.75C5 .784 5.784 0 6.75 0h2.5C10.216 0 11 .784 11 1.75zM4.496 6.675a.75.75 0 10-1.492.15l.66 6.6A1.75 1.75 0 005.405 15h5.19c.9 0 1.652-.681 1.741-1.576l.66-6.6a.75.75 0 00-1.492-.149l-.66 6.6a.25.25 0 01-.249.225h-5.19a.25.25 0 01-.249-.225l-.66-6.6z"],["class","session-details",4,"ngIf"],[1,"session-time-range"],[1,"empty-state"],[1,"empty-icon"],[1,"empty-message"],[1,"empty-hint"],[1,"time-comparison"],["class","comparison-row",4,"ngIf"],[1,"comparison-row"],[1,"label"],[1,"value"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"h3"),d(3),a(),w(4,St,5,4,"div",2),a(),w(5,kt,13,6,"div",3)(6,Dt,3,1,"div",4)(7,It,4,3,"div",5)(8,Ot,7,2,"div",6)(9,Ht,4,3,"div",7),a()),t&2&&(o(3),g(i.translations().workingSessions),o(),u("ngIf",i.workingSessions().length>0),o(),u("ngIf",i.activeSession()),o(),u("ngIf",!i.activeSession()&&i.todo),o(),u("ngIf",i.completedSessions().length>0),o(),u("ngIf",i.workingSessions().length===0),o(),u("ngIf",i.todo&&(i.todo.duration||i.totalActualTime()>0)))},dependencies:[H,W,F,R,z,L,j],styles:[".working-sessions-container[_ngcontent-%COMP%]{padding:16px;background:#f8f9fa;border-radius:8px;margin:16px 0}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#333;font-size:18px}.session-summary[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:14px;color:#666}.session-count[_ngcontent-%COMP%]{font-weight:500}.total-time[_ngcontent-%COMP%]{font-weight:600;color:#2563eb}.active-session[_ngcontent-%COMP%]{background:#fef3c7;border:1px solid #f59e0b;border-radius:6px;padding:12px;margin-bottom:16px}.session-header.active[_ngcontent-%COMP%]   .session-status[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}.session-time[_ngcontent-%COMP%]{font-family:Monaco,Menlo,monospace;font-weight:600;color:#1f2937}.session-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.session-description[_ngcontent-%COMP%]{color:#6b7280;font-style:italic}.start-working[_ngcontent-%COMP%]{margin-bottom:16px}.start-btn[_ngcontent-%COMP%]{background:#10b981;color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-weight:500;transition:background-color .2s}.start-btn[_ngcontent-%COMP%]:hover{background:#059669}.stop-btn[_ngcontent-%COMP%]{background:#dc2626;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:12px;transition:background-color .2s}.stop-btn[_ngcontent-%COMP%]:hover{background:#b91c1c}.sessions-list[_ngcontent-%COMP%]{margin-top:16px}.sessions-list[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:#374151;font-size:14px;font-weight:600}.session-item[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;border-radius:6px;padding:12px;margin-bottom:8px}.session-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.session-date[_ngcontent-%COMP%]{font-weight:500;color:#374151}.session-duration[_ngcontent-%COMP%]{font-family:Monaco,Menlo,monospace;font-weight:600;color:#2563eb}.session-time-range[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;margin-top:4px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:32px 16px;color:#6b7280}.empty-icon[_ngcontent-%COMP%]{font-size:48px;margin-bottom:12px}.empty-message[_ngcontent-%COMP%]{font-size:16px;font-weight:500;margin-bottom:4px}.empty-hint[_ngcontent-%COMP%]{font-size:14px}.time-comparison[_ngcontent-%COMP%]{margin-top:16px;padding:12px;background:#fff;border:1px solid #e5e7eb;border-radius:6px}.comparison-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.comparison-row[_ngcontent-%COMP%]:last-child{margin-bottom:0}.comparison-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:14px;color:#6b7280}.comparison-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-family:Monaco,Menlo,monospace;font-weight:600;font-size:14px}.over-estimate[_ngcontent-%COMP%]{color:#dc2626}.under-estimate[_ngcontent-%COMP%]{color:#059669}@media (max-width: 768px){.working-sessions-container[_ngcontent-%COMP%]{padding:12px;margin:12px 0}.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:8px}.session-summary[_ngcontent-%COMP%]{flex-direction:column;gap:4px}.session-details[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:8px}}.session-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.session-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;opacity:0;transition:opacity .2s ease}.session-item[_ngcontent-%COMP%]:hover   .session-actions[_ngcontent-%COMP%]{opacity:1}.edit-session-btn[_ngcontent-%COMP%], .delete-session-btn[_ngcontent-%COMP%]{background:none;border:none;padding:.25rem;border-radius:4px;cursor:pointer;color:#6b7280;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.edit-session-btn[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#2563eb}.delete-session-btn[_ngcontent-%COMP%]:hover{background:#fef2f2;color:#dc2626}.edit-session[_ngcontent-%COMP%]{background:#f9fafb;border-radius:6px;padding:16px}.edit-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.edit-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.edit-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:12px;font-weight:500;color:#374151}.edit-input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #d1d5db;border-radius:4px;font-size:14px;transition:border-color .2s ease}.edit-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px #2563eb1a}.edit-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px}.save-btn[_ngcontent-%COMP%], .cancel-btn[_ngcontent-%COMP%]{padding:8px 16px;border:none;border-radius:4px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease}.save-btn[_ngcontent-%COMP%]{background:#2563eb;color:#fff}.save-btn[_ngcontent-%COMP%]:hover{background:#1d4ed8}.cancel-btn[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151}.cancel-btn[_ngcontent-%COMP%]:hover{background:#e5e7eb}"]})};var zt=["titleTextarea"],Lt=l=>["/project",l],jt=l=>({highlightTask:l});function Rt(l,e){if(l&1){let t=T();r(0,"span",58),d(1),r(2,"button",59),f("click",function(){let n=m(t).index,s=c(2);return p(s.removeTag(n))}),d(3,"\xD7"),a()()}if(l&2){let t=e.$implicit,i=c(2);X("background-color",i.getTagColor(t))("color",i.getTagTextColor(t)),o(),_(" ",t," "),o(),u("title",i.translations().removeTag)}}function At(l,e){if(l&1&&D(0,"option",31),l&2){let t=e.$implicit;u("value",t.name)}}function Nt(l,e){if(l&1&&(r(0,"div",60)(1,"small"),d(2),a()()),l&2){let t=c(2);o(2),$("Progress tracking: ",t.formData.currentCount||0,"/",t.formData.targetCount," ",t.formData.countUnit||"items")}}function Ut(l,e){if(l&1&&(r(0,"option",62),d(1),a()),l&2){let t=e.$implicit;u("ngValue",t.id),o(),g(t.name)}}function Bt(l,e){if(l&1&&(r(0,"small",28),d(1),a()),l&2){let t=c(3);o(),g(t.translations().subtasksHint)}}function Kt(l,e){if(l&1){let t=T();r(0,"div",14)(1,"div",10)(2,"label",11),d(3),a(),r(4,"select",61),v("ngModelChange",function(n){m(t);let s=c(2);return x(s.formData.projectId,n)||(s.formData.projectId=n),p(n)}),r(5,"option",62),d(6),a(),w(7,Ut,2,2,"option",63),a(),w(8,Bt,2,1,"small",64),a()()}if(l&2){let t=c(2);o(3),g(t.translations().project),o(),h("ngModel",t.formData.projectId),u("disabled",t.isSubtask)("title",t.translations().subtasksUseParentProject),o(),u("ngValue",void 0),o(),g(t.translations().noProject),o(),u("ngForOf",t.projectService.activeProjects()),o(),u("ngIf",t.isSubtask)}}function Yt(l,e){if(l&1){let t=T();r(0,"div",70)(1,"div",14)(2,"div",10)(3,"label",11),d(4),a(),r(5,"div",71)(6,"input",72),v("ngModelChange",function(n){m(t);let s=c(3);return x(s.formData.recurrenceInterval,n)||(s.formData.recurrenceInterval=n),p(n)}),a(),r(7,"select",73),v("ngModelChange",function(n){m(t);let s=c(3);return x(s.formData.recurrenceType,n)||(s.formData.recurrenceType=n),p(n)}),r(8,"option",74),d(9),a(),r(10,"option",75),d(11),a(),r(12,"option",76),d(13),a()()()()(),r(14,"div",14)(15,"div",10)(16,"label",11),d(17),a(),r(18,"input",77),v("ngModelChange",function(n){m(t);let s=c(3);return x(s.formData.recurrenceEndDate,n)||(s.formData.recurrenceEndDate=n),p(n)}),a()(),r(19,"div",10)(20,"label",11),d(21),a(),r(22,"input",78),v("ngModelChange",function(n){m(t);let s=c(3);return x(s.formData.recurrenceMaxOccurrences,n)||(s.formData.recurrenceMaxOccurrences=n),p(n)}),a()()(),r(23,"small",28),d(24),a()()}if(l&2){let t=c(3);o(4),g(t.translations().repeatEvery),o(2),h("ngModel",t.formData.recurrenceInterval),o(),h("ngModel",t.formData.recurrenceType),o(2),g(t.formData.recurrenceInterval===1?t.translations().day:t.translations().days),o(2),g(t.formData.recurrenceInterval===1?t.translations().week:t.translations().weeks),o(2),g(t.formData.recurrenceInterval===1?t.translations().month:t.translations().months),o(4),g(t.translations().endRecurrence),o(),h("ngModel",t.formData.recurrenceEndDate),u("placeholder",t.translations().noEndDate),o(3),g(t.translations().maxOccurrences),o(),h("ngModel",t.formData.recurrenceMaxOccurrences),u("placeholder",t.translations().unlimited),o(2),_(" \u{1F4C5} ",t.getRecurrencePreview()," ")}}function qt(l,e){if(l&1){let t=T();r(0,"div",10)(1,"div",65)(2,"label",66)(3,"input",67),v("ngModelChange",function(n){m(t);let s=c(2);return x(s.formData.isRecurring,n)||(s.formData.isRecurring=n),p(n)}),f("change",function(){m(t);let n=c(2);return p(n.onRecurringToggle())}),a(),D(4,"span",68),d(5),a()(),w(6,Yt,25,13,"div",69),a()}if(l&2){let t=c(2);o(3),h("ngModel",t.formData.isRecurring),o(2),_(" \u{1F504} ",t.translations().makeRecurring," "),o(),u("ngIf",t.formData.isRecurring)}}function Gt(l,e){if(l&1&&(r(0,"div",79),D(1,"app-working-sessions",80),a()),l&2){let t=c(2);o(),u("todo",t.todo)}}function Qt(l,e){if(l&1){let t=T();r(0,"a",81),f("click",function(){m(t);let n=c(2);return p(n.onClose())}),d(1),a()}if(l&2){let t=c(2);u("routerLink",Y(3,Lt,t.todo==null?null:t.todo.projectId))("queryParams",Y(5,jt,t.todo==null?null:t.todo.id)),o(),_(" ",t.translations().goToProject," ")}}function Jt(l,e){if(l&1){let t=T();r(0,"div",2),f("click",function(n){m(t);let s=c();return p(s.onOverlayClick(n))}),r(1,"div",3),f("click",function(n){return m(t),p(n.stopPropagation())}),r(2,"div",4)(3,"h2",5),d(4),a(),r(5,"button",6),f("click",function(){m(t);let n=c();return p(n.onClose())}),E(),r(6,"svg",7),D(7,"path",8),a()()(),P(),r(8,"form",9),f("ngSubmit",function(){m(t);let n=c();return p(n.onSubmit())}),r(9,"div",10)(10,"label",11),d(11),a(),r(12,"textarea",12,0),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.title,n)||(s.formData.title=n),p(n)}),f("input",function(n){m(t);let s=c();return p(s.onTitleInput(n))})("keydown",function(n){m(t);let s=c();return p(s.onTitleKeydown(n))}),a()(),r(15,"div",10)(16,"label",11),d(17),a(),r(18,"textarea",13),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.description,n)||(s.formData.description=n),p(n)}),f("keydown",function(n){m(t);let s=c();return p(s.onTextareaKeydown(n))}),a()(),r(19,"div",14)(20,"div",10)(21,"label",11),d(22),a(),r(23,"select",15),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.priority,n)||(s.formData.priority=n),p(n)}),f("ngModelChange",function(n){m(t);let s=c();return p(s.onPriorityChange(n))}),r(24,"option",16),d(25),a(),r(26,"option",17),d(27),a(),r(28,"option",18),d(29),a()()(),r(30,"div",10)(31,"label",11),d(32),a(),r(33,"div",19)(34,"input",20),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.dueDate,n)||(s.formData.dueDate=n),p(n)}),f("keydown",function(n){m(t);let s=c();return p(s.onDateTimeKeydown(n,"dueDate"))}),a(),r(35,"button",21),f("click",function(){m(t);let n=c();return p(n.setDueDateToNow())}),d(36),a()()()(),r(37,"div",14)(38,"div",10)(39,"label",11),d(40),a(),r(41,"div",19)(42,"input",22),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.startDateTime,n)||(s.formData.startDateTime=n),p(n)}),f("change",function(){m(t);let n=c();return p(n.onStartDateTimeChange())})("keydown",function(n){m(t);let s=c();return p(s.onDateTimeKeydown(n,"startDateTime"))}),a(),r(43,"button",21),f("click",function(){m(t);let n=c();return p(n.setStartDateTimeToNow())}),d(44),a()()(),r(45,"div",10)(46,"label",11),d(47),a(),r(48,"div",19)(49,"input",23),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.endDateTime,n)||(s.formData.endDateTime=n),p(n)}),f("change",function(){m(t);let n=c();return p(n.onEndDateTimeChange())})("keydown",function(n){m(t);let s=c();return p(s.onDateTimeKeydown(n,"endDateTime"))}),a(),r(50,"button",21),f("click",function(){m(t);let n=c();return p(n.setEndDateTimeToNow())}),d(51),a()()()(),r(52,"div",14)(53,"div",10)(54,"label",11),d(55),a(),r(56,"div",24)(57,"input",25),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.durationHours,n)||(s.formData.durationHours=n),p(n)}),f("change",function(){m(t);let n=c();return p(n.onDurationChange())}),a(),r(58,"span",26),d(59),a(),r(60,"input",27),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.durationMinutes,n)||(s.formData.durationMinutes=n),p(n)}),f("change",function(){m(t);let n=c();return p(n.onDurationChange())}),a(),r(61,"span",26),d(62),a()(),r(63,"small",28),d(64),a()()(),r(65,"div",10)(66,"label",11),d(67),a(),r(68,"input",29),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.category,n)||(s.formData.category=n),p(n)}),a(),r(69,"datalist",30)(70,"option",31),d(71),a(),r(72,"option",31),d(73),a(),r(74,"option",31),d(75),a(),r(76,"option",31),d(77),a(),r(78,"option",31),d(79),a(),r(80,"option",31),d(81),a()()(),r(82,"div",10)(83,"label",11),d(84),a(),r(85,"div",32)(86,"div",33),w(87,Rt,4,6,"span",34),a(),r(88,"input",35),v("ngModelChange",function(n){m(t);let s=c();return x(s.tagInput,n)||(s.tagInput=n),p(n)}),f("keydown",function(n){m(t);let s=c();return p(s.onTagInputKeydown(n))})("blur",function(){m(t);let n=c();return p(n.addTagFromInput())}),a(),r(89,"datalist",36),w(90,At,1,1,"option",37),a()(),r(91,"small",28),d(92),a()(),r(93,"div",38)(94,"div",10)(95,"label",11),d(96),a(),r(97,"input",39),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.targetCount,n)||(s.formData.targetCount=n),p(n)}),a()(),r(98,"div",10)(99,"label",11),d(100),a(),r(101,"input",40),v("ngModelChange",function(n){m(t);let s=c();return x(s.formData.countUnit,n)||(s.formData.countUnit=n),p(n)}),a(),r(102,"datalist",41),D(103,"option",42)(104,"option",43)(105,"option",44)(106,"option",45)(107,"option",46)(108,"option",47)(109,"option",48)(110,"option",49),a()()(),w(111,Nt,3,3,"div",50)(112,Kt,9,8,"div",51)(113,qt,7,3,"div",52)(114,Gt,2,1,"div",53),r(115,"div",54),w(116,Qt,2,7,"a",55),r(117,"button",56),f("click",function(){m(t);let n=c();return p(n.onClose())}),d(118),a(),r(119,"button",57),d(120),a()()()()()}if(l&2){let t=c();o(4),g(t.isEditing?t.translations().editTask:t.translations().createTask),o(7),_("",t.translations().taskTitle," *"),o(),h("ngModel",t.formData.title),u("placeholder",t.translations().enterTaskTitle),o(5),g(t.translations().description),o(),h("ngModel",t.formData.description),u("placeholder",t.translations().enterTaskDescription),o(4),g(t.translations().priority),o(),u("ngClass","priority-"+t.formData.priority),h("ngModel",t.formData.priority),o(2),_("\u{1F7E2} ",t.translations().priorityLow),o(2),_("\u{1F7E1} ",t.translations().priorityMedium),o(2),_("\u{1F534} ",t.translations().priorityHigh),o(3),g(t.translations().dueDate),o(2),h("ngModel",t.formData.dueDate),u("min",t.today),o(2),g(t.translations().now),o(4),g(t.translations().startDateTime),o(2),h("ngModel",t.formData.startDateTime),u("min",t.today),o(2),g(t.translations().now),o(3),g(t.translations().endDateTime),o(2),h("ngModel",t.formData.endDateTime),u("min",t.formData.startDateTime||t.today),o(2),g(t.translations().now),o(4),g(t.translations().duration),o(2),h("ngModel",t.formData.durationHours),o(2),g(t.translations().hours),o(),h("ngModel",t.formData.durationMinutes),o(2),g(t.translations().minutes),o(2),g(t.translations().durationHint),o(3),g(t.translations().category),o(),h("ngModel",t.formData.category),u("placeholder",t.translations().categoryPlaceholder),o(2),u("value",t.translations().work),o(),_("",t.translations().work," "),o(),u("value",t.translations().personal),o(),_("",t.translations().personal," "),o(),u("value",t.translations().development),o(),_("",t.translations().development," "),o(),u("value",t.translations().design),o(),_("",t.translations().design," "),o(),u("value",t.translations().meeting),o(),_("",t.translations().meeting," "),o(),u("value",t.translations().research),o(),_("",t.translations().research," "),o(3),g(t.translations().tags),o(3),u("ngForOf",t.formData.tags),o(),h("ngModel",t.tagInput),u("placeholder",t.translations().tagsPlaceholder),o(2),u("ngForOf",t.tagsService.tags()),o(2),g(t.translations().tagsHint),o(4),g(t.translations().targetCount),o(),h("ngModel",t.formData.targetCount),o(3),g(t.translations().countUnit),o(),h("ngModel",t.formData.countUnit),o(10),u("ngIf",t.formData.targetCount),o(),u("ngIf",!t.isSubtask||t.todo),o(),u("ngIf",!t.isSubtask),o(),u("ngIf",t.isEditing&&t.todo),o(2),u("ngIf",t.todo==null?null:t.todo.projectId),o(2),_(" ",t.translations().cancel," "),o(),u("disabled",!t.formData.title.trim()),o(),_(" ",t.isEditing?t.translations().updateTask:t.translations().createTask," ")}}var vt=class l{projectService=S(gt);tagsService=S(ht);recurringTasksService=S(ft);settingsService=S(_t);translationService=S(A);todoService=S(N);translations=b(()=>({editTask:this.translationService.translate("taskEditor.editTask"),createTask:this.translationService.translate("taskEditor.createTask"),updateTask:this.translationService.translate("taskEditor.updateTask"),cancel:this.translationService.translate("actions.cancel"),goToProject:this.translationService.translate("taskEditor.goToProject"),taskTitle:this.translationService.translate("taskEditor.taskTitle"),enterTaskTitle:this.translationService.translate("taskEditor.enterTaskTitle"),addTaskDescription:this.translationService.translate("taskEditor.addTaskDescription"),enterTaskDescription:this.translationService.translate("taskEditor.enterTaskDescription"),priorityLow:this.translationService.translate("priority.low"),priorityMedium:this.translationService.translate("priority.medium"),priorityHigh:this.translationService.translate("priority.high"),dueDate:this.translationService.translate("tasks.dueDate"),startDateTime:this.translationService.translate("tasks.startDateTime"),endDateTime:this.translationService.translate("tasks.endDateTime"),duration:this.translationService.translate("tasks.duration"),now:this.translationService.translate("time.now"),hours:this.translationService.translate("time.hours"),minutes:this.translationService.translate("time.minutes"),category:this.translationService.translate("tasks.category"),work:this.translationService.translate("categories.work"),personal:this.translationService.translate("categories.personal"),development:this.translationService.translate("categories.development"),design:this.translationService.translate("categories.design"),meeting:this.translationService.translate("categories.meeting"),research:this.translationService.translate("categories.research"),tags:this.translationService.translate("tasks.tags"),removeTag:this.translationService.translate("todoItem.removeTag"),project:this.translationService.translate("tasks.project"),subtasksUseParentProject:this.translationService.translate("taskEditor.subtasksUseParentProject"),targetCount:"Target Count",countUnit:"Count Unit",endRecurrence:this.translationService.translate("taskEditor.endRecurrence"),maxOccurrences:this.translationService.translate("taskEditor.maxOccurrences"),noEndDate:this.translationService.translate("taskEditor.noEndDate"),unlimited:this.translationService.translate("taskEditor.unlimited"),day:this.translationService.translate("time.day"),days:this.translationService.translate("time.days"),week:this.translationService.translate("time.week"),weeks:this.translationService.translate("time.weeks"),month:this.translationService.translate("time.month"),months:this.translationService.translate("time.months"),priority:this.translationService.translate("tasks.priority"),description:this.translationService.translate("tasks.description"),noProject:this.translationService.translate("common.noProject"),durationHint:this.translationService.translate("taskEditor.durationHint"),categoryPlaceholder:this.translationService.translate("taskEditor.categoryPlaceholder"),tagsPlaceholder:this.translationService.translate("taskEditor.tagsPlaceholder"),tagsHint:this.translationService.translate("taskEditor.tagsHint"),subtasksHint:this.translationService.translate("taskEditor.subtasksHint"),makeRecurring:this.translationService.translate("taskEditor.makeRecurring"),repeatEvery:this.translationService.translate("taskEditor.repeatEvery"),recurrencePreview:this.translationService.translate("taskEditor.recurrencePreview"),repeatsEvery:this.translationService.translate("taskEditor.repeatsEvery"),until:this.translationService.translate("taskEditor.until"),max:this.translationService.translate("taskEditor.max"),occurrences:this.translationService.translate("taskEditor.occurrences")}));todo=null;isSubtask=!1;defaultProjectId;save=new K;close=new K;titleTextareaRef;isOpenSignal=I(!1);isOpen=this.isOpenSignal.asReadonly();tagInput="";timerInterval;elapsedTime=I(0);get today(){let e=new Date;return e.setMinutes(e.getMinutes()-e.getTimezoneOffset()),e.toISOString().slice(0,16)}isEditing=!1;formData={title:"",description:"",priority:this.settingsService.getDefaultPriorityForNewTask(),dueDate:"",startDateTime:"",endDateTime:"",durationHours:0,durationMinutes:0,category:"",completed:!1,archived:!1,tags:[],isRecurring:!1,recurrenceType:"daily",recurrenceInterval:1,recurrenceEndDate:"",recurrenceMaxOccurrences:null,targetCount:null,currentCount:null,countUnit:""};onKeydown(){this.onClose()}isMouseDownInsideModal=!1;onMousedown(e){let t=e.target;this.isMouseDownInsideModal=!!t.closest(".modal-content"),e.stopPropagation()}onMouseup(e){setTimeout(()=>{this.isMouseDownInsideModal=!1},0)}ngOnInit(){this.todo&&this.todoService.isTaskActive(this.todo.id)&&this.startTimer()}ngOnDestroy(){this.stopTimer()}ngAfterViewInit(){this.isOpen()&&this.formData.title&&(setTimeout(()=>this.resizeTitleTextarea(),0),setTimeout(()=>this.resizeTitleTextarea(),100))}ngOnChanges(e){if(e.todo&&e.todo.currentValue){if(this.isEditing=!0,this.todo){let t=this.todo.duration?Math.floor(this.todo.duration/60):0,i=this.todo.duration?this.todo.duration%60:0;this.formData={title:this.todo.title,description:this.todo.description||"",priority:this.todo.priority,dueDate:this.todo.dueDate?this.formatDateForInput(this.todo.dueDate):"",startDateTime:this.todo.startDateTime?this.formatDateForInput(this.todo.startDateTime):"",endDateTime:this.todo.endDateTime?this.formatDateForInput(this.todo.endDateTime):"",durationHours:t,durationMinutes:i,category:this.todo.category||"",projectId:this.todo.projectId,completed:this.todo.completed,archived:this.todo.archived,tags:this.todo.tags?[...this.todo.tags]:[],isRecurring:this.todo.isRecurring||!1,recurrenceType:this.todo.recurrencePattern?.type||"daily",recurrenceInterval:this.todo.recurrencePattern?.interval||1,recurrenceEndDate:this.todo.recurrencePattern?.endDate?this.formatDateForInput(this.todo.recurrencePattern.endDate):"",recurrenceMaxOccurrences:this.todo.recurrencePattern?.maxOccurrences||null,targetCount:this.todo.targetCount||null,currentCount:this.todo.currentCount||null,countUnit:this.todo.countUnit||""},setTimeout(()=>this.resizeTitleTextarea(),0),setTimeout(()=>this.resizeTitleTextarea(),100),this.todoService.isTaskActive(this.todo.id)?this.startTimer():this.stopTimer()}}else this.defaultProjectId?(this.isEditing=!1,this.resetForm(),this.formData.projectId=this.defaultProjectId):(this.isEditing=!1,this.resetForm())}open(){this.isOpenSignal.set(!0),setTimeout(()=>{let e=document.querySelector('.modal-content textarea[name="title"]');e&&(this.autoResizeTextarea(e),e.focus())},100)}onOverlayClick(e){e.target===e.currentTarget&&!this.isMouseDownInsideModal&&this.onClose(),this.isMouseDownInsideModal=!1}onClose(){this.close.emit(),this.isOpenSignal.set(!1)}onSubmit(){return k(this,null,function*(){if(!this.formData.title.trim())return;let e=(this.formData.durationHours||0)*60+(this.formData.durationMinutes||0),t={title:this.formData.title.trim(),description:this.formData.description.trim()||void 0,priority:this.formData.priority,dueDate:this.formData.dueDate?new Date(this.formData.dueDate):void 0,startDateTime:this.formData.startDateTime?new Date(this.formData.startDateTime):void 0,endDateTime:this.formData.endDateTime?new Date(this.formData.endDateTime):void 0,duration:e>0?e:void 0,category:this.formData.category.trim()||void 0,projectId:this.formData.projectId,completed:this.formData.completed,tags:this.formData.tags.length>0?this.formData.tags:void 0,targetCount:this.formData.targetCount&&this.formData.targetCount>0?this.formData.targetCount:void 0,currentCount:this.formData.targetCount&&this.formData.targetCount>0?this.formData.currentCount||0:void 0,countUnit:this.formData.targetCount&&this.formData.countUnit.trim()?this.formData.countUnit.trim():void 0};if(this.formData.isRecurring&&!this.isSubtask){let i={type:this.formData.recurrenceType,interval:this.formData.recurrenceInterval,endDate:this.formData.recurrenceEndDate?new Date(this.formData.recurrenceEndDate):void 0,maxOccurrences:this.formData.recurrenceMaxOccurrences||void 0,currentOccurrences:0};t.isRecurring=!0,t.recurrencePattern=i;let n=t.dueDate||new Date;t.nextDueDate=this.recurringTasksService.calculateNextDueDate(n,i)}else!this.formData.isRecurring&&this.isEditing&&this.todo?.isRecurring&&(t.isRecurring=!1,t.recurrencePattern=void 0,t.nextDueDate=void 0);!this.isEditing&&this.settingsService.useLastChosenPriority&&this.saveLastUsedPriority(this.formData.priority),this.save.emit(t)})}resetForm(){this.formData={title:"",description:"",priority:this.settingsService.getDefaultPriorityForNewTask(),dueDate:"",startDateTime:"",endDateTime:"",durationHours:0,durationMinutes:0,category:"",projectId:void 0,completed:!1,archived:!1,tags:[],isRecurring:!1,recurrenceType:"daily",recurrenceInterval:1,recurrenceEndDate:"",recurrenceMaxOccurrences:null,targetCount:null,currentCount:null,countUnit:""}}getLastUsedPriority(){try{let e=localStorage.getItem("taskEditor.lastPriority");if(e&&["low","medium","high"].includes(e))return e}catch(e){console.warn("Failed to load last used priority from localStorage:",e)}return"medium"}saveLastUsedPriority(e){try{localStorage.setItem("taskEditor.lastPriority",e)}catch(t){console.warn("Failed to save last used priority to localStorage:",t)}}closeAndReset(){this.isOpenSignal.set(!1),this.resetForm()}setDueDateToNow(){this.formData.dueDate=this.formatDateForInput(new Date)}setStartDateTimeToNow(){this.formData.startDateTime=this.formatDateForInput(new Date),this.onStartDateTimeChange()}setEndDateTimeToNow(){this.formData.endDateTime=this.formatDateForInput(new Date),this.onEndDateTimeChange()}onStartDateTimeChange(){if(!this.formData.startDateTime){this.formData.endDateTime="";return}this.calculateDurationFromDates()}onEndDateTimeChange(){this.calculateDurationFromDates()}onDurationChange(){if(this.formData.startDateTime&&(this.formData.durationHours||this.formData.durationMinutes)){let e=new Date(this.formData.startDateTime),t=(this.formData.durationHours||0)*60+(this.formData.durationMinutes||0),i=new Date(e.getTime()+t*6e4),n=new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().slice(0,16);this.formData.endDateTime=n}}onPriorityChange(e){!this.isEditing&&this.settingsService.useLastChosenPriority&&this.saveLastUsedPriority(e)}calculateDurationFromDates(){if(this.formData.startDateTime&&this.formData.endDateTime){let e=new Date(this.formData.startDateTime),t=new Date(this.formData.endDateTime);if(t>e){let i=t.getTime()-e.getTime(),n=Math.floor(i/(1e3*60));this.formData.durationHours=Math.floor(n/60),this.formData.durationMinutes=n%60}}}formatDateForInput(e){let t=new Date(e);return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)}onTagInputKeydown(e){(e.key==="Enter"||e.key===",")&&(e.preventDefault(),this.addTagFromInput())}addTagFromInput(){if(!this.tagInput.trim())return;let e=[];this.tagInput.includes("#")?e=this.tagsService.parseTagsFromText(this.tagInput):e=this.tagInput.split(",").map(t=>t.trim()).filter(t=>t.length>0);for(let t of e)this.addTag(t);this.tagInput=""}addTag(e){let t=e.trim().toLowerCase();t&&!this.formData.tags.includes(t)&&(this.formData.tags.push(t),this.tagsService.autoCreateTags([t]))}removeTag(e){this.formData.tags.splice(e,1)}getTagColor(e){return this.tagsService.getTagByName(e)?.color||"#6b7280"}getTagTextColor(e){let i=this.getTagColor(e).replace("#",""),n=parseInt(i.substr(0,2),16),s=parseInt(i.substr(2,2),16),y=parseInt(i.substr(4,2),16);return(n*299+s*587+y*114)/1e3>128?"#000000":"#ffffff"}onRecurringToggle(){this.formData.isRecurring||(this.formData.recurrenceType="daily",this.formData.recurrenceInterval=1,this.formData.recurrenceEndDate="",this.formData.recurrenceMaxOccurrences=null)}getRecurrencePreview(){if(!this.formData.isRecurring)return"";let e=this.formData.recurrenceInterval===1?"":`${this.formData.recurrenceInterval} `,t=this.formData.recurrenceType==="daily"?this.translations().day:this.formData.recurrenceType==="weekly"?this.translations().week:this.translations().month,i=this.formData.recurrenceInterval===1?t:this.formData.recurrenceType==="daily"?this.translations().days:this.formData.recurrenceType==="weekly"?this.translations().weeks:this.translations().months,n=`${this.translations().repeatsEvery} ${e}${i}`;if(this.formData.recurrenceEndDate){let s=new Date(this.formData.recurrenceEndDate).toLocaleDateString();n+=` ${this.translations().until} ${s}`}return this.formData.recurrenceMaxOccurrences&&(n+=` (${this.translations().max} ${this.formData.recurrenceMaxOccurrences} ${this.translations().occurrences})`),n}onTextareaKeydown(e){if(e.key==="Tab"){e.preventDefault();let t=e.target,i=t.selectionStart,n=t.selectionEnd,s="  ",y=t.value,C=y.substring(0,i)+s+y.substring(n);this.formData.description=C,setTimeout(()=>{t.selectionStart=t.selectionEnd=i+s.length},0)}}onTitleInput(e){let t=e.target;this.autoResizeTextarea(t)}onTitleKeydown(e){e.key==="Enter"&&(e.preventDefault(),this.onSubmit())}autoResizeTextarea(e){e.style.height="auto",e.style.height=e.scrollHeight+"px"}resizeTitleTextarea(){if(this.titleTextareaRef?.nativeElement)this.autoResizeTextarea(this.titleTextareaRef.nativeElement);else{let e=document.querySelector(".title-textarea");e&&this.autoResizeTextarea(e)}}onDateTimeKeydown(e,t){if(e.key==="ArrowUp"||e.key==="ArrowDown"){let i=e.target,n=i.value;if(!n)return;let s=i.selectionStart||0,y=n.lastIndexOf(":");if(console.log("DateTime keydown debug:",{key:e.key,currentValue:n,cursorPosition:s,minutesStartIndex:y,inMinutesField:s>y}),s>y){let C=new Date(n),B=C.getMinutes();if(console.log("Current minutes:",B),e.key==="ArrowUp"&&B===59){console.log("Handling ArrowUp at 59 minutes"),e.preventDefault(),e.stopPropagation(),C.setHours(C.getHours()+1),C.setMinutes(0);let M=this.formatDateForInput(C);console.log("Setting new value:",M),this.updateFormField(t,M),setTimeout(()=>{i.setSelectionRange(y+1,y+3)},10)}else if(e.key==="ArrowDown"&&B===0){console.log("Handling ArrowDown at 0 minutes"),e.preventDefault(),e.stopPropagation(),C.setHours(C.getHours()-1),C.setMinutes(59);let M=this.formatDateForInput(C);console.log("Setting new value:",M),this.updateFormField(t,M),setTimeout(()=>{i.setSelectionRange(y+1,y+3)},10)}}}}updateFormField(e,t){this.formData[e]=t,e==="startDateTime"?this.onStartDateTimeChange():e==="endDateTime"&&this.onEndDateTimeChange()}startTimer(){this.stopTimer(),this.updateElapsedTime(),this.timerInterval=window.setInterval(()=>{this.updateElapsedTime()},1e3)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=void 0)}updateElapsedTime(){if(this.todo){let e=this.todoService.getElapsedTime(this.todo.id);this.elapsedTime.set(e)}}isTaskActive(){return this.todo?this.todoService.isTaskActive(this.todo.id):!1}onStartWork(e){return k(this,null,function*(){if(e.stopPropagation(),!!this.todo)try{if(this.todo.completed){let t=yield this.todoService.duplicateAndStartWork(this.todo.id);this.startTimer(),console.log("Duplicated completed task and started working on new task:",t)}else yield this.todoService.startWork(this.todo.id),this.startTimer()}catch(t){console.error("Failed to start work:",t)}})}onStopWork(e,t=!1){return k(this,null,function*(){if(e.stopPropagation(),!!this.todo)try{yield this.todoService.stopWork(this.todo.id,t),this.stopTimer(),this.elapsedTime.set(0)}catch(i){console.error("Failed to stop work:",i)}})}formatElapsedTime(e){if(e<60)return`${e}m`;let t=Math.floor(e/60),i=e%60;return i===0?`${t}h`:`${t}h ${i}m`}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=V({type:l,selectors:[["app-task-editor"]],viewQuery:function(t,i){if(t&1&&G(zt,5),t&2){let n;Q(n=J())&&(i.titleTextareaRef=n.first)}},hostBindings:function(t,i){t&1&&f("keydown.escape",function(){return i.onKeydown()})("mousedown",function(s){return i.onMousedown(s)})("mouseup",function(s){return i.onMouseup(s)})},inputs:{todo:"todo",isSubtask:"isSubtask",defaultProjectId:"defaultProjectId"},outputs:{save:"save",close:"close"},features:[q],decls:1,vars:1,consts:[["titleInput","","titleTextarea",""],["class","modal-overlay",3,"click",4,"ngIf"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"close-btn",3,"click"],["width","20","height","20","viewBox","0 0 20 20","fill","currentColor"],["d","M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"],[1,"modal-form",3,"ngSubmit"],[1,"form-group"],[1,"form-label"],["name","title","required","","rows","1",1,"form-input","title-textarea",3,"ngModelChange","input","keydown","ngModel","placeholder"],["name","description","rows","3",1,"form-input",3,"ngModelChange","keydown","ngModel","placeholder"],[1,"form-row"],["name","priority",1,"form-input","priority-select",3,"ngModelChange","ngClass","ngModel"],["value","low"],["value","medium"],["value","high"],[1,"date-input-group"],["type","datetime-local","name","dueDate",1,"form-input",3,"ngModelChange","keydown","ngModel","min"],["type","button",1,"btn","btn-secondary","btn-now",3,"click"],["type","datetime-local","name","startDateTime",1,"form-input",3,"ngModelChange","change","keydown","ngModel","min"],["type","datetime-local","name","endDateTime",1,"form-input",3,"ngModelChange","change","keydown","ngModel","min"],[1,"duration-input-group"],["type","number","name","durationHours","placeholder","0","min","0","max","23",1,"form-input","duration-input",3,"ngModelChange","change","ngModel"],[1,"duration-label"],["type","number","name","durationMinutes","placeholder","0","min","0","max","59",1,"form-input","duration-input",3,"ngModelChange","change","ngModel"],[1,"form-hint"],["type","text","name","category","list","categories",1,"form-input",3,"ngModelChange","ngModel","placeholder"],["id","categories"],[3,"value"],[1,"tags-input-container"],[1,"tags-display"],["class","tag-chip",3,"background-color","color",4,"ngFor","ngForOf"],["type","text","name","tagInput","list","existing-tags",1,"form-input","tags-input",3,"ngModelChange","keydown","blur","ngModel","placeholder"],["id","existing-tags"],[3,"value",4,"ngFor","ngForOf"],[1,"form-row","counter-row"],["type","number","name","targetCount","placeholder","e.g., 5","min","1","max","999",1,"form-input","counter-input",3,"ngModelChange","ngModel"],["type","text","name","countUnit","placeholder","e.g., workouts, chapters","list","countUnits",1,"form-input","unit-input",3,"ngModelChange","ngModel"],["id","countUnits"],["value","workouts"],["value","chapters"],["value","calls"],["value","sessions"],["value","pages"],["value","exercises"],["value","meetings"],["value","items"],["class","form-hint counter-hint",4,"ngIf"],["class","form-row",4,"ngIf"],["class","form-group",4,"ngIf"],["class","working-sessions-section",4,"ngIf"],[1,"modal-actions"],["class","btn btn-secondary",3,"routerLink","queryParams","click",4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"tag-chip"],["type","button",1,"tag-remove",3,"click","title"],[1,"form-hint","counter-hint"],["name","projectId",1,"form-input",3,"ngModelChange","ngModel","disabled","title"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["class","form-hint",4,"ngIf"],[1,"checkbox-group"],[1,"checkbox-label"],["type","checkbox","name","isRecurring",3,"ngModelChange","change","ngModel"],[1,"checkmark"],["class","recurring-options",4,"ngIf"],[1,"recurring-options"],[1,"repeat-input-group"],["type","number","name","recurrenceInterval","min","1","max","365",1,"form-input","repeat-interval",3,"ngModelChange","ngModel"],["name","recurrenceType",1,"form-input","repeat-type",3,"ngModelChange","ngModel"],["value","daily"],["value","weekly"],["value","monthly"],["type","date","name","recurrenceEndDate",1,"form-input",3,"ngModelChange","ngModel","placeholder"],["type","number","name","recurrenceMaxOccurrences","min","1",1,"form-input",3,"ngModelChange","ngModel","placeholder"],[1,"working-sessions-section"],[3,"todo"],[1,"btn","btn-secondary",3,"click","routerLink","queryParams"]],template:function(t,i){t&1&&w(0,Jt,121,64,"div",1),t&2&&u("ngIf",i.isOpen())},dependencies:[H,tt,W,F,R,at,ct,dt,z,st,it,lt,L,ot,ut,pt,mt,j,rt,nt,et,U],styles:['.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;width:100%;max-width:900px;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px -12px #00000040;animation:_ngcontent-%COMP%_modalSlideIn .3s ease-out}@keyframes _ngcontent-%COMP%_modalSlideIn{0%{opacity:0;transform:scale(.95) translateY(-20px)}to{opacity:1;transform:scale(1) translateY(0)}}.modal-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:24px 24px 0;border-bottom:1px solid #e5e7eb;margin-bottom:24px}.modal-title[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#111827;margin:0}.close-btn[_ngcontent-%COMP%]{background:none;border:none;color:#6b7280;cursor:pointer;padding:8px;border-radius:6px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.close-btn[_ngcontent-%COMP%]:hover{background:#f3f4f6;color:#374151}.modal-form[_ngcontent-%COMP%]{padding:0 24px 24px}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.duration-input-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.duration-input[_ngcontent-%COMP%]{width:60px!important;text-align:center}.duration-label[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;font-weight:500}.form-hint[_ngcontent-%COMP%]{display:block;margin-top:4px;font-size:11px;color:#6b7280;font-style:italic}.form-label[_ngcontent-%COMP%]{display:block;margin-bottom:6px;font-weight:500;color:#374151;font-size:14px}.form-input[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;transition:all .2s ease;background:#fff;box-sizing:border-box;font-family:inherit}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.form-input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}textarea.form-input[_ngcontent-%COMP%]{resize:vertical;min-height:80px;line-height:1.5}.title-textarea[_ngcontent-%COMP%]{resize:none!important;overflow:hidden;min-height:auto!important;line-height:1.4;font-size:16px;font-weight:500}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}select.form-input[_ngcontent-%COMP%]{cursor:pointer}.priority-select[_ngcontent-%COMP%]{appearance:none;-webkit-appearance:none;-moz-appearance:none;padding-right:2rem}.priority-select.priority-low[_ngcontent-%COMP%]{border-color:#10b981;box-shadow:0 0 0 2px #10b98126}.priority-select.priority-medium[_ngcontent-%COMP%]{border-color:#f59e0b;box-shadow:0 0 0 2px #f59e0b26}.priority-select.priority-high[_ngcontent-%COMP%]{border-color:#ef4444;box-shadow:0 0 0 2px #ef444426}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:12px;justify-content:flex-end;margin-top:32px;padding-top:20px;border-top:1px solid #e5e7eb}.btn[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:8px;min-width:100px;justify-content:center}.btn-primary[_ngcontent-%COMP%]{background:#3b82f6;color:#fff;box-shadow:0 1px 2px #0000000d}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#2563eb;box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f}.btn-primary[_ngcontent-%COMP%]:disabled{background:#9ca3af;cursor:not-allowed;box-shadow:none}.btn-secondary[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151;border:1px solid #d1d5db}.btn-secondary[_ngcontent-%COMP%]:hover{background:#e5e7eb;border-color:#9ca3af}.tags-input-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.tags-display[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px;min-height:24px}.tag-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:4px;padding:4px 8px;border-radius:12px;font-size:.75rem;font-weight:500;white-space:nowrap;border:1px solid rgba(255,255,255,.2)}.tag-remove[_ngcontent-%COMP%]{background:none;border:none;color:inherit;cursor:pointer;font-size:.875rem;font-weight:700;padding:0;margin:0;width:16px;height:16px;border-radius:50%;display:flex;align-items:center;justify-content:center;opacity:.7;transition:opacity .2s ease}.tag-remove[_ngcontent-%COMP%]:hover{opacity:1;background:#fff3}.tags-input[_ngcontent-%COMP%]{margin-top:0}@media (max-width: 640px){.modal-overlay[_ngcontent-%COMP%]{padding:10px}.modal-content[_ngcontent-%COMP%]{max-width:100%;border-radius:8px}.modal-header[_ngcontent-%COMP%]{padding:20px 20px 0}.modal-form[_ngcontent-%COMP%]{padding:0 20px 20px}.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:12px}.modal-actions[_ngcontent-%COMP%]{flex-direction:column}.btn[_ngcontent-%COMP%]{width:100%}.working-sessions-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.75rem}.start-work-btn[_ngcontent-%COMP%], .stop-work-btn[_ngcontent-%COMP%], .finish-work-btn[_ngcontent-%COMP%]{font-size:.8rem;padding:.4rem .8rem}}.checkbox-group[_ngcontent-%COMP%]{margin-bottom:1rem}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;font-weight:500;color:var(--text-primary);gap:.5rem}.checkbox-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin:0;width:18px;height:18px;accent-color:var(--primary-color);cursor:pointer}.checkmark[_ngcontent-%COMP%]{font-size:1rem}.recurring-options[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:1rem;margin-top:.75rem;animation:_ngcontent-%COMP%_slideDown .2s ease-out}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.repeat-input-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.repeat-interval[_ngcontent-%COMP%]{width:80px;flex-shrink:0}.repeat-type[_ngcontent-%COMP%]{flex:1;min-width:120px}.recurring-options[_ngcontent-%COMP%]   .form-hint[_ngcontent-%COMP%]{color:#059669;font-weight:500;background:#10b9811a;padding:.5rem;border-radius:4px;border-left:3px solid #10b981;margin-top:.75rem}.date-input-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.date-input-group[_ngcontent-%COMP%]   .form-input[_ngcontent-%COMP%]{flex:1}.btn-now[_ngcontent-%COMP%]{min-width:auto;padding:10px 12px}.working-sessions-section[_ngcontent-%COMP%]{margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border-color)}.working-sessions-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin:0 0 1rem;font-size:1.1rem;font-weight:600;color:var(--text-color);display:flex;align-items:center;gap:.5rem}.working-sessions-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]:before{content:"\\23f1\\fe0f";font-size:1.2rem}.working-sessions-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;flex-wrap:wrap;gap:1rem}.start-work-btn[_ngcontent-%COMP%], .stop-work-btn[_ngcontent-%COMP%], .finish-work-btn[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.5rem 1rem;font-size:.875rem;font-weight:500;border:none;border-radius:6px;cursor:pointer;transition:all .2s ease;white-space:nowrap}.start-work-btn[_ngcontent-%COMP%]{background:#10b981;color:#fff}.start-work-btn[_ngcontent-%COMP%]:hover{background:#059669;transform:translateY(-1px);box-shadow:0 4px 8px #10b9814d}.stop-work-btn[_ngcontent-%COMP%]{background:#f59e0b;color:#fff}.stop-work-btn[_ngcontent-%COMP%]:hover{background:#d97706;transform:translateY(-1px);box-shadow:0 4px 8px #f59e0b4d}.finish-work-btn[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.finish-work-btn[_ngcontent-%COMP%]:hover{background:#2563eb;transform:translateY(-1px);box-shadow:0 4px 8px #3b82f64d}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}.counter-row[_ngcontent-%COMP%]{gap:1rem}.counter-input[_ngcontent-%COMP%]{max-width:120px}.unit-input[_ngcontent-%COMP%]{flex:1;min-width:150px}.counter-hint[_ngcontent-%COMP%]{margin-top:.5rem;color:var(--text-muted);font-style:italic}.counter-hint[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.counter-hint[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]:before{content:"\\2139\\fe0f";font-size:.875rem}']})};export{vt as a};
