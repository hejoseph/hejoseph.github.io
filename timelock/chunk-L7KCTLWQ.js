import{a as te}from"./chunk-LZUYF342.js";import{p as ee}from"./chunk-4S5ZFXBH.js";import{B as R,D as g,E as u,Ga as F,Ha as Q,Ia as $,L as x,Ma as S,R as r,Sa as j,Ta as q,Ua as G,Va as J,W,Wa as K,Xa as U,_ as T,c as H,ea as B,eb as Z,fa as L,ga as Y,ha as m,ia as s,ja as l,ka as y,la as k,ma as D,na as O,oa as h,pa as p,qa as A,ra as z,sa as X,ua as v,va as P,wa as V,xa as c,ya as w,za as C}from"./chunk-DXUJ3RU3.js";var re=["taskEditor"];function le(o,t){if(o&1&&(c(0),F(1,"date")),o&2){let e=p();C(" ",$(1,1,e.selectedDate(),"fullDate")," ")}}function se(o,t){if(o&1&&c(0),o&2){let e=p();C(" ",e.formatWeekRange(e.weekStart())," ")}}function ce(o,t){if(o&1&&(s(0,"div",23),c(1),F(2,"date"),l()),o&2){let e=t.$implicit;r(),w($(2,1,e,"EEE MMM d"))}}function de(o,t){if(o&1&&(s(0,"div",20),y(1,"div",21),T(2,ce,3,4,"div",22),l()),o&2){let e=p();v("grid-template-columns","60px repeat(7, 1fr)"),r(2),m("ngForOf",e.weekDays())}}function pe(o,t){if(o&1&&(k(0),s(1,"div",24),c(2),l(),D()),o&2){let e=t.$implicit,i=p();r(),v("grid-row",e*12+6+" / span 1"),r(),w(i.formatHour(e))}}function me(o,t){if(o&1&&(k(0),y(1,"div",25),D()),o&2){let e=t.$implicit;r(),v("grid-row",e+1+" / span 1"),P("hour-line",e%12===0)}}function ge(o,t){if(o&1&&(k(0),y(1,"div",26),D()),o&2){let e=t.$implicit;r(),v("grid-row",e*6+1+" / span 1")}}function ue(o,t){if(o&1){let e=O();s(0,"a",28),h("click",function(n){let a=g(e).$implicit,d=p(2);return n.preventDefault(),u(d.openEditor(a.todo))})("mouseenter",function(n){let a=g(e).$implicit,d=p(2);return u(d.showTooltip(n,a))})("mousemove",function(n){g(e);let a=p(2);return u(a.moveTooltip(n))})("mouseleave",function(){g(e);let n=p(2);return u(n.hideTooltip())}),s(1,"div",29)(2,"div",30),c(3),l(),s(4,"div",31),c(5),l()()()}if(o&2){let e=t.$implicit,i=p(2);V("priority-"+e.todo.priority),v("grid-row",e.rowStart+" / "+e.rowEnd),B("aria-describedby",i.tooltipVisible()&&i.isTooltipFor(e)?"tt-"+e.todo.id:null),r(3),w(e.todo.title),r(2),w(e.displayTime)}}function _e(o,t){if(o&1&&(k(0),T(1,ue,6,7,"a",27),D()),o&2){let e=p();r(),m("ngForOf",e.timetableBlocksDay())}}function fe(o,t){if(o&1){let e=O();s(0,"a",33),h("click",function(n){let a=g(e).$implicit,d=p(2);return n.preventDefault(),u(d.openEditor(a.todo))})("mouseenter",function(n){let a=g(e).$implicit,d=p(2);return u(d.showTooltip(n,a))})("mousemove",function(n){g(e);let a=p(2);return u(a.moveTooltip(n))})("mouseleave",function(){g(e);let n=p(2);return u(n.hideTooltip())}),s(1,"div",29)(2,"div",30),c(3),l(),s(4,"div",31),c(5),l()()()}if(o&2){let e=t.$implicit,i=p(2);V("priority-"+e.todo.priority),v("grid-row",e.rowStart+" / "+e.rowEnd)("grid-column",e.col+1+" / "+(e.col+2)),B("aria-describedby",i.tooltipVisible()&&i.isTooltipFor(e)?"tt-"+e.todo.id:null),r(3),w(e.todo.title),r(2),w(e.displayTime)}}function be(o,t){if(o&1&&(k(0),T(1,fe,6,9,"a",32),D()),o&2){let e=p();r(),m("ngForOf",e.timetableBlocksWeek())}}function he(o,t){if(o&1&&(s(0,"div",38)(1,"span",39),c(2,"Category:"),l(),c(3),l()),o&2){let e=p().ngIf;r(3),C(" ",e.todo.category)}}function we(o,t){if(o&1&&(s(0,"div",42),c(1),l()),o&2){let e=p().ngIf;r(),w(e.todo.description)}}function xe(o,t){if(o&1&&(s(0,"div",34)(1,"div",35),y(2,"span",36),s(3,"span",37),c(4),l()(),s(5,"div",38)(6,"span",39),c(7,"When:"),l(),c(8),l(),s(9,"div",38)(10,"span",39),c(11,"Priority:"),l(),c(12),F(13,"titlecase"),l(),T(14,he,4,1,"div",40)(15,we,2,1,"div",41),l()),o&2){let e=t.ngIf,i=p();v("left",i.tooltipX(),"px")("top",i.tooltipY(),"px"),m("id","tt-"+e.todo.id),r(2),V("prio-"+e.todo.priority),r(2),w(e.todo.title),r(4),C(" ",e.displayTime),r(4),C(" ",Q(13,12,e.todo.priority)),r(2),m("ngIf",e.todo.category),r(),m("ngIf",e.todo.description)}}function Te(o,t){o&1&&(s(0,"div",43)(1,"div",44),c(2,"\u{1F5D3}\uFE0F"),l(),s(3,"h3"),c(4,"No scheduled tasks for this day"),l(),s(5,"p"),c(6,"Tasks with a start and end time will appear here with accurate spacing."),l()())}function ye(o,t){o&1&&(s(0,"div",43)(1,"div",44),c(2,"\u{1F5D3}\uFE0F"),l(),s(3,"h3"),c(4,"No scheduled tasks for this week"),l(),s(5,"p"),c(6,"Tasks with a start and end time will appear here with accurate spacing."),l()())}var ie=class o{taskEditor;editingTodo=x(null);tooltipVisible=x(!1);tooltipBlock=x(null);tooltipX=x(0);tooltipY=x(0);showTooltip(t,e){this.tooltipBlock.set(e),this.tooltipVisible.set(!0),this.positionTooltip(t)}moveTooltip(t){this.tooltipVisible()&&this.positionTooltip(t)}hideTooltip(){this.tooltipVisible.set(!1),this.tooltipBlock.set(null)}positionTooltip(t){let a=t.clientX+12,d=t.clientY+12,_=window.innerWidth,f=window.innerHeight;a+280>_&&(a=Math.max(8,t.clientX-280-12)),d+140>f&&(d=Math.max(8,t.clientY-140-12)),this.tooltipX.set(a),this.tooltipY.set(d)}todoService=R(ee);openEditor(t){this.editingTodo.set(t),setTimeout(()=>this.taskEditor?.open())}closeEditor(){this.taskEditor?.closeAndReset?.(),this.editingTodo.set(null)}onSave(t){return H(this,null,function*(){let e=this.editingTodo();if(e)try{yield this.todoService.updateTodo(e.id,t),this.closeEditor()}catch(i){if(i&&i.message==="OVERLAP_CANCELLED")return;console.error("Failed to update task:",i)}})}currentViewSignal=x("day");currentView=this.currentViewSignal.asReadonly();selectedDateSignal=x(new Date);selectedDate=this.selectedDateSignal.asReadonly();hours=Array.from({length:24},(t,e)=>e);fiveMinutes=Array.from({length:288},(t,e)=>e);halfHours=Array.from({length:48},(t,e)=>e);setView(t){this.currentViewSignal.set(t)}previous(){return this.currentView()==="day"?this.previousDay():this.previousWeek()}next(){return this.currentView()==="day"?this.nextDay():this.nextWeek()}flattenTodos(t){let e=[];for(let i of t)e.push(i),i.subtasks&&i.subtasks.length>0&&e.push(...this.flattenTodos(i.subtasks));return e}scheduledForDay=S(()=>{let t=this.selectedDate();return this.flattenTodos(this.todoService.todos()).filter(i=>!i.archived&&i.startDateTime&&i.endDateTime&&this.isTaskOnDate(i,t))});timetableBlocksDay=S(()=>{let t=this.selectedDate(),e=new Date(t);e.setHours(0,0,0,0);let i=new Date(t);return i.setHours(23,59,59,999),this.scheduledForDay().map(n=>{let a=new Date(n.startDateTime),d=new Date(n.endDateTime),_=a<e?e:a,f=d>i?i:d,I=this.timeToRow(_),b=Math.max(I+1,this.timeToRowEnd(f));return{todo:n,rowStart:I,rowEnd:b,displayTime:this.getDisplayRange(n)}}).sort((n,a)=>n.rowStart-a.rowStart)});getStartOfWeek(t){let e=new Date(t),i=e.getDay(),n=e.getDate()-i;return e.setDate(n),e.setHours(0,0,0,0),e}weekStart=S(()=>this.getStartOfWeek(this.selectedDate()));weekDays=S(()=>{let t=this.weekStart();return Array.from({length:7},(e,i)=>{let n=new Date(t);return n.setDate(t.getDate()+i),n})});timetableBlocksWeek=S(()=>{let t=this.flattenTodos(this.todoService.todos()).filter(a=>!a.archived&&a.startDateTime&&a.endDateTime),e=this.weekStart(),i=this.weekDays(),n=[];return i.forEach((a,d)=>{let _=new Date(a);_.setHours(0,0,0,0);let f=new Date(a);f.setHours(23,59,59,999),t.filter(b=>{let M=new Date(b.startDateTime),E=new Date(b.endDateTime);return M<=f&&E>=_}).forEach(b=>{let M=new Date(b.startDateTime),E=new Date(b.endDateTime),ne=M<_?_:M,oe=E>f?f:E,N=this.timeToRow(ne),ae=Math.max(N+1,this.timeToRowEnd(oe));n.push({todo:b,rowStart:N,rowEnd:ae,displayTime:this.getDisplayRange(b,!0),col:d+1})})}),n.sort((a,d)=>a.col-d.col||a.rowStart-d.rowStart)});previousDay(){let t=this.selectedDate(),e=new Date(t);e.setDate(t.getDate()-1),this.selectedDateSignal.set(e)}nextDay(){let t=this.selectedDate(),e=new Date(t);e.setDate(t.getDate()+1),this.selectedDateSignal.set(e)}previousWeek(){let t=this.selectedDate(),e=new Date(t);e.setDate(t.getDate()-7),this.selectedDateSignal.set(e)}nextWeek(){let t=this.selectedDate(),e=new Date(t);e.setDate(t.getDate()+7),this.selectedDateSignal.set(e)}goToToday(){this.selectedDateSignal.set(new Date)}isToday(t){let e=new Date;return this.isSameDay(t,e)}isSameDay(t,e){return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}isTaskOnDate(t,e){if(!t.startDateTime&&!t.endDateTime)return!1;let i=t.startDateTime?new Date(t.startDateTime):null,n=t.endDateTime?new Date(t.endDateTime):null,a=new Date(e);a.setHours(0,0,0,0);let d=new Date(e);return d.setHours(23,59,59,999),i&&n?i<=d&&n>=a:!1}timeToRow(t){let e=t.getHours()*60+t.getMinutes();return Math.floor(e/5)+1}timeToRowEnd(t){let e=t.getHours()*60+t.getMinutes();return Math.ceil(e/5)+1}formatHour(t){let e=new Date;return e.setHours(t,0,0,0),e.toLocaleTimeString([],{hour:"numeric",hour12:!0})}formatWeekRange(t){let e=new Date(t);e.setDate(t.getDate()+6);let i=t.toLocaleDateString([],{month:"short",day:"numeric"}),n=e.toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"});return`${i} - ${n}`}isTooltipFor(t){let e=this.tooltipBlock();return!!e&&e.todo.id===t.todo.id}getDisplayRange(t,e=!1){let i=new Date(t.startDateTime),n=new Date(t.endDateTime),a={hour:"numeric",minute:"2-digit",hour12:!0};if(!e)return`${i.toLocaleTimeString([],a)} - ${n.toLocaleTimeString([],a)}`;let d={weekday:"short"},_=i.toLocaleDateString([],d),f=n.toLocaleDateString([],d);return this.isSameDay(i,n)?`${_} ${i.toLocaleTimeString([],a)} - ${n.toLocaleTimeString([],a)}`:`${_} ${i.toLocaleTimeString([],a)} - ${f} ${n.toLocaleTimeString([],a)}`}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=W({type:o,selectors:[["app-timetable"]],viewQuery:function(e,i){if(e&1&&A(re,5),e&2){let n;z(n=X())&&(i.taskEditor=n.first)}},decls:41,vars:18,consts:[["taskEditor",""],[1,"timetable-container"],[1,"timetable-header"],[1,"date-controls"],[1,"view-controls"],[1,"nav-btn",3,"click"],[1,"nav-btn",3,"click","disabled"],[1,"current-date"],[1,"legend"],[1,"legend-item"],[1,"legend-color","priority-high"],[1,"legend-color","priority-medium"],[1,"legend-color","priority-low"],["class","day-headers",3,"gridTemplateColumns",4,"ngIf"],[1,"timetable-grid",3,"ngClass"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","task-tooltip floating","role","tooltip",3,"id","left","top",4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"save","close","todo","isSubtask"],[1,"day-headers"],[1,"time-spacer"],["class","day-header",4,"ngFor","ngForOf"],[1,"day-header"],[1,"time-label"],[1,"grid-line",2,"grid-column","1 / -1","opacity","0.3"],[1,"grid-line","hour-line",2,"grid-column","1 / -1"],["class","task-block","href","#","style","grid-column: 2 / 3",3,"gridRow","class","click","mouseenter","mousemove","mouseleave",4,"ngFor","ngForOf"],["href","#",1,"task-block",2,"grid-column","2 / 3",3,"click","mouseenter","mousemove","mouseleave"],[1,"task-content-in"],[1,"task-title"],[1,"task-time"],["class","task-block","href","#",3,"gridRow","gridColumn","class","click","mouseenter","mousemove","mouseleave",4,"ngFor","ngForOf"],["href","#",1,"task-block",3,"click","mouseenter","mousemove","mouseleave"],["role","tooltip",1,"task-tooltip","floating",3,"id"],[1,"tt-header"],[1,"tt-priority-dot"],[1,"tt-title"],[1,"tt-row"],[1,"tt-label"],["class","tt-row",4,"ngIf"],["class","tt-desc",4,"ngIf"],[1,"tt-desc"],[1,"empty-state"],[1,"empty-icon"]],template:function(e,i){if(e&1){let n=O();s(0,"div",1)(1,"header",2)(2,"h1"),c(3,"Timetable"),l(),s(4,"div",3)(5,"div",4)(6,"button",5),h("click",function(){return g(n),u(i.setView("day"))}),c(7,"Day"),l(),s(8,"button",5),h("click",function(){return g(n),u(i.setView("week"))}),c(9,"Week"),l()(),s(10,"button",5),h("click",function(){return g(n),u(i.previous())}),c(11,"\u25C0"),l(),s(12,"button",6),h("click",function(){return g(n),u(i.goToToday())}),c(13,"Today"),l(),s(14,"button",5),h("click",function(){return g(n),u(i.next())}),c(15,"\u25B6"),l(),s(16,"div",7),L(17,le,2,4)(18,se,1,1),l()()(),s(19,"div",8)(20,"span",9),y(21,"span",10),c(22," High"),l(),s(23,"span",9),y(24,"span",11),c(25," Medium"),l(),s(26,"span",9),y(27,"span",12),c(28," Low"),l()(),T(29,de,3,3,"div",13),s(30,"div",14),T(31,pe,3,3,"ng-container",15)(32,me,2,4,"ng-container",15)(33,ge,2,2,"ng-container",15)(34,_e,2,1,"ng-container",16)(35,be,2,1,"ng-container",16),l(),T(36,xe,16,14,"div",17)(37,Te,7,0,"div",18)(38,ye,7,0,"div",18),l(),s(39,"app-task-editor",19,0),h("save",function(d){return g(n),u(i.onSave(d))})("close",function(){return g(n),u(i.closeEditor())}),l()}if(e&2){let n;r(6),P("active",i.currentView()==="day"),r(2),P("active",i.currentView()==="week"),r(4),m("disabled",i.isToday(i.selectedDate())),r(5),Y(i.currentView()==="day"?17:18),r(12),m("ngIf",i.currentView()==="week"),r(),m("ngClass",i.currentView()==="week"?"grid-week":"grid-day"),r(),m("ngForOf",i.hours),r(),m("ngForOf",i.fiveMinutes),r(),m("ngForOf",i.halfHours),r(),m("ngIf",i.currentView()==="day"),r(),m("ngIf",i.currentView()==="week"),r(),m("ngIf",i.tooltipVisible()&&i.tooltipBlock()),r(),m("ngIf",i.currentView()==="day"&&i.timetableBlocksDay().length===0),r(),m("ngIf",i.currentView()==="week"&&i.timetableBlocksWeek().length===0),r(),m("todo",i.editingTodo())("isSubtask",!!((n=i.editingTodo())!=null&&n.parentId))}},dependencies:[U,j,q,G,Z,te,J,K],styles:[".timetable-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.timetable-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.date-controls[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.nav-btn[_ngcontent-%COMP%]{background:#f3f4f6;color:#374151;border:1px solid #d1d5db;border-radius:6px;padding:6px 10px;cursor:pointer}.nav-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.current-date[_ngcontent-%COMP%]{margin-left:8px;font-weight:600;color:#374151}.legend[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.legend-item[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;color:#4b5563}.legend-color[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;display:inline-block}.legend-color.priority-high[_ngcontent-%COMP%]{background:#ef4444}.legend-color.priority-medium[_ngcontent-%COMP%]{background:#f59e0b}.legend-color.priority-low[_ngcontent-%COMP%]{background:#10b981}.day-headers[_ngcontent-%COMP%]{display:grid;grid-template-columns:60px repeat(7,1fr);gap:8px;align-items:center;margin-bottom:8px}.day-header[_ngcontent-%COMP%]{font-weight:600;color:#374151;text-align:center}.time-spacer[_ngcontent-%COMP%]{height:1px}.timetable-grid[_ngcontent-%COMP%]{position:relative;display:grid;grid-template-rows:repeat(288,4px);grid-template-columns:60px 1fr;grid-auto-columns:1fr;padding-left:0;border:1px solid #e5e7eb;border-radius:8px;background:#fff}.timetable-grid.grid-day[_ngcontent-%COMP%]{grid-template-columns:60px 1fr}.timetable-grid.grid-week[_ngcontent-%COMP%]{grid-template-columns:60px repeat(7,1fr)}.time-label[_ngcontent-%COMP%]{grid-column:1 / 2;position:relative;justify-self:end;padding-right:8px;color:#6b7280;font-size:12px;align-self:center}.grid-line[_ngcontent-%COMP%]{grid-column:1 / -1;border-top:1px dashed #e5e7eb}.grid-line.hour-line[_ngcontent-%COMP%]{border-top:1px solid #d1d5db}.task-block[_ngcontent-%COMP%]{grid-column:2 / 3;display:block;margin:1px 6px;padding:0 8px;border-radius:6px;color:#111827;text-decoration:none;border:1px solid transparent;box-shadow:0 1px 2px #0000000d;position:relative;overflow:hidden}.task-block[_ngcontent-%COMP%]   .task-content-in[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:0}.task-block[_ngcontent-%COMP%]   .task-title[_ngcontent-%COMP%]{font-weight:600;font-size:12px;line-height:1.1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.task-block[_ngcontent-%COMP%]   .task-time[_ngcontent-%COMP%]{font-size:11px;line-height:1.1;color:#4b5563;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.task-block.priority-high[_ngcontent-%COMP%]{background:#fee2e2;border-color:#fecaca}.task-block.priority-medium[_ngcontent-%COMP%]{background:#fffbeb;border-color:#fde68a}.task-block.priority-low[_ngcontent-%COMP%]{background:#ecfdf5;border-color:#a7f3d0}.task-tooltip[_ngcontent-%COMP%]{position:absolute;left:100%;top:0;transform:translate(8px);min-width:220px;max-width:320px;background:#111827;color:#f9fafb;border-radius:6px;padding:8px 10px;font-size:12px;line-height:1.3;box-shadow:0 8px 20px #0003;opacity:0;pointer-events:none;transition:opacity .12s ease,transform .12s ease;z-index:20}.task-block[_ngcontent-%COMP%]:hover   .task-tooltip[_ngcontent-%COMP%], .task-block[_ngcontent-%COMP%]:focus-visible   .task-tooltip[_ngcontent-%COMP%], .task-block[_ngcontent-%COMP%]:focus   .task-tooltip[_ngcontent-%COMP%]{opacity:1}.task-tooltip.floating[_ngcontent-%COMP%]{position:fixed;left:0;top:0;transform:none;opacity:1}.tt-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;margin-bottom:6px}.tt-priority-dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%;display:inline-block}.tt-priority-dot.prio-high[_ngcontent-%COMP%]{background:#ef4444}.tt-priority-dot.prio-medium[_ngcontent-%COMP%]{background:#f59e0b}.tt-priority-dot.prio-low[_ngcontent-%COMP%]{background:#10b981}.tt-title[_ngcontent-%COMP%]{font-weight:700;color:#fff}.tt-row[_ngcontent-%COMP%]{margin:2px 0;color:#e5e7eb}.tt-label[_ngcontent-%COMP%]{color:#9ca3af;margin-right:6px}.tt-desc[_ngcontent-%COMP%]{margin-top:6px;color:#e5e7eb;white-space:normal}.empty-state[_ngcontent-%COMP%]{margin-top:16px;padding:24px;border-radius:8px;background:#f9fafb;text-align:center;color:#4b5563}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{font-size:32px;margin-bottom:8px}"]})};export{ie as TimetableComponent};
