import{e as te}from"./chunk-J6BGEG2T.js";import{a as ee}from"./chunk-6PXS6NW7.js";import{b as q,c as U,f as H,j as Y,k as $,l as G,p as J,q as X,s as Z}from"./chunk-42IZJ7II.js";import{Aa as S,B as v,Ba as y,D as m,Da as b,E as u,Ea as T,Fa as M,L as C,R as l,Ra as k,W as D,Ya as N,Za as R,_,bb as z,c as P,eb as B,ha as g,ia as i,ja as a,kb as W,mb as K,oa as x,pa as h,qa as p,ra as F,sa as L,ta as Q,va as A,ya as d,za as O}from"./chunk-EZJSWEPC.js";var re=["taskEditor"];function oe(s,t){if(s&1){let e=x();i(0,"button",28),h("click",function(){m(e);let r=p();return u(r.clearSearch())}),d(1," \u2715 "),a()}}function ie(s,t){if(s&1&&(i(0,"option",29),d(1),a()),s&2){let e=t.$implicit;g("value",e.id),l(),y(" ",e.icon," ",e.name," ")}}function ae(s,t){if(s&1&&(i(0,"span"),d(1),a()),s&2){let e=p(2);l(),S('for "',e.searchQuery(),'"')}}function se(s,t){if(s&1&&(i(0,"div",30)(1,"h2"),d(2),_(3,ae,2,1,"span",31),a()()),s&2){let e=p();l(2),y(" ",e.searchResults().length," result",e.searchResults().length!==1?"s":""," "),l(),g("ngIf",e.searchQuery())}}function ce(s,t){if(s&1&&(i(0,"div",44)(1,"span",45),d(2,"\u21B3 Subtask of:"),a(),i(3,"span",46),d(4),a()()),s&2){let e,n=p().$implicit,r=p(3);l(4),O(((e=r.getParentTask(n))==null?null:e.title)||"Unknown Parent")}}function de(s,t){s&1&&(i(0,"span"),d(1,", "),a())}function le(s,t){if(s&1&&(i(0,"span",50),d(1),_(2,de,2,0,"span",31),a()),s&2){let e=t.$implicit,n=t.last;l(),S(" ",e),l(),g("ngIf",!n)}}function pe(s,t){if(s&1&&(i(0,"div",47)(1,"span",48),d(2,"\u{1F3F7}\uFE0F Found in tags:"),a(),_(3,le,3,2,"span",49),a()),s&2){let e=p().$implicit,n=p(3);l(3),g("ngForOf",n.getMatchingTags(e,n.searchQuery()))}}function me(s,t){if(s&1){let e=x();i(0,"div",40),_(1,ce,5,1,"div",41)(2,pe,4,1,"div",42),i(3,"app-todo-item",43),h("edit",function(){let r=m(e).$implicit,c=p(3);return u(c.onEditTodo(r))})("toggle",function(r){m(e);let c=p(3);return u(c.onToggleTodo(r))})("delete",function(r){m(e);let c=p(3);return u(c.onDeleteTodo(r))})("update",function(r){m(e);let c=p(3);return u(c.onUpdateTodo(r))})("addSubtaskEvent",function(r){m(e);let c=p(3);return u(c.onAddSubtask(r))})("toggleExpanded",function(r){m(e);let c=p(3);return u(c.onToggleExpanded(r))})("archive",function(r){m(e);let c=p(3);return u(c.onArchiveTodo(r))})("unarchive",function(r){m(e);let c=p(3);return u(c.onUnarchiveTodo(r))}),a()()}if(s&2){let e=t.$implicit,n=p(3);l(),g("ngIf",n.isSubtask(e)),l(),g("ngIf",n.getMatchType(e,n.searchQuery())==="tag"),l(),g("todo",e)("isSubtask",n.isSubtask(e))}}function ue(s,t){if(s&1&&(i(0,"div",34)(1,"div",35)(2,"span",36),d(3),a(),i(4,"h3"),d(5),a(),i(6,"span",37),d(7),a()(),i(8,"div",38),_(9,me,4,4,"div",39),a()()),s&2){let e=t.$implicit,n=p(2);l(2),A("color",e.project==null?null:e.project.color),l(),S(" ",(e.project==null?null:e.project.icon)||"\u{1F4CB}"," "),l(2),O((e.project==null?null:e.project.name)||"No Project"),l(2),y("",e.tasks.length," task",e.tasks.length!==1?"s":""),l(2),g("ngForOf",e.tasks)("ngForTrackBy",n.trackByTodoId)}}function ge(s,t){if(s&1&&(i(0,"div",32),_(1,ue,10,8,"div",33),a()),s&2){let e=p();l(),g("ngForOf",e.groupedResults())}}function _e(s,t){s&1&&(i(0,"div",51)(1,"div",52),d(2,"\u{1F50D}"),a(),i(3,"h3"),d(4,"Start searching"),a(),i(5,"p"),d(6,"Enter a search term to find tasks across all your projects"),a()())}function he(s,t){s&1&&(i(0,"div",51)(1,"div",52),d(2,"\u{1F4ED}"),a(),i(3,"h3"),d(4,"No results found"),a(),i(5,"p"),d(6,"No tasks match your search criteria. Try different keywords or check your filters."),a()())}var ne=class s{taskEditor;todoService=v(Z);projectService=v(K);confirmationService=v(X);route=v(B);searchQuery=C("");selectedProjectId=C("");selectedStatus=C("all");editingTodo=null;ngOnInit(){this.route.queryParams.subscribe(t=>{t.q&&this.searchQuery.set(t.q)})}searchResults=k(()=>{let t=this.searchQuery().toLowerCase().trim(),e=this.selectedProjectId();if(!t)return[];let n=this.flattenTodos(this.todoService.todos());console.log("=== SEARCH DEBUG ==="),console.log("Query:",t),console.log("Total flattened todos:",n.length),console.log("Todos with parentId (subtasks):",n.filter(o=>o.parentId).length),n.forEach(o=>{o.title.toLowerCase().includes(t)&&console.log("MATCH FOUND:",o.title,"parentId:",o.parentId)});let r=n.filter(o=>this.todoMatchesSearch(o,t));switch(e&&(r=r.filter(o=>o.projectId===e)),this.selectedStatus()){case"active":r=r.filter(o=>!o.completed&&!o.archived);break;case"completed":r=r.filter(o=>o.completed&&!o.archived);break;case"archived":r=r.filter(o=>o.archived);break;case"all":default:r=r.filter(o=>!o.archived);break}return console.log("Search results found:",r.length),r.forEach(o=>console.log("Result:",o.title,"parentId:",o.parentId)),r.sort((o,f)=>{let E=o.title.toLowerCase()===t,j=f.title.toLowerCase()===t;if(E&&!j)return-1;if(!E&&j)return 1;let I=o.tags?.some(w=>w.toLowerCase()===t)??!1,V=f.tags?.some(w=>w.toLowerCase()===t)??!1;return I&&!V?-1:!I&&V?1:new Date(f.createdAt).getTime()-new Date(o.createdAt).getTime()})});groupedResults=k(()=>{let t=this.searchResults(),e=new Map;for(let n of t){let r=n.projectId||"",c=r?this.projectService.getProjectById(r):null;e.has(r)||e.set(r,{project:c,tasks:[]}),e.get(r).tasks.push(n)}return Array.from(e.values()).sort((n,r)=>{let c=n.project?.name||"No Project",o=r.project?.name||"No Project";return c.localeCompare(o)})});onSearchInput(t){let e=t.target;this.searchQuery.set(e.value)}clearSearch(){this.searchQuery.set("")}onProjectFilterChange(){}onStatusFilterChange(){}trackByTodoId(t,e){return e.id}onToggleTodo(t){this.todoService.toggleTodo(t)}onDeleteTodo(t){return P(this,null,function*(){let e=this.findTodoById(t);if(!e)return;(yield this.confirmationService.open("Delete Task",`Are you sure you want to delete "${e.title}"? This will also delete all its subtasks.`,"Delete","Cancel",!1))==="confirm"&&this.todoService.deleteTodo(t)})}onEditTodo(t){this.editingTodo=t,this.taskEditor.open()}onUpdateTodo(t){this.todoService.updateTodo(t.id,t.updates)}onAddSubtask(t){this.todoService.addSubtask(t.parentId,t.subtaskData)}onToggleExpanded(t){this.todoService.toggleExpanded(t)}onArchiveTodo(t){this.todoService.archiveTodo(t)}onUnarchiveTodo(t){this.todoService.unarchiveTodo(t)}onSaveTask(t){return P(this,null,function*(){if(this.editingTodo)try{yield this.todoService.updateTodo(this.editingTodo.id,t),this.taskEditor.closeAndReset(),this.closeEditor()}catch(e){if(e?.message==="OVERLAP_CANCELLED")return;console.error("Failed to save todo:",e)}})}closeEditor(){this.editingTodo=null}findTodoById(t){return this.flattenTodos(this.todoService.todos()).find(n=>n.id===t)}isSubtask(t){return!!t.parentId}getParentTask(t){if(t.parentId)return this.findTodoById(t.parentId)}flattenTodos(t){let e=[],n=r=>{for(let c of r)e.push(c),c.subtasks&&c.subtasks.length>0&&n(c.subtasks)};return n(t),e}todoMatchesSearch(t,e){let n=t.title.toLowerCase().includes(e),r=t.description?.toLowerCase().includes(e)??!1,c=t.category?.toLowerCase().includes(e)??!1,o=t.tags?.some(f=>f.toLowerCase().includes(e))??!1;return n||r||c||o}getMatchType(t,e){let n=e.toLowerCase();return t.title.toLowerCase().includes(n)?"title":t.description?.toLowerCase().includes(n)?"description":t.category?.toLowerCase().includes(n)?"category":t.tags?.some(r=>r.toLowerCase().includes(n))?"tag":"none"}getMatchingTags(t,e){if(!t.tags)return[];let n=e.toLowerCase();return t.tags.filter(r=>r.toLowerCase().includes(n))}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=D({type:s,selectors:[["app-search"]],viewQuery:function(e,n){if(e&1&&F(re,5),e&2){let r;L(r=Q())&&(n.taskEditor=r.first)}},decls:40,vars:10,consts:[["searchInput",""],["taskEditor",""],[1,"search-container"],[1,"search-header"],[1,"search-subtitle"],[1,"search-input-container"],[1,"search-input-wrapper"],[1,"search-icon"],["type","text","placeholder","Search tasks, descriptions, categories, tags...",1,"search-input",3,"ngModelChange","input","ngModel"],["class","clear-search-btn","title","Clear search",3,"click",4,"ngIf"],[1,"search-filters"],[1,"status-filter"],["for","status-select"],["id","status-select",3,"ngModelChange","change","ngModel"],["value","all"],["value","active"],["value","completed"],["value","archived"],[1,"project-filter"],["for","project-select"],["id","project-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"search-results"],["class","results-header",4,"ngIf"],["class","results-by-project",4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"save","close","todo"],["title","Clear search",1,"clear-search-btn",3,"click"],[3,"value"],[1,"results-header"],[4,"ngIf"],[1,"results-by-project"],["class","project-group",4,"ngFor","ngForOf"],[1,"project-group"],[1,"project-group-header"],[1,"project-icon"],[1,"task-count"],[1,"project-tasks"],["class","search-result-wrapper",4,"ngFor","ngForOf","ngForTrackBy"],[1,"search-result-wrapper"],["class","parent-context",4,"ngIf"],["class","match-context",4,"ngIf"],[1,"search-result-item",3,"edit","toggle","delete","update","addSubtaskEvent","toggleExpanded","archive","unarchive","todo","isSubtask"],[1,"parent-context"],[1,"parent-indicator"],[1,"parent-title"],[1,"match-context"],[1,"match-indicator"],["class","matching-tag",4,"ngFor","ngForOf"],[1,"matching-tag"],[1,"empty-state"],[1,"empty-icon"]],template:function(e,n){if(e&1){let r=x();i(0,"div",2)(1,"header",3)(2,"h1"),d(3,"Search Tasks"),a(),i(4,"p",4),d(5,"Search across all projects and tasks"),a()(),i(6,"div",5)(7,"div",6)(8,"span",7),d(9,"\u{1F50D}"),a(),i(10,"input",8,0),M("ngModelChange",function(o){return m(r),T(n.searchQuery,o)||(n.searchQuery=o),u(o)}),h("input",function(o){return m(r),u(n.onSearchInput(o))}),a(),_(12,oe,2,0,"button",9),a()(),i(13,"div",10)(14,"div",11)(15,"label",12),d(16,"Status:"),a(),i(17,"select",13),M("ngModelChange",function(o){return m(r),T(n.selectedStatus,o)||(n.selectedStatus=o),u(o)}),h("change",function(){return m(r),u(n.onStatusFilterChange())}),i(18,"option",14),d(19,"All Tasks"),a(),i(20,"option",15),d(21,"Active"),a(),i(22,"option",16),d(23,"Completed"),a(),i(24,"option",17),d(25,"Archived"),a()()(),i(26,"div",18)(27,"label",19),d(28,"Project:"),a(),i(29,"select",20),M("ngModelChange",function(o){return m(r),T(n.selectedProjectId,o)||(n.selectedProjectId=o),u(o)}),h("change",function(){return m(r),u(n.onProjectFilterChange())}),i(30,"option",21),d(31,"All Projects"),a(),_(32,ie,2,3,"option",22),a()()(),i(33,"div",23),_(34,se,4,3,"div",24)(35,ge,2,1,"div",25)(36,_e,7,0,"div",26)(37,he,7,0,"div",26),a()(),i(38,"app-task-editor",27,1),h("save",function(o){return m(r),u(n.onSaveTask(o))})("close",function(){return m(r),u(n.closeEditor())}),a()}e&2&&(l(10),b("ngModel",n.searchQuery),l(2),g("ngIf",n.searchQuery),l(5),b("ngModel",n.selectedStatus),l(12),b("ngModel",n.selectedProjectId),l(3),g("ngForOf",n.projectService.activeProjects()),l(2),g("ngIf",n.searchQuery),l(),g("ngIf",n.searchQuery()&&n.searchResults().length>0),l(),g("ngIf",!n.searchQuery()),l(),g("ngIf",n.searchQuery()&&n.searchResults().length===0),l(),g("todo",n.editingTodo))},dependencies:[z,N,R,J,$,G,q,Y,U,H,W,te,ee],styles:[".search-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.search-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.search-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:var(--text-primary);margin-bottom:.5rem}.search-subtitle[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--text-secondary);margin:0}.search-input-container[_ngcontent-%COMP%]{margin-bottom:2rem}.search-input-wrapper[_ngcontent-%COMP%]{position:relative;max-width:600px;margin:0 auto}.search-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;top:50%;transform:translateY(-50%);font-size:1.2rem;color:var(--text-secondary);pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;padding:1rem 1rem 1rem 3rem;font-size:1.1rem;border:2px solid var(--border-color);border-radius:12px;background:var(--bg-secondary);color:var(--text-primary);transition:all .2s ease}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px var(--primary-color-alpha)}.clear-search-btn[_ngcontent-%COMP%]{position:absolute;right:1rem;top:50%;transform:translateY(-50%);background:none;border:none;font-size:1.2rem;color:var(--text-secondary);cursor:pointer;padding:.25rem;border-radius:4px;transition:all .2s ease}.clear-search-btn[_ngcontent-%COMP%]:hover{background:var(--bg-tertiary);color:var(--text-primary)}.search-filters[_ngcontent-%COMP%]{display:flex;gap:2rem;align-items:center;justify-content:center;margin-bottom:2rem;flex-wrap:wrap}.status-filter[_ngcontent-%COMP%], .project-filter[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.status-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .project-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary)}.status-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .project-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid var(--border-color);border-radius:8px;background:var(--bg-secondary);color:var(--text-primary);font-size:.9rem;min-width:150px}.search-results[_ngcontent-%COMP%]{margin-top:2rem}.results-header[_ngcontent-%COMP%]{margin-bottom:1.5rem;text-align:center}.results-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:0}.results-by-project[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.project-group[_ngcontent-%COMP%]{background:var(--bg-secondary);border-radius:12px;padding:1.5rem;border:1px solid var(--border-color)}.project-group-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:1px solid var(--border-color)}.project-icon[_ngcontent-%COMP%]{font-size:1.5rem}.project-group-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0;flex:1}.task-count[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);background:var(--bg-tertiary);padding:.25rem .75rem;border-radius:20px}.project-tasks[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.search-result-wrapper[_ngcontent-%COMP%]{margin-bottom:1rem}.parent-context[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px 6px 0 0;padding:.5rem .75rem;font-size:.85rem;color:#6b7280;border-bottom:none}.parent-indicator[_ngcontent-%COMP%]{font-weight:500;margin-right:.5rem}.parent-title[_ngcontent-%COMP%]{color:#374151;font-weight:500}.search-result-item[_ngcontent-%COMP%]{background:#fff;border-radius:8px;border:1px solid #e5e7eb}.search-result-wrapper[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]{border-radius:0 0 8px 8px;margin-top:0}.search-result-wrapper[_ngcontent-%COMP%]:not(:has(.parent-context))   .search-result-item[_ngcontent-%COMP%]{border-radius:8px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;color:var(--text-secondary)}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;max-width:400px;margin:0 auto}@media (max-width: 768px){.search-container[_ngcontent-%COMP%]{padding:1rem}.search-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem}.search-filters[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.project-filter[_ngcontent-%COMP%]{width:100%;justify-content:center}.project-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:250px}.project-group[_ngcontent-%COMP%]{padding:1rem}.project-group-header[_ngcontent-%COMP%]{flex-wrap:wrap;gap:.5rem}.task-count[_ngcontent-%COMP%]{order:3;flex-basis:100%;text-align:center;margin-top:.5rem}}.match-context[_ngcontent-%COMP%]{background:#f0fdf4;border:1px solid #bbf7d0;border-radius:6px 6px 0 0;padding:.5rem .75rem;font-size:.85rem;color:#059669;border-bottom:none;margin-top:8px}.match-indicator[_ngcontent-%COMP%]{font-weight:500;margin-right:.5rem}.matching-tag[_ngcontent-%COMP%]{color:#047857;font-weight:600;background:#10b98133;padding:2px 6px;border-radius:12px;font-size:.8rem;margin-right:4px}.search-result-wrapper[_ngcontent-%COMP%]:has(.match-context)   .search-result-item[_ngcontent-%COMP%]{border-radius:0 0 8px 8px}.search-result-wrapper[_ngcontent-%COMP%]:has(.parent-context):has(.match-context)   .search-result-item[_ngcontent-%COMP%]{border-radius:0 0 8px 8px}.search-result-wrapper[_ngcontent-%COMP%]:has(.parent-context):has(.match-context)   .parent-context[_ngcontent-%COMP%]{border-radius:6px 6px 0 0}.search-result-wrapper[_ngcontent-%COMP%]:has(.parent-context):has(.match-context)   .match-context[_ngcontent-%COMP%]{border-radius:0}"]})};export{ne as SearchComponent};
