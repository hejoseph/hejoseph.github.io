import{e as ne}from"./chunk-WYH4CAFK.js";import{a as te}from"./chunk-U6KPUC5J.js";import{C as ee,b as W,h as q,j as U,k as H,n as Y,r as G,s as J,t as K,x as X,y as $}from"./chunk-ZZ5RFCLH.js";import{$ as m,Ga as F,Hb as E,Ka as h,W as v,Xa as _,Ya as i,Za as a,Zb as R,_b as z,aa as g,c as M,cb as b,cc as B,db as f,eb as u,gb as L,hb as A,ib as Q,ja as C,jc as Z,kb as N,nb as c,ob as k,pb as T,qb as w,sb as x,tb as y,ub as S,wa as d}from"./chunk-3KRIVHIL.js";var oe=["taskEditor"];function ie(s,t){if(s&1){let e=b();i(0,"button",34),f("click",function(){m(e);let r=u();return g(r.clearSearch())}),c(1," \u2715 "),a()}}function ae(s,t){if(s&1&&(i(0,"option",35),c(1),a()),s&2){let e=t.$implicit;_("value",e.id),d(),w(" ",e.icon," ",e.name," ")}}function se(s,t){if(s&1&&(i(0,"span"),c(1),a()),s&2){let e=u(2);d(),T('for "',e.searchQuery(),'"')}}function ce(s,t){s&1&&(i(0,"span"),c(1,"- All Tasks"),a())}function le(s,t){if(s&1&&(i(0,"div",36)(1,"h2"),c(2),h(3,se,2,1,"span",37)(4,ce,2,0,"span",37),a()()),s&2){let e=u();d(2),w(" ",e.searchResults().length," result",e.searchResults().length!==1?"s":""," "),d(),_("ngIf",e.searchQuery()),d(),_("ngIf",!e.searchQuery())}}function de(s,t){if(s&1&&(i(0,"div",50)(1,"span",51),c(2,"\u21B3 Subtask of:"),a(),i(3,"span",52),c(4),a()()),s&2){let e,n=u().$implicit,r=u(3);d(4),k(((e=r.getParentTask(n))==null?null:e.title)||"Unknown Parent")}}function pe(s,t){s&1&&(i(0,"span"),c(1,", "),a())}function me(s,t){if(s&1&&(i(0,"span",56),c(1),h(2,pe,2,0,"span",37),a()),s&2){let e=t.$implicit,n=t.last;d(),T(" ",e),d(),_("ngIf",!n)}}function ge(s,t){if(s&1&&(i(0,"div",53)(1,"span",54),c(2,"\u{1F3F7}\uFE0F Found in tags:"),a(),h(3,me,3,2,"span",55),a()),s&2){let e=u().$implicit,n=u(3);d(3),_("ngForOf",n.getMatchingTags(e,n.searchQuery()))}}function ue(s,t){if(s&1){let e=b();i(0,"div",46),h(1,de,5,1,"div",47)(2,ge,4,1,"div",48),i(3,"app-todo-item",49),f("edit",function(){let r=m(e).$implicit,o=u(3);return g(o.onEditTodo(r))})("toggle",function(r){m(e);let o=u(3);return g(o.onToggleTodo(r))})("delete",function(r){m(e);let o=u(3);return g(o.onDeleteTodo(r))})("update",function(r){m(e);let o=u(3);return g(o.onUpdateTodo(r))})("addSubtaskEvent",function(r){m(e);let o=u(3);return g(o.onAddSubtask(r))})("toggleExpanded",function(r){m(e);let o=u(3);return g(o.onToggleExpanded(r))})("archive",function(r){m(e);let o=u(3);return g(o.onArchiveTodo(r))})("unarchive",function(r){m(e);let o=u(3);return g(o.onUnarchiveTodo(r))}),a()()}if(s&2){let e=t.$implicit,n=u(3);d(),_("ngIf",n.isSubtask(e)),d(),_("ngIf",n.getMatchType(e,n.searchQuery())==="tag"),d(),_("todo",e)("isSubtask",n.isSubtask(e))}}function _e(s,t){if(s&1&&(i(0,"div",40)(1,"div",41)(2,"span",42),c(3),a(),i(4,"h3"),c(5),a(),i(6,"span",43),c(7),a()(),i(8,"div",44),h(9,ue,4,4,"div",45),a()()),s&2){let e=t.$implicit,n=u(2);d(2),N("color",e.project==null?null:e.project.color),d(),T(" ",(e.project==null?null:e.project.icon)||"\u{1F4CB}"," "),d(2),k((e.project==null?null:e.project.name)||"No Project"),d(2),w("",e.tasks.length," task",e.tasks.length!==1?"s":""),d(2),_("ngForOf",e.tasks)("ngForTrackBy",n.trackByTodoId)}}function he(s,t){if(s&1&&(i(0,"div",38),h(1,_e,10,8,"div",39),a()),s&2){let e=u();d(),_("ngForOf",e.groupedResults())}}function fe(s,t){s&1&&(i(0,"div",57)(1,"div",58),c(2,"\u{1F4CB}"),a(),i(3,"h3"),c(4,"No tasks found"),a(),i(5,"p"),c(6,"You don't have any tasks yet. Create your first task to get started!"),a()())}function ve(s,t){s&1&&(i(0,"div",57)(1,"div",58),c(2,"\u{1F4ED}"),a(),i(3,"h3"),c(4,"No results found"),a(),i(5,"p"),c(6,"No tasks match your search criteria. Try different keywords or check your filters."),a()())}var re=class s{taskEditor;todoService=v(ee);projectService=v(Z);confirmationService=v($);route=v(W);searchQuery=C("");selectedProjectId=C("");selectedStatus=C("all");selectedPriority=C("all");editingTodo=null;ngOnInit(){this.route.queryParams.subscribe(t=>{t.q&&this.searchQuery.set(t.q)})}searchResults=E(()=>{let t=this.searchQuery().toLowerCase().trim(),e=this.selectedProjectId(),n=this.selectedPriority(),r=this.flattenTodos(this.todoService.todos()),o;switch(t?(console.log("=== SEARCH DEBUG ==="),console.log("Query:",t),console.log("Total flattened todos:",r.length),console.log("Todos with parentId (subtasks):",r.filter(l=>l.parentId).length),r.forEach(l=>{l.title.toLowerCase().includes(t)&&console.log("MATCH FOUND:",l.title,"parentId:",l.parentId)}),o=r.filter(l=>this.todoMatchesSearch(l,t))):o=r,e&&(o=o.filter(l=>l.projectId===e)),n&&n!=="all"&&(o=o.filter(l=>l.priority===n)),this.selectedStatus()){case"active":o=o.filter(l=>!l.completed&&!l.archived);break;case"completed":o=o.filter(l=>l.completed&&!l.archived);break;case"archived":o=o.filter(l=>l.archived);break;case"all":default:o=o.filter(l=>!l.archived);break}return console.log("Search results found:",o.length),o.forEach(l=>console.log("Result:",l.title,"parentId:",l.parentId)),o.sort((l,P)=>{let j=l.title.toLowerCase()===t,I=P.title.toLowerCase()===t;if(j&&!I)return-1;if(!j&&I)return 1;let D=l.tags?.some(O=>O.toLowerCase()===t)??!1,V=P.tags?.some(O=>O.toLowerCase()===t)??!1;return D&&!V?-1:!D&&V?1:new Date(P.createdAt).getTime()-new Date(l.createdAt).getTime()})});groupedResults=E(()=>{let t=this.searchResults(),e=new Map;for(let n of t){let r=n.projectId||"",o=r?this.projectService.getProjectById(r):null;e.has(r)||e.set(r,{project:o,tasks:[]}),e.get(r).tasks.push(n)}return Array.from(e.values()).sort((n,r)=>{let o=n.project?.name||"No Project",p=r.project?.name||"No Project";return o.localeCompare(p)})});onSearchInput(t){let e=t.target;this.searchQuery.set(e.value)}clearSearch(){this.searchQuery.set("")}onProjectFilterChange(){}onStatusFilterChange(){}onPriorityFilterChange(){}trackByTodoId(t,e){return e.id}onToggleTodo(t){return M(this,null,function*(){yield this.todoService.toggleTodo(t)})}onDeleteTodo(t){return M(this,null,function*(){let e=this.findTodoById(t);if(!e)return;(yield this.confirmationService.open("Delete Task",`Are you sure you want to delete "${e.title}"? This will also delete all its subtasks.`,"Delete","Cancel",!1))==="confirm"&&this.todoService.deleteTodo(t)})}onEditTodo(t){this.editingTodo=t,this.taskEditor.open()}onUpdateTodo(t){this.todoService.updateTodo(t.id,t.updates)}onAddSubtask(t){this.todoService.addSubtask(t.parentId,t.subtaskData)}onToggleExpanded(t){this.todoService.toggleExpanded(t)}onArchiveTodo(t){this.todoService.archiveTodo(t)}onUnarchiveTodo(t){this.todoService.unarchiveTodo(t)}onSaveTask(t){return M(this,null,function*(){if(this.editingTodo)try{yield this.todoService.updateTodo(this.editingTodo.id,t),this.taskEditor.closeAndReset(),this.closeEditor()}catch(e){if(e?.message==="OVERLAP_CANCELLED")return;console.error("Failed to save todo:",e)}})}closeEditor(){this.editingTodo=null}findTodoById(t){return this.flattenTodos(this.todoService.todos()).find(n=>n.id===t)}isSubtask(t){return!!t.parentId}getParentTask(t){if(t.parentId)return this.findTodoById(t.parentId)}flattenTodos(t){let e=[],n=r=>{for(let o of r)e.push(o),o.subtasks&&o.subtasks.length>0&&n(o.subtasks)};return n(t),e}todoMatchesSearch(t,e){let n=t.title.toLowerCase().includes(e),r=t.description?.toLowerCase().includes(e)??!1,o=t.category?.toLowerCase().includes(e)??!1,p=t.tags?.some(l=>l.toLowerCase().includes(e))??!1;return n||r||o||p}getMatchType(t,e){let n=e.toLowerCase();return t.title.toLowerCase().includes(n)?"title":t.description?.toLowerCase().includes(n)?"description":t.category?.toLowerCase().includes(n)?"category":t.tags?.some(r=>r.toLowerCase().includes(n))?"tag":"none"}getMatchingTags(t,e){if(!t.tags)return[];let n=e.toLowerCase();return t.tags.filter(r=>r.toLowerCase().includes(n))}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=F({type:s,selectors:[["app-search"]],viewQuery:function(e,n){if(e&1&&L(oe,5),e&2){let r;A(r=Q())&&(n.taskEditor=r.first)}},decls:52,vars:11,consts:[["searchInput",""],["taskEditor",""],[1,"search-container"],[1,"search-header"],[1,"search-subtitle"],[1,"search-input-container"],[1,"search-input-wrapper"],[1,"search-icon"],["type","text","placeholder","Search tasks, descriptions, categories, tags...",1,"search-input",3,"ngModelChange","input","ngModel"],["class","clear-search-btn","title","Clear search",3,"click",4,"ngIf"],[1,"search-filters"],[1,"status-filter"],["for","status-select"],["id","status-select",3,"ngModelChange","change","ngModel"],["value","all"],["value","active"],["value","completed"],["value","archived"],[1,"project-filter"],["for","project-select"],["id","project-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"priority-filter"],["for","priority-select"],["id","priority-select",3,"ngModelChange","change","ngModel"],["value","high"],["value","medium"],["value","low"],[1,"search-results"],["class","results-header",4,"ngIf"],["class","results-by-project",4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"save","close","todo"],["title","Clear search",1,"clear-search-btn",3,"click"],[3,"value"],[1,"results-header"],[4,"ngIf"],[1,"results-by-project"],["class","project-group",4,"ngFor","ngForOf"],[1,"project-group"],[1,"project-group-header"],[1,"project-icon"],[1,"task-count"],[1,"project-tasks"],["class","search-result-wrapper",4,"ngFor","ngForOf","ngForTrackBy"],[1,"search-result-wrapper"],["class","parent-context",4,"ngIf"],["class","match-context",4,"ngIf"],[1,"search-result-item",3,"edit","toggle","delete","update","addSubtaskEvent","toggleExpanded","archive","unarchive","todo","isSubtask"],[1,"parent-context"],[1,"parent-indicator"],[1,"parent-title"],[1,"match-context"],[1,"match-indicator"],["class","matching-tag",4,"ngFor","ngForOf"],[1,"matching-tag"],[1,"empty-state"],[1,"empty-icon"]],template:function(e,n){if(e&1){let r=b();i(0,"div",2)(1,"header",3)(2,"h1"),c(3,"Search Tasks"),a(),i(4,"p",4),c(5,"Search across all projects and tasks"),a()(),i(6,"div",5)(7,"div",6)(8,"span",7),c(9,"\u{1F50D}"),a(),i(10,"input",8,0),S("ngModelChange",function(p){return m(r),y(n.searchQuery,p)||(n.searchQuery=p),g(p)}),f("input",function(p){return m(r),g(n.onSearchInput(p))}),a(),h(12,ie,2,0,"button",9),a()(),i(13,"div",10)(14,"div",11)(15,"label",12),c(16,"Status:"),a(),i(17,"select",13),S("ngModelChange",function(p){return m(r),y(n.selectedStatus,p)||(n.selectedStatus=p),g(p)}),f("change",function(){return m(r),g(n.onStatusFilterChange())}),i(18,"option",14),c(19,"All Tasks"),a(),i(20,"option",15),c(21,"Active"),a(),i(22,"option",16),c(23,"Completed"),a(),i(24,"option",17),c(25,"Archived"),a()()(),i(26,"div",18)(27,"label",19),c(28,"Project:"),a(),i(29,"select",20),S("ngModelChange",function(p){return m(r),y(n.selectedProjectId,p)||(n.selectedProjectId=p),g(p)}),f("change",function(){return m(r),g(n.onProjectFilterChange())}),i(30,"option",21),c(31,"All Projects"),a(),h(32,ae,2,3,"option",22),a()(),i(33,"div",23)(34,"label",24),c(35,"Priority:"),a(),i(36,"select",25),S("ngModelChange",function(p){return m(r),y(n.selectedPriority,p)||(n.selectedPriority=p),g(p)}),f("change",function(){return m(r),g(n.onPriorityFilterChange())}),i(37,"option",14),c(38,"All Priorities"),a(),i(39,"option",26),c(40,"\u{1F534} High"),a(),i(41,"option",27),c(42,"\u{1F7E1} Medium"),a(),i(43,"option",28),c(44,"\u{1F7E2} Low"),a()()()(),i(45,"div",29),h(46,le,5,4,"div",30)(47,he,2,1,"div",31)(48,fe,7,0,"div",32)(49,ve,7,0,"div",32),a()(),i(50,"app-task-editor",33,1),f("save",function(p){return m(r),g(n.onSaveTask(p))})("close",function(){return m(r),g(n.closeEditor())}),a()}e&2&&(d(10),x("ngModel",n.searchQuery),d(2),_("ngIf",n.searchQuery),d(5),x("ngModel",n.selectedStatus),d(12),x("ngModel",n.selectedProjectId),d(3),_("ngForOf",n.projectService.activeProjects()),d(4),x("ngModel",n.selectedPriority),d(10),_("ngIf",n.searchQuery()||n.searchResults().length>0),d(),_("ngIf",n.searchResults().length>0),d(),_("ngIf",!n.searchQuery()&&n.searchResults().length===0),d(),_("ngIf",n.searchQuery()&&n.searchResults().length===0),d(),_("todo",n.editingTodo))},dependencies:[B,R,z,X,J,K,U,G,H,Y,q,ne,te],styles:[".search-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:2rem}.search-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.search-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:var(--text-primary);margin-bottom:.5rem}.search-subtitle[_ngcontent-%COMP%]{font-size:1.1rem;color:var(--text-secondary);margin:0}.search-input-container[_ngcontent-%COMP%]{margin-bottom:2rem}.search-input-wrapper[_ngcontent-%COMP%]{position:relative;max-width:600px;margin:0 auto}.search-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;top:50%;transform:translateY(-50%);font-size:1.2rem;color:var(--text-secondary);pointer-events:none}.search-input[_ngcontent-%COMP%]{width:100%;padding:1rem 1rem 1rem 3rem;font-size:1.1rem;border:2px solid var(--border-color);border-radius:12px;background:var(--bg-secondary);color:var(--text-primary);transition:all .2s ease}.search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px var(--primary-color-alpha)}.clear-search-btn[_ngcontent-%COMP%]{position:absolute;right:1rem;top:50%;transform:translateY(-50%);background:none;border:none;font-size:1.2rem;color:var(--text-secondary);cursor:pointer;padding:.25rem;border-radius:4px;transition:all .2s ease}.clear-search-btn[_ngcontent-%COMP%]:hover{background:var(--bg-tertiary);color:var(--text-primary)}.search-filters[_ngcontent-%COMP%]{display:flex;gap:2rem;align-items:center;justify-content:center;margin-bottom:2rem;flex-wrap:wrap}.status-filter[_ngcontent-%COMP%], .project-filter[_ngcontent-%COMP%], .priority-filter[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.status-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .project-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .priority-filter[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary)}.status-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .project-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .priority-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid var(--border-color);border-radius:8px;background:var(--bg-secondary);color:var(--text-primary);font-size:.9rem;min-width:150px}.search-results[_ngcontent-%COMP%]{margin-top:2rem}.results-header[_ngcontent-%COMP%]{margin-bottom:1.5rem;text-align:center}.results-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:0}.results-by-project[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.project-group[_ngcontent-%COMP%]{background:var(--bg-secondary);border-radius:12px;padding:1.5rem;border:1px solid var(--border-color)}.project-group-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem;padding-bottom:.75rem;border-bottom:1px solid var(--border-color)}.project-icon[_ngcontent-%COMP%]{font-size:1.5rem}.project-group-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0;flex:1}.task-count[_ngcontent-%COMP%]{font-size:.9rem;color:var(--text-secondary);background:var(--bg-tertiary);padding:.25rem .75rem;border-radius:20px}.project-tasks[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.search-result-wrapper[_ngcontent-%COMP%]{margin-bottom:1rem}.parent-context[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px 6px 0 0;padding:.5rem .75rem;font-size:.85rem;color:#6b7280;border-bottom:none}.parent-indicator[_ngcontent-%COMP%]{font-weight:500;margin-right:.5rem}.parent-title[_ngcontent-%COMP%]{color:#374151;font-weight:500}.search-result-item[_ngcontent-%COMP%]{background:#fff;border-radius:8px;border:1px solid #e5e7eb}.search-result-wrapper[_ngcontent-%COMP%]   .search-result-item[_ngcontent-%COMP%]{border-radius:0 0 8px 8px;margin-top:0}.search-result-wrapper[_ngcontent-%COMP%]:not(:has(.parent-context))   .search-result-item[_ngcontent-%COMP%]{border-radius:8px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem 2rem;color:var(--text-secondary)}.empty-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.5}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin-bottom:.5rem}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;max-width:400px;margin:0 auto}@media (max-width: 768px){.search-container[_ngcontent-%COMP%]{padding:1rem}.search-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem}.search-filters[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.project-filter[_ngcontent-%COMP%]{width:100%;justify-content:center}.project-filter[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:250px}.project-group[_ngcontent-%COMP%]{padding:1rem}.project-group-header[_ngcontent-%COMP%]{flex-wrap:wrap;gap:.5rem}.task-count[_ngcontent-%COMP%]{order:3;flex-basis:100%;text-align:center;margin-top:.5rem}}.match-context[_ngcontent-%COMP%]{background:#f0fdf4;border:1px solid #bbf7d0;border-radius:6px 6px 0 0;padding:.5rem .75rem;font-size:.85rem;color:#059669;border-bottom:none;margin-top:8px}.match-indicator[_ngcontent-%COMP%]{font-weight:500;margin-right:.5rem}.matching-tag[_ngcontent-%COMP%]{color:#047857;font-weight:600;background:#10b98133;padding:2px 6px;border-radius:12px;font-size:.8rem;margin-right:4px}.search-result-wrapper[_ngcontent-%COMP%]:has(.match-context)   .search-result-item[_ngcontent-%COMP%]{border-radius:0 0 8px 8px}.search-result-wrapper[_ngcontent-%COMP%]:has(.parent-context):has(.match-context)   .search-result-item[_ngcontent-%COMP%]{border-radius:0 0 8px 8px}.search-result-wrapper[_ngcontent-%COMP%]:has(.parent-context):has(.match-context)   .parent-context[_ngcontent-%COMP%]{border-radius:6px 6px 0 0}.search-result-wrapper[_ngcontent-%COMP%]:has(.parent-context):has(.match-context)   .match-context[_ngcontent-%COMP%]{border-radius:0}"]})};export{re as SearchComponent};
