import{F as u,Ga as p,a as i,b as d,c as o,pb as T,t as l,w as m}from"./chunk-HJJE4GXF.js";var g=["#ef4444","#f59e0b","#10b981","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"];var h=class c{indexedDBService=m(T);tagsSignal=u([]);tags=this.tagsSignal.asReadonly();tagNames=p(()=>this.tagsSignal().map(e=>e.name));constructor(){this.loadTags()}getAllTags(){return this.tagsSignal()}getTagByName(e){return this.tagsSignal().find(t=>t.name.toLowerCase()===e.toLowerCase())}createTag(e,t){return o(this,null,function*(){let a=e.trim();if(!a)throw new Error("Tag name cannot be empty");let r=this.getTagByName(a);if(r)return r;let s=t||this.getNextAvailableColor(),n={name:a,color:s,count:0};return this.tagsSignal.update(f=>[...f,n]),yield this.saveTags(),n})}updateTag(e,t){return o(this,null,function*(){this.tagsSignal.update(a=>a.map(r=>r.name.toLowerCase()===e.toLowerCase()?i(i({},r),t):r)),yield this.saveTags()})}deleteTag(e){return o(this,null,function*(){this.tagsSignal.update(t=>t.filter(a=>a.name.toLowerCase()!==e.toLowerCase())),yield this.saveTags()})}updateTagCounts(e){let t=new Map,a=r=>{for(let s of r){if(s.tags&&Array.isArray(s.tags))for(let n of s.tags)t.set(n.toLowerCase(),(t.get(n.toLowerCase())||0)+1);s.subtasks&&s.subtasks.length>0&&a(s.subtasks)}};a(e),this.tagsSignal.update(r=>r.map(s=>d(i({},s),{count:t.get(s.name.toLowerCase())||0})))}getNextAvailableColor(){let e=new Set(this.tagsSignal().map(t=>t.color));for(let t of g)if(!e.has(t))return t;return g[Math.floor(Math.random()*g.length)]}parseTagsFromText(e){let t=/#([a-zA-Z0-9_-]+)/g,a=e.match(t);return a?a.map(r=>r.substring(1)):[]}autoCreateTags(e){return o(this,null,function*(){for(let t of e){let a=t.trim();a&&!this.getTagByName(a)&&(yield this.createTag(a))}})}getTagsWithStats(){return this.tagsSignal().sort((e,t)=>(t.count||0)-(e.count||0))}searchTags(e){let t=e.toLowerCase();return this.tagsSignal().filter(a=>a.name.toLowerCase().includes(t))}saveTags(){return o(this,null,function*(){try{yield this.indexedDBService.saveTags(this.tagsSignal())}catch(e){console.error("Error saving tags to IndexedDB:",e)}})}loadTags(){return o(this,null,function*(){try{let e=yield this.indexedDBService.loadTags();this.tagsSignal.set(e)}catch(e){console.error("Error loading tags from IndexedDB:",e)}})}static \u0275fac=function(t){return new(t||c)};static \u0275prov=l({token:c,factory:c.\u0275fac,providedIn:"root"})};export{h as a};
