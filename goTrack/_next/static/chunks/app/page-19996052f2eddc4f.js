(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3420:(e,t,r)=>{Promise.resolve().then(r.bind(r,9223))},9223:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>D});var n=r(5155),a=r(2115),s=r(9434);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...a})});i.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",r),...a})});l.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("font-semibold leading-none tracking-tight",r),...a})});o.displayName="CardTitle",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",r),...a})}).displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter";var c=r(285),u=r(2523),h=r(2730);function f(){let{addTask:e}=(0,h.r)(),[t,r]=(0,a.useState)(""),s=()=>{t.trim()&&(e({title:t,status:"pending"}),r(""))};return(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(u.p,{placeholder:"Enter a new goal...",value:t,onChange:e=>r(e.target.value),onKeyDown:e=>{"Enter"===e.key&&s()},className:"flex-1"}),(0,n.jsx)(c.$,{onClick:s,disabled:!t.trim(),children:"Create Goal"})]})}var m=r(5143),p=r(402),x=r(1206),g=r(8266),k=r(7820),v=r(518);let b=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(k.bL,{ref:t,className:(0,s.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...a,children:(0,n.jsx)(k.C1,{className:(0,s.cn)("flex items-center justify-center text-current"),children:(0,n.jsx)(v.A,{className:"h-4 w-4"})})})});b.displayName=k.bL.displayName;var y=r(295),j=r(3158),w=r(9556),N=r(5943),C=r(8046),A=r(9829),S=r(7223);async function I(e,t,r){if(!t)throw Error("API key is required");let n='I need a breakdown for this task: "'.concat(e,'".\n                  ').concat(r?"Here is the current task breakdown. Do not create duplicate tasks and try to keep the same structure:\n".concat(JSON.stringify(r,null,2)):"Create a structured task list with 2-4 main tasks, each with 2-3 subtasks.",'\n                  Format your response as JSON with this exact structure:\n                  {\n                    "tasks": [\n                      {\n                        "title": "Main task 1",\n                        "subtasks": [\n                          {\n                            "title": "Subtask 1.1",\n                            "subtasks": [\n                              { "title": "Sub-subtask 1.1.1" },\n                              { "title": "Sub-subtask 1.1.2" }\n                            ]\n                          },\n                          {\n                            "title": "Subtask 1.2",\n                            "subtasks": []\n                          }\n                        ]\n                      }\n                    ]\n                  }\n                  Only return valid JSON. No other text before or after.');try{var a,s,i,l,o,d;let e=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:n}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:1024}})}),r=await e.json();if(!e.ok){let e=(null==r||null==(o=r.error)?void 0:o.message)||"An unknown API error occurred.";if(e.includes("API key not valid"))throw Error("Invalid API Key. Please check it in the settings.");throw Error("API Error: ".concat(e))}let c=null==r||null==(s=r.candidates)||null==(a=s[0])?void 0:a.content;if(!c){let e=null==r||null==(d=r.promptFeedback)?void 0:d.blockReason;if(e)throw Error("Content blocked by API for reason: ".concat(e,"."));throw console.error("Invalid API response format:",r),Error("The AI did not return a valid response. Please try again.")}let u=null==(l=c.parts)||null==(i=l[0])?void 0:i.text;if(!u)return console.error("No text found in response parts:",c),null;try{let e=u.match(/(\{[\s\S]*\})/),t=e?e[1]:u;return JSON.parse(t)}catch(e){return console.error("Failed to parse JSON from response:",u,e),null}}catch(e){throw console.error("Error calling Gemini API:",e),e}}var E=r(4165);let P=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("textarea",{className:(0,s.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...a})});P.displayName="Textarea";var R=r(6671);function O(e){let{task:t,level:r,addSubtask:i,aiBreakdown:l}=e,{toggleTaskStatus:o,toggleCollapsed:d,updateTask:f,deleteTask:m,apiKey:x,recentlyAddedTaskIds:k,setRecentlyAddedTaskIds:v}=(0,h.r)(),[O,T]=(0,a.useState)(!1),[F,D]=(0,a.useState)(t.title),[$,z]=(0,a.useState)(!1),[G,_]=(0,a.useState)(""),[L,J]=(0,a.useState)(!1),[K,B]=(0,a.useState)(!1),[q,H]=(0,a.useState)("");(0,a.useEffect)(()=>{if(k.includes(t.id)){let e=setTimeout(()=>{v([])},2e3);return()=>clearTimeout(e)}},[k,t.id,v]);let{attributes:M,listeners:U,setNodeRef:Q,transform:V,transition:W,isDragging:X}=(0,p.gl)({id:t.id}),Y={transform:g.Ks.Transform.toString(V),transition:W,opacity:X?.5:1},Z=()=>{F.trim()&&f(t.id,{title:F}),T(!1)},ee=()=>{G.trim()&&(i(t.id,G),_(""),z(!1),t.collapsed&&d(t.id))},et=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!x)return void R.oR.error("Please add an API key in the settings to use AI features.");try{J(!0),B(!1);let r=e?q.trim():void 0;if(l)await l(t.id,t.title,r);else try{let e=r?"".concat(t.title," (Context: ").concat(r,")"):t.title,n=await I(e,x);n&&n.tasks.length>0?(n.tasks.forEach(e=>{i(t.id,e.title)}),R.oR.success('Generated new subtasks for "'.concat(t.title,'".'))):R.oR.info("The AI didn't generate any tasks for \"".concat(t.title,'".'))}catch(e){console.error("AI generation failed:",e),e instanceof Error?R.oR.error(e.message):R.oR.error("An unknown error occurred. Please try again.")}t.collapsed&&d(t.id)}finally{J(!1)}},er=t.children.length>0,en="completed"===t.status,ea=24*r;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.lG,{open:K,onOpenChange:B,children:(0,n.jsxs)(E.Cf,{className:"sm:max-w-md",children:[(0,n.jsxs)(E.c7,{children:[(0,n.jsx)(E.L3,{children:"Add Context for AI"}),(0,n.jsxs)(E.rr,{children:['Provide any additional context for "',t.title,'" to help the AI generate more relevant tasks. This is optional.']})]}),(0,n.jsx)("div",{className:"grid gap-4 py-4",children:(0,n.jsx)(P,{placeholder:"e.g., This is for a personal fitness plan; I prefer home workouts and have limited equipment...",className:"min-h-[100px]",value:q,onChange:e=>H(e.target.value)})}),(0,n.jsxs)(E.Es,{children:[(0,n.jsx)(c.$,{variant:"outline",onClick:()=>et(!1),disabled:L,children:"Skip Context"}),(0,n.jsx)(c.$,{onClick:()=>et(!0),disabled:L,children:"Use Context"})]})]})}),(0,n.jsxs)("div",{ref:Q,style:Y,className:(0,s.cn)("group relative mb-1 rounded-md",X&&"z-10",k.includes(t.id)&&"bg-blue-100 dark:bg-blue-900/50 animate-pulse"),children:[(0,n.jsxs)("div",{className:(0,s.cn)("flex items-center gap-2 rounded-md border p-2 transition-colors hover:bg-muted/40",en&&"bg-muted/30"),style:{paddingLeft:"".concat(ea+8,"px")},children:[(0,n.jsx)("button",{className:"cursor-grab opacity-0 group-hover:opacity-100 focus:opacity-100",...M,...U,children:(0,n.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"})}),er?(0,n.jsx)("button",{onClick:()=>{d(t.id)},className:"flex h-5 w-5 items-center justify-center rounded-sm hover:bg-muted",children:t.collapsed?(0,n.jsx)(j.A,{className:"h-4 w-4"}):(0,n.jsx)(w.A,{className:"h-4 w-4"})}):(0,n.jsx)("div",{className:"w-5"}),(0,n.jsx)(b,{id:"task-".concat(t.id),checked:en,onCheckedChange:()=>{o(t.id)}}),O?(0,n.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,n.jsx)(u.p,{value:F,onChange:e=>D(e.target.value),onKeyDown:e=>{"Enter"===e.key?Z():"Escape"===e.key&&T(!1)},className:"flex-1",autoFocus:!0}),(0,n.jsx)(c.$,{size:"sm",onClick:Z,children:"Save"}),(0,n.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>T(!1),children:"Cancel"})]}):(0,n.jsx)("label",{htmlFor:"task-".concat(t.id),className:(0,s.cn)("flex-1 cursor-pointer select-none",en&&"text-muted-foreground line-through"),children:t.title}),!O&&(0,n.jsxs)("div",{className:"flex gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[(0,n.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{T(!0),D(t.title)},title:"Edit",children:(0,n.jsx)(N.A,{className:"h-4 w-4"})}),(0,n.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>z(!0),title:"Add subtask",children:(0,n.jsx)(C.A,{className:"h-4 w-4"})}),(0,n.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{if(!x)return void R.oR.error("Please add an API key in the settings to use AI features.");H(""),B(!0)},disabled:L||!x,title:"AI breakdown",children:(0,n.jsx)(A.A,{className:(0,s.cn)("h-4 w-4",L&&"animate-pulse")})}),(0,n.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:bg-destructive/10",onClick:()=>{m(t.id)},title:"Delete",children:(0,n.jsx)(S.A,{className:"h-4 w-4"})})]})]}),$&&(0,n.jsxs)("div",{className:"ml-14 mt-1 flex items-center gap-2 rounded-md border p-2",style:{marginLeft:"".concat(ea+56,"px")},children:[(0,n.jsx)(u.p,{placeholder:"Enter subtask name...",value:G,onChange:e=>_(e.target.value),onKeyDown:e=>{"Enter"===e.key?ee():"Escape"===e.key&&z(!1)},className:"flex-1",autoFocus:!0}),(0,n.jsx)(c.$,{size:"sm",onClick:ee,children:"Add"}),(0,n.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>z(!1),children:"Cancel"})]})]})]})}var T=r(172);function F(){let{tasks:e,addSubtask:t,moveTask:r,reorderTasks:s,apiKey:i,findTaskAndParent:l,getTaskBreadcrumb:o,lastBreakdown:d,undoLastBreakdown:c,clearLastBreakdown:u,setLastBreakdown:f,setRecentlyAddedTaskIds:g}=(0,h.r)(),[k,v]=(0,a.useState)(null),[b,y]=(0,a.useState)(!1),j=(0,m.FR)((0,m.MS)(m.AN,{activationConstraint:{distance:8}})),w=t=>{let r=e=>{for(let n of e){if(n.id===t)return n;if(n.children.length>0){let e=r(n.children);if(e)return e}}return null};return r(e)},N=async(e,r,n)=>{if(!i)return void R.oR.error("Please add an API key in the settings to use AI features.");y(!0);try{var a;let s=(e=>{let t=e;for(;;){let e=l(t);if(!e)return w(t);if(!e.parent)return e.task;t=e.parent.id}})(e);if(!s){R.oR.error("Could not find the task to break down."),y(!1);return}let d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r="  ".repeat(t),n="".concat(r,"- ").concat(e.title,"\n");for(let r of e.children)n+=d(r,t+1);return n},c="For context, here is the entire task tree that the current task belongs to:\n".concat(d(s)," \n\nDo not repeat tasks already mentioned, if you need to repeat, make it more specific."),u=w(e),h=new Set(null!=(a=null==u?void 0:u.children.map(e=>e.title.trim().toLowerCase()))?a:[]),m=o(e),p=u&&u.children.length>0?"Please do not generate the following tasks as they already exist: ".concat(u.children.map(e=>'"'.concat(e.title,'"')).join(", "),"."):"",x=n?"".concat(c,"\n\nBased on the tree above, break down the task: ").concat(m," (Additional Context: ").concat(n,"). ").concat(p," Use the same language as the task."):"".concat(c,"\n\nBased on the tree above, break down the task: ").concat(m,". ").concat(p," Use the same language as the task."),k=await I(x,i);if(k&&k.tasks.length>0){let n=k.tasks.filter(e=>!h.has(e.title.trim().toLowerCase()));if(n.length>0){let a=[];for(let r of n){let n=t(e,{title:r.title,status:"pending"});a.push(n.id);let s=l(e);if(!s)continue;let i=s.task;if(!i||!i.children||0===i.children.length)continue;let o=i.children[i.children.length-1];if(r.subtasks&&r.subtasks.length>0)for(let e of r.subtasks){let r=t(o.id,{title:e.title,status:"pending"});a.push(r.id)}}f(e,a),g(a),R.oR.success('Generated new subtasks for "'.concat(r,'".'))}else R.oR.info('No new unique tasks were generated for "'.concat(r,'".'))}else R.oR.info("The AI didn't generate any tasks for \"".concat(r,'".'))}catch(e){console.error("AI generation failed:",e),e instanceof Error?R.oR.error(e.message):R.oR.error("An unknown error occurred. Please try again.")}finally{y(!1)}},C=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map(e=>(0,n.jsxs)("div",{children:[(0,n.jsx)(O,{task:e,level:r,addSubtask:(e,r)=>{"string"==typeof r?t(e,{title:r,status:"pending"}):t(e,r)},aiBreakdown:N}),!e.collapsed&&e.children.length>0&&(0,n.jsx)("div",{children:(0,n.jsx)(p.gB,{items:e.children.map(e=>e.id),strategy:p._G,children:C(e.children,r+1)})})]},e.id))},A=k?w(k):null,S=e.map(e=>e.id);return(0,n.jsxs)(n.Fragment,{children:[b&&(0,n.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-background/80 z-50",children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2 p-4 rounded-md bg-card border shadow-md",children:[(0,n.jsx)(T.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,n.jsx)("p",{children:"Generating tasks with AI..."})]})}),(0,n.jsxs)(m.Mp,{sensors:j,collisionDetection:m.fp,onDragStart:e=>{v(e.active.id)},onDragOver:e=>{let{active:t,over:r}=e;if(!r||t.id===r.id)return;let n=t.id,a=r.id,s=w(n),i=w(a);if(!s||!i)return;let l=(e,t)=>e.id===t||e.children.some(e=>l(e,t));if(l(s,a))return},onDragEnd:t=>{v(null);let{active:r,over:n}=t;if(n){if(r.id!==n.id){let t=r.id,a=n.id,i=w(t),l=w(a);if(!i||!l)return;let o=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(let n=0;n<t.length;n++){if(t[n].id===e)return{parent:r,index:n};if(t[n].children.length>0){let r=o(e,t[n].children,t[n]);if(null!==r.parent)return r}}return{parent:null,index:-1}},{parent:d,index:c}=o(t,e),{parent:u,index:h}=o(a,e);if(d===u)if(null===d)s((0,p.be)(e,c,h));else{let t=(0,p.be)(d.children,c,h),r=(e,t,n)=>e.map(e=>e.id===t?{...e,children:n}:e.children&&e.children.length>0?{...e,children:r(e.children,t,n)}:e);s(r(e,d.id,t))}}u()}},modifiers:[x.FN],children:[(0,n.jsx)("div",{className:"space-y-1",children:0===e.length?(0,n.jsx)("div",{className:"rounded-md border border-dashed p-6 text-center text-muted-foreground",children:"No tasks yet. Create your first task below."}):(0,n.jsx)(p.gB,{items:S,strategy:p._G,children:C(e)})}),(0,n.jsx)(m.Hd,{children:k&&A&&(0,n.jsx)("div",{className:"w-full opacity-70",children:(0,n.jsx)(O,{task:A,level:0,addSubtask:()=>{}})})})]})]})}function D(){return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(F,{}),(0,n.jsxs)(i,{children:[(0,n.jsx)(l,{children:(0,n.jsx)(o,{children:"Add a New Goal"})}),(0,n.jsx)(d,{children:(0,n.jsx)(f,{})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[113,749,816,441,684,358],()=>t(3420)),_N_E=e.O()}]);