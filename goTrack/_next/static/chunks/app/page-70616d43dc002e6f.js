(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3420:(e,t,n)=>{Promise.resolve().then(n.bind(n,9223))},9223:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>F});var r=n(5155),a=n(2115),s=n(9434);let i=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-xl border bg-card text-card-foreground shadow",n),...a})});i.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...a})});l.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("font-semibold leading-none tracking-tight",n),...a})});o.displayName="CardTitle",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",n),...a})}).displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",n),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",n),...a})}).displayName="CardFooter";var c=n(285),u=n(2523),h=n(2730);function m(){let{addTask:e}=(0,h.r)(),[t,n]=(0,a.useState)(""),s=()=>{t.trim()&&(e({title:t,status:"pending"}),n(""))};return(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(u.p,{placeholder:"Enter a new goal...",value:t,onChange:e=>n(e.target.value),onKeyDown:e=>{"Enter"===e.key&&s()},className:"flex-1"}),(0,r.jsx)(c.$,{onClick:s,disabled:!t.trim(),children:"Create Goal"})]})}var f=n(5143),p=n(402),x=n(1206),g=n(8266),k=n(7820),v=n(518);let b=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(k.bL,{ref:t,className:(0,s.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",n),...a,children:(0,r.jsx)(k.C1,{className:(0,s.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(v.A,{className:"h-4 w-4"})})})});b.displayName=k.bL.displayName;var y=n(295),j=n(3158),w=n(9556),N=n(5943),C=n(8046),A=n(9829),I=n(7223);async function S(e,t){if(!t)throw Error("API key is required");try{var n,r,a,s,i,l;let o=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:'You are an AI task planner.\n**Output rules:**\n- Use a hierarchical JSON structure.\n- Maximum depth: **{N} level(s)**.\n  - Level 1: Direct subtasks of the main task.\n  - Each subtask may have its own `"subtasks"` array containing further breakdowns.\n  - Continue breaking down subtasks until the maximum depth is reached.\n- Do not generate tasks deeper than **{N} levels**.\n- If no additional context is provided, max depth is 1.\n- Any task at the maximum depth must have `"subtasks": []`.\n- Do **not** repeat the main task as a subtask.\n- The output must start with a `"tasks"` array — do not wrap the main task in it.\n- **Output valid JSON only** — no markdown or commentary. Do not wrap your answer with ```json.\n\n**Example structure (generic for depth = 3):**\n{\n  "tasks": [\n    {\n      "title": "Subtask 1",\n      "subtasks": [\n        {\n          "title": "Sub-subtask 1.1",\n          "subtasks": [\n            {\n              "title": "Sub-sub-subtask 1.1.1",\n              "subtasks": []\n            }\n          ]\n        }\n      ]\n    }\n  ]\n} \n'.concat(e,"\n")}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:8192}})}),d=await o.json();if(!o.ok){let e=(null==d||null==(i=d.error)?void 0:i.message)||"An unknown API error occurred.";if(e.includes("API key not valid"))throw Error("Invalid API Key. Please check it in the settings.");throw Error("API Error: ".concat(e))}let c=null==d||null==(r=d.candidates)||null==(n=r[0])?void 0:n.content;if(!c){let e=null==d||null==(l=d.promptFeedback)?void 0:l.blockReason;if(e)throw Error("Content blocked by API for reason: ".concat(e,"."));throw console.error("Invalid API response format:",d),Error("The AI did not return a valid response. Please try again.")}let u=null==(s=c.parts)||null==(a=s[0])?void 0:a.text;if(!u)return console.error("No text found in response parts:",c),null;try{let e=u.match(/(\{[\s\S]*\})/),t=e?e[1]:u;return JSON.parse(t)}catch(e){return console.error("Failed to parse JSON from response:",u,e),null}}catch(e){throw console.error("Error calling Gemini API:",e),e}}var E=n(4165);let P=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("textarea",{className:(0,s.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...a})});P.displayName="Textarea";var R=n(6671);function D(e){let{task:t,level:n,addSubtask:i,aiBreakdown:l}=e,{toggleTaskStatus:o,toggleCollapsed:d,updateTask:m,deleteTask:f,apiKey:x,recentlyAddedTaskIds:k,setRecentlyAddedTaskIds:v}=(0,h.r)(),[D,T]=(0,a.useState)(!1),[O,F]=(0,a.useState)(t.title),[$,z]=(0,a.useState)(!1),[G,L]=(0,a.useState)(""),[_,K]=(0,a.useState)(!1),[B,J]=(0,a.useState)(!1),[U,q]=(0,a.useState)("");(0,a.useEffect)(()=>{if(k.includes(t.id)){let e=setTimeout(()=>{v([])},2e3);return()=>clearTimeout(e)}},[k,t.id,v]);let{attributes:M,listeners:H,setNodeRef:Y,transform:Q,transition:V,isDragging:W}=(0,p.gl)({id:t.id}),X={transform:g.Ks.Transform.toString(Q),transition:V,opacity:W?.5:1},Z=()=>{O.trim()&&m(t.id,{title:O}),T(!1)},ee=()=>{G.trim()&&(i(t.id,G),L(""),z(!1),t.collapsed&&d(t.id))},et=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!x)return void R.oR.error("Please add an API key in the settings to use AI features.");try{K(!0),J(!1);let n=e?U.trim():void 0;if(l)await l(t.id,t.title,n);else try{let e=n?"".concat(t.title," (Context: ").concat(n,")"):t.title,r=await S(e,x);r&&r.tasks.length>0?(r.tasks.forEach(e=>{i(t.id,e.title)}),R.oR.success('Generated new subtasks for "'.concat(t.title,'".'))):R.oR.info("The AI didn't generate any tasks for \"".concat(t.title,'".'))}catch(e){console.error("AI generation failed:",e),e instanceof Error?R.oR.error(e.message):R.oR.error("An unknown error occurred. Please try again.")}t.collapsed&&d(t.id)}finally{K(!1)}},en=t.children.length>0,er="completed"===t.status,ea=24*n;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E.lG,{open:B,onOpenChange:J,children:(0,r.jsxs)(E.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(E.c7,{children:[(0,r.jsx)(E.L3,{children:"Add Context for AI"}),(0,r.jsxs)(E.rr,{children:['Provide any additional context for "',t.title,'" to help the AI generate more relevant tasks. This is optional.']})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsx)(P,{placeholder:"e.g., This is for a personal fitness plan; I prefer home workouts and have limited equipment...",className:"min-h-[100px]",value:U,onChange:e=>q(e.target.value)})}),(0,r.jsxs)(E.Es,{children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>et(!1),disabled:_,children:"Skip Context"}),(0,r.jsx)(c.$,{onClick:()=>et(!0),disabled:_,children:"Use Context"})]})]})}),(0,r.jsxs)("div",{ref:Y,style:X,className:(0,s.cn)("group relative mb-1 rounded-md",W&&"z-10",k.includes(t.id)&&"bg-blue-100 dark:bg-blue-900/50 animate-pulse"),children:[(0,r.jsxs)("div",{className:(0,s.cn)("flex items-center gap-2 rounded-md border p-2 transition-colors hover:bg-muted/40",er&&"bg-muted/30"),style:{paddingLeft:"".concat(ea+8,"px")},children:[(0,r.jsx)("button",{className:"cursor-grab opacity-0 group-hover:opacity-100 focus:opacity-100",...M,...H,children:(0,r.jsx)(y.A,{className:"h-4 w-4 text-muted-foreground"})}),en?(0,r.jsx)("button",{onClick:()=>{d(t.id)},className:"flex h-5 w-5 items-center justify-center rounded-sm hover:bg-muted",children:t.collapsed?(0,r.jsx)(j.A,{className:"h-4 w-4"}):(0,r.jsx)(w.A,{className:"h-4 w-4"})}):(0,r.jsx)("div",{className:"w-5"}),(0,r.jsx)(b,{id:"task-".concat(t.id),checked:er,onCheckedChange:()=>{o(t.id)}}),D?(0,r.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,r.jsx)(u.p,{value:O,onChange:e=>F(e.target.value),onKeyDown:e=>{"Enter"===e.key?Z():"Escape"===e.key&&T(!1)},className:"flex-1",autoFocus:!0}),(0,r.jsx)(c.$,{size:"sm",onClick:Z,children:"Save"}),(0,r.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>T(!1),children:"Cancel"})]}):(0,r.jsx)("label",{htmlFor:"task-".concat(t.id),className:(0,s.cn)("flex-1 cursor-pointer select-none",er&&"text-muted-foreground line-through"),children:t.title}),!D&&(0,r.jsxs)("div",{className:"flex gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{T(!0),F(t.title)},title:"Edit",children:(0,r.jsx)(N.A,{className:"h-4 w-4"})}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>z(!0),title:"Add subtask",children:(0,r.jsx)(C.A,{className:"h-4 w-4"})}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{if(!x)return void R.oR.error("Please add an API key in the settings to use AI features.");q(""),J(!0)},disabled:_||!x,title:"AI breakdown",children:(0,r.jsx)(A.A,{className:(0,s.cn)("h-4 w-4",_&&"animate-pulse")})}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:bg-destructive/10",onClick:()=>{f(t.id)},title:"Delete",children:(0,r.jsx)(I.A,{className:"h-4 w-4"})})]})]}),$&&(0,r.jsxs)("div",{className:"ml-14 mt-1 flex items-center gap-2 rounded-md border p-2",style:{marginLeft:"".concat(ea+56,"px")},children:[(0,r.jsx)(u.p,{placeholder:"Enter subtask name...",value:G,onChange:e=>L(e.target.value),onKeyDown:e=>{"Enter"===e.key?ee():"Escape"===e.key&&z(!1)},className:"flex-1",autoFocus:!0}),(0,r.jsx)(c.$,{size:"sm",onClick:ee,children:"Add"}),(0,r.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>z(!1),children:"Cancel"})]})]})]})}var T=n(172);function O(){let{tasks:e,addSubtask:t,moveTask:n,reorderTasks:s,apiKey:i,findTaskAndParent:l,getTaskBreadcrumb:o,lastBreakdown:d,undoLastBreakdown:c,clearLastBreakdown:u,setLastBreakdown:m,setRecentlyAddedTaskIds:g}=(0,h.r)(),[k,v]=(0,a.useState)(null),[b,y]=(0,a.useState)(!1),j=(0,f.FR)((0,f.MS)(f.AN,{activationConstraint:{distance:8}})),w=t=>{let n=e=>{for(let r of e){if(r.id===t)return r;if(r.children.length>0){let e=n(r.children);if(e)return e}}return null};return n(e)},N=async(e,n,r)=>{if(!i)return void R.oR.error("Please add an API key in the settings to use AI features.");y(!0);try{var a;let s=(e=>{let t=e;for(;;){let e=l(t);if(!e)return w(t);if(!e.parent)return e.task;t=e.parent.id}})(e);if(!s){R.oR.error("Could not find the task to break down."),y(!1);return}let d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n="  ".repeat(t),r="".concat(n,"- ").concat(e.title,"\n");for(let n of e.children)r+=d(n,t+1);return r},c="For context, here is the entire task tree that the current task belongs to:\n".concat(d(s)," \n\nDo not repeat tasks already mentioned, If you must repeat for clarity, make the subtask more specific or add new details."),u=w(e),h=new Set(null!=(a=null==u?void 0:u.children.map(e=>e.title.trim().toLowerCase()))?a:[]),f=o(e),p=u&&u.children.length>0?"Please do not generate the following tasks as they already exist: ".concat(u.children.map(e=>'"'.concat(e.title,'"')).join(", "),"."):"",x=r?"".concat(c,"\n\nBreak down the task: ").concat(f," (Additional Context: ").concat(r,"). ").concat(p," Use the same language as the task."):"".concat(c,"\n\nBreak down the task: ").concat(f,". ").concat(p," Use the same language as the task."),k=await S(x,i);if(k&&k.tasks.length>0){let r=k.tasks.filter(e=>!h.has(e.title.trim().toLowerCase()));if(r.length>0){let a=(e,n)=>{for(let r of n){let n=t(e,{title:r.title,status:"pending"});s.push(n.id),r.subtasks&&r.subtasks.length>0&&a(n.id,r.subtasks)}},s=[];for(let n of r){let r=t(e,{title:n.title,status:"pending"});s.push(r.id);let i=l(e);if(!i)continue;let o=i.task;if(!o||!o.children||0===o.children.length)continue;let d=o.children[o.children.length-1];n.subtasks&&n.subtasks.length>0&&a(d.id,n.subtasks)}m(e,s),g(s),R.oR.success('Generated new subtasks for "'.concat(n,'".'))}else R.oR.info('No new unique tasks were generated for "'.concat(n,'".'))}else R.oR.info("The AI didn't generate any tasks for \"".concat(n,'".'))}catch(e){console.error("AI generation failed:",e),e instanceof Error?R.oR.error(e.message):R.oR.error("An unknown error occurred. Please try again.")}finally{y(!1)}},C=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsx)(D,{task:e,level:n,addSubtask:(e,n)=>{"string"==typeof n?t(e,{title:n,status:"pending"}):t(e,n)},aiBreakdown:N}),!e.collapsed&&e.children.length>0&&(0,r.jsx)("div",{children:(0,r.jsx)(p.gB,{items:e.children.map(e=>e.id),strategy:p._G,children:C(e.children,n+1)})})]},e.id))},A=k?w(k):null,I=e.map(e=>e.id);return(0,r.jsxs)(r.Fragment,{children:[b&&(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-background/80 z-50",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 p-4 rounded-md bg-card border shadow-md",children:[(0,r.jsx)(T.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{children:"Generating tasks with AI..."})]})}),(0,r.jsxs)(f.Mp,{sensors:j,collisionDetection:f.fp,onDragStart:e=>{v(e.active.id)},onDragOver:e=>{let{active:t,over:n}=e;if(!n||t.id===n.id)return;let r=t.id,a=n.id,s=w(r),i=w(a);if(!s||!i)return;let l=(e,t)=>e.id===t||e.children.some(e=>l(e,t));if(l(s,a))return},onDragEnd:t=>{v(null);let{active:n,over:r}=t;if(r){if(n.id!==r.id){let t=n.id,a=r.id,i=w(t),l=w(a);if(!i||!l)return;let o=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(let r=0;r<t.length;r++){if(t[r].id===e)return{parent:n,index:r};if(t[r].children.length>0){let n=o(e,t[r].children,t[r]);if(null!==n.parent)return n}}return{parent:null,index:-1}},{parent:d,index:c}=o(t,e),{parent:u,index:h}=o(a,e);if(d===u)if(null===d)s((0,p.be)(e,c,h));else{let t=(0,p.be)(d.children,c,h),n=(e,t,r)=>e.map(e=>e.id===t?{...e,children:r}:e.children&&e.children.length>0?{...e,children:n(e.children,t,r)}:e);s(n(e,d.id,t))}}u()}},modifiers:[x.FN],children:[(0,r.jsx)("div",{className:"space-y-1",children:0===e.length?(0,r.jsx)("div",{className:"rounded-md border border-dashed p-6 text-center text-muted-foreground",children:"No tasks yet. Create your first task below."}):(0,r.jsx)(p.gB,{items:I,strategy:p._G,children:C(e)})}),(0,r.jsx)(f.Hd,{children:k&&A&&(0,r.jsx)("div",{className:"w-full opacity-70",children:(0,r.jsx)(D,{task:A,level:0,addSubtask:()=>{}})})})]})]})}function F(){return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(O,{}),(0,r.jsxs)(i,{children:[(0,r.jsx)(l,{children:(0,r.jsx)(o,{children:"Add a New Goal"})}),(0,r.jsx)(d,{children:(0,r.jsx)(m,{})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[113,749,816,441,684,358],()=>t(3420)),_N_E=e.O()}]);