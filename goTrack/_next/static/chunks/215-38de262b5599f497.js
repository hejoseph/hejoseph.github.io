(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[215],{285:(e,t,a)=>{"use strict";a.d(t,{$:()=>d});var r=a(5155),s=a(2115),n=a(9708),i=a(2085),l=a(9434);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:a,variant:s,size:i,asChild:d=!1,...c}=e,u=d?n.DX:"button";return(0,r.jsx)(u,{className:(0,l.cn)(o({variant:s,size:i,className:a})),ref:t,...c})});d.displayName="Button"},2523:(e,t,a)=>{"use strict";a.d(t,{p:()=>i});var r=a(5155),s=a(2115),n=a(9434);let i=s.forwardRef((e,t)=>{let{className:a,type:s,...i}=e;return(0,r.jsx)("input",{type:s,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...i})});i.displayName="Input"},2730:(e,t,a)=>{"use strict";a.d(t,{r:()=>f});var r=a(5453),s=a(6786),n=a(1368),i=a(6279),l=a(3297);let o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a="  ".repeat(t),r="".concat(a,"- ").concat(e.title,"\n");for(let a of e.children)r+=o(a,t+1);return r},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeCompleted:!0,includeStatus:!1,includeBullets:!0};if(!a.includeCompleted&&"completed"===e.status||void 0!==a.maxDepth&&t>a.maxDepth)return"";let r="  ".repeat(t),s=a.includeStatus?"completed"===e.status?"[✓] ":"[ ] ":"",n=a.includeBullets?"- ":"",i="".concat(r).concat(n).concat(s).concat(e.title,"\n");for(let r of e.children)i+=d(r,t+1,a);return i},c=(e,t)=>{for(let a of e){if(a.id===t)return a;if(a.children.length>0){let e=c(a.children,t);if(e)return e}}return null},u=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(let r of e){if(r.id===t)return{task:r,parent:a};if(r.children.length>0){let e=u(r.children,t,r);if(e)return e}}return null},h=(e,t)=>{if(!t.parentId)return t;let a=t;for(;a.parentId;){let t=u(e,a.parentId);if(!t)break;if(!t.parent)return t.task;a=t.parent}return a},p=(e,t)=>e.filter(e=>e.id!==t&&(e.children=p(e.children,t),!0)),m={"Learn a Programming Language":[{id:(0,n.A)(),title:"Learn the Basics",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[{id:(0,n.A)(),title:"Set up development environment",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[]},{id:(0,n.A)(),title:"Learn syntax fundamentals",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[]}]},{id:(0,n.A)(),title:"Build Projects",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[{id:(0,n.A)(),title:"Simple utility program",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[]},{id:(0,n.A)(),title:"Small application",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[]}]}],"Start a Fitness Routine":[{id:(0,n.A)(),title:"Set Fitness Goals",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[{id:(0,n.A)(),title:"Define specific measurable targets",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[]},{id:(0,n.A)(),title:"Set realistic timeline",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[]}]},{id:(0,n.A)(),title:"Create Workout Plan",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[{id:(0,n.A)(),title:"Choose exercise types",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[]},{id:(0,n.A)(),title:"Schedule workout days",status:"pending",collapsed:!1,createdAt:new Date,updatedAt:new Date,children:[]}]}]},f=(0,r.v)()((0,s.Zr)((e,t)=>({tasks:[],templates:m,collapsedState:{},apiKey:"",aiProvider:"gemini",lastBreakdown:null,recentlyAddedTaskIds:[],scrollToTaskId:null,activeChatTask:null,chatConversations:{},deletedTasksHistory:[],setActiveChatTask:t=>e({activeChatTask:t}),setChatConversation:(t,a)=>{e(e=>({chatConversations:{...e.chatConversations,[t]:a}}))},setRecentlyAddedTaskIds:t=>{e({recentlyAddedTaskIds:t})},setScrollToTaskId:t=>e({scrollToTaskId:t}),addTask:t=>{let a={id:(0,n.A)(),...t,children:[],collapsed:!1,createdAt:new Date,updatedAt:new Date};e(e=>({tasks:[...e.tasks,a],lastBreakdown:null,recentlyAddedTaskIds:[a.id]}))},addSubtask:(t,a)=>{let r={id:(0,n.A)(),...a,children:[],collapsed:!1,parentId:t,createdAt:new Date,updatedAt:new Date};return e(e=>{let a=e=>e.map(e=>e.id===t?{...e,children:[...e.children,r]}:e.children.length>0?{...e,children:a(e.children)}:e);return{tasks:a(e.tasks),lastBreakdown:null,recentlyAddedTaskIds:[r.id]}}),r},updateTask:(t,a)=>{e(e=>{let r=e=>e.map(e=>e.id===t?{...e,...a,updatedAt:new Date}:e.children.length>0?{...e,children:r(e.children)}:e);return{tasks:r(e.tasks),lastBreakdown:null}})},deleteTask:t=>{e(e=>{let a=c(e.tasks,t),r=null;a&&a.parentId&&(r=a.parentId);let s=p(e.tasks,t),n=e.activeChatTask;return e.activeChatTask&&e.activeChatTask.id===t&&(n=null),{tasks:s,lastBreakdown:null,activeChatTask:n,deletedTasksHistory:a?[...e.deletedTasksHistory,{task:a,parentId:r}]:e.deletedTasksHistory}})},toggleTaskStatus:e=>{let{findTask:a}=t(),r=a(e);if(r){let a="completed"===r.status?"pending":"completed";t().updateTask(e,{status:a})}},toggleCollapsed:t=>{e(e=>{let a=e=>e.map(e=>e.id===t?{...e,collapsed:!e.collapsed}:e.children.length>0?{...e,children:a(e.children)}:e);return{tasks:a(e.tasks)}})},reorderTasks:t=>{e(()=>({tasks:t,lastBreakdown:null}))},moveTask:(a,r,s)=>{e(e=>{let n=t().findTaskAndParent(a);if(!n)return e;let{task:i,parent:l}=n,o={...i},d=p(e.tasks,a);if(!r)return{tasks:d=[...d.slice(0,s),o,...d.slice(s)],lastBreakdown:null};let c=e=>e.map(e=>{if(e.id===r){o.parentId=e.id;let t=[...e.children.slice(0,s),o,...e.children.slice(s)];return{...e,children:t}}return e.children.length>0?{...e,children:c(e.children)}:e});return{tasks:c(d),lastBreakdown:null}})},setApiKey:t=>{e({apiKey:t})},setAiProvider:t=>{e({aiProvider:t})},findTask:e=>c(t().tasks,e),findTaskAndParent:e=>u(t().tasks,e),getTaskBreadcrumb:e=>{let a=(e,t,r)=>{for(let s of e){let e=[...r,s.title];if(s.id===t)return e;if(s.children.length>0){let r=a(s.children,t,e);if(r)return r}}return null},r=a(t().tasks,e,[]);return r?r.join(" > "):""},getMainTask:e=>h(t().tasks,e),setLastBreakdown:(t,a)=>{e({lastBreakdown:{parentId:t,addedIds:a}})},clearLastBreakdown:()=>{e({lastBreakdown:null})},undoLastBreakdown:()=>{e(e=>{if(!e.lastBreakdown)return e;let{parentId:t,addedIds:a}=e.lastBreakdown,r=e=>e.map(e=>e.id===t?{...e,children:e.children.filter(e=>!a.includes(e.id))}:e.children.length>0?{...e,children:r(e.children)}:e);return{tasks:r(e.tasks),lastBreakdown:null}})},undoLastDeletion:()=>{e(e=>{let t=e.deletedTasksHistory.pop();if(!t)return e;let{task:a,parentId:r}=t,s=e=>null===r?[...e,a]:e.map(e=>e.id===r?{...e,children:[...e.children,a]}:e.children.length>0?{...e,children:s(e.children)}:e);return{tasks:s(e.tasks),deletedTasksHistory:[...e.deletedTasksHistory],activeChatTask:a}})},breakdownTaskWithAI:async(e,a)=>{let{apiKey:r,aiProvider:s,findTask:n,getTaskBreadcrumb:d,addSubtask:c,setLastBreakdown:u,setRecentlyAddedTaskIds:h,getMainTask:p,chatConversations:m}=t(),f=n(e);if("gemini"===s&&!r)return{success:!1,message:"Please add an API key in the settings to use Gemini AI features."};if(!f)return{success:!1,message:"Task not found."};let g=p(f);if(!g)return{success:!1,message:"Could not find the main task."};let x="For context, here is the entire task tree that the current task belongs to:\n".concat(o(g)," \n\nDo not repeat tasks already mentioned, If you must repeat for clarity, make the subtask more specific or add new details.\n\n"),v="This is the task or goal : ".concat(d(e)),k=f.children.length>0?"Please do not generate the following tasks as they already exist: ".concat(f.children.map(e=>'"'.concat(e.title,'"')).join(", "),"."):"",y=p(f),w=y?m[y.id]:[],b=null==w?void 0:w.map(e=>"".concat(e.role,": ").concat(e.text)).join("\n"),j="".concat(x).concat("Break down the following goal or task into clear, actionable subtasks. Make the subtasks as detailed as needed to complete the goal. Subtasks should be specific actions, not vague ideas. Avoid repeating tasks at different levels. Use concise phrasing."," ").concat(v,". ").concat(a?"(Additional Context: ".concat(a,")."):""," ").concat(b?"(Chat History: ".concat(b,")."):""," ").concat(k," Use the same language as the task.");try{let t=await (0,i.s$)(j,r,s);if(!t||!(t.tasks.length>0))return{success:!0,message:"The AI didn't generate any tasks for \"".concat(f.title,'".')};{l.vF.log(t);let a=new Set(f.children.map(e=>e.title.trim().toLowerCase())),r=t.tasks.filter(e=>!a.has(e.title.trim().toLowerCase()));if(0===r.length)return{success:!0,message:'No new unique tasks were generated for "'.concat(f.title,'".')};let s=[],n=(e,t)=>{for(let a of t){let t=c(e,{title:a.title,status:"pending"});s.push(t.id),a.subtasks&&a.subtasks.length>0&&n(t.id,a.subtasks)}};return n(e,r),u(e,s),h(s),{success:!0,message:'Generated new subtasks for "'.concat(f.title,'".')}}}catch(e){if(l.vF.error("AI generation failed:",e),e instanceof Error)return{success:!1,message:e.message};return{success:!1,message:"An unknown error occurred. Please try again."}}},exportTaskAsPlainText:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{findTask:r}=t(),s=r(e);return s?d(s,0,{includeCompleted:!0,includeStatus:!1,includeBullets:!0,...a}).trim():""}}),{name:"todo-storage"}))},3297:(e,t,a)=>{"use strict";a.d(t,{vF:()=>r});let r={log:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a]},error:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a]},warn:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a]},info:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a]},debug:function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a]},table:e=>{},group:e=>{},groupEnd:()=>{}},{log:s,error:n,warn:i,info:l,debug:o,table:d,group:c,groupEnd:u}=r},4165:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>h,Es:()=>m,L3:()=>f,c7:()=>p,lG:()=>o,rr:()=>g,zM:()=>d});var r=a(5155),s=a(2115),n=a(5452),i=a(5318),l=a(9434);let o=n.bL,d=n.l9,c=n.ZL;n.bm;let u=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.hJ,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});u.displayName=n.hJ.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,...o}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(n.UC,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:[s,(0,r.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(i.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});h.displayName=n.UC.displayName;let p=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};p.displayName="DialogHeader";let m=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};m.displayName="DialogFooter";let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.hE,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});f.displayName=n.hE.displayName;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.VY,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...s})});g.displayName=n.VY.displayName},4838:(e,t,a)=>{"use strict";a.d(t,{SQ:()=>h,_2:()=>p,rI:()=>c,ty:()=>u});var r=a(5155),s=a(2115),n=a(9449),i=a(3158),l=a(518),o=a(154),d=a(9434);let c=n.bL,u=n.l9;n.YJ,n.ZL,n.Pb,n.z6,s.forwardRef((e,t)=>{let{className:a,inset:s,children:l,...o}=e;return(0,r.jsxs)(n.ZP,{ref:t,className:(0,d.cn)("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",a),...o,children:[l,(0,r.jsx)(i.A,{className:"ml-auto"})]})}).displayName=n.ZP.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.G5,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a),...s})}).displayName=n.G5.displayName;let h=s.forwardRef((e,t)=>{let{className:a,sideOffset:s=4,...i}=e;return(0,r.jsx)(n.ZL,{children:(0,r.jsx)(n.UC,{ref:t,sideOffset:s,className:(0,d.cn)("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",a),...i})})});h.displayName=n.UC.displayName;let p=s.forwardRef((e,t)=>{let{className:a,inset:s,...i}=e;return(0,r.jsx)(n.q7,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",a),...i})});p.displayName=n.q7.displayName,s.forwardRef((e,t)=>{let{className:a,children:s,checked:i,...o}=e;return(0,r.jsxs)(n.H_,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:i,...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.VF,{children:(0,r.jsx)(l.A,{className:"h-4 w-4"})})}),s]})}).displayName=n.H_.displayName,s.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(n.hN,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.VF,{children:(0,r.jsx)(o.A,{className:"h-2 w-2 fill-current"})})}),s]})}).displayName=n.hN.displayName,s.forwardRef((e,t)=>{let{className:a,inset:s,...i}=e;return(0,r.jsx)(n.JU,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...i})}).displayName=n.JU.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...s})}).displayName=n.wv.displayName},6279:(e,t,a)=>{"use strict";function r(e){return'You are an AI task planner.\n**Output rules:**\n- Use a hierarchical JSON structure.\n- Maximum depth: **3 level(s)**.\n  - Level 1: Direct subtasks of the main task.\n  - Each subtask may have its own `"subtasks"` array containing further breakdowns.\n  - Continue breaking down subtasks until the maximum depth is reached.\n- Any task at the maximum depth must have `"subtasks": []`.\n- Do **not** repeat the main task as a subtask.\n- The output must start with a `"tasks"` array — do not wrap the main task in it.\n- **Output valid JSON only** — no markdown or commentary. Do not wrap your answer with ```json.\n\n**Example structure (generic for depth = 3):**\n{\n  "tasks": [\n    {\n      "title": "Subtask 1",\n      "subtasks": [\n        {\n          "title": "Sub-subtask 1.1",\n          "subtasks": [\n            {\n              "title": "Sub-sub-subtask 1.1.1",\n              "subtasks": []\n            }\n          ]\n        }\n      ]\n    }\n  ]\n} \n'.concat(e)}function s(e){let t=e.match(/(\{[\s\S]*\})/);return JSON.parse(t?t[1]:e)}a.d(t,{zv:()=>c,s$:()=>u,N3:()=>h});var n=a(3297);class i{async chat(e,t,a){if(!a)throw Error("API key is required for Gemini");let r=t.map(e=>({role:"assistant"===e.role?"model":e.role,parts:[{text:e.content}]})),s=t[t.length-1],i=s&&"user"===s.role&&s.content.trim()===e.trim()?r:[...r,{role:"user",parts:[{text:e}]}];n.vF.log("\uD83D\uDCE4 GEMINI REQUEST (chat) - Full payload:",{url:"".concat(this.baseUrl,"/").concat(this.model,":generateContent"),contents:i,prompt:e,historyLength:r.length});try{let e=await fetch("".concat(this.baseUrl,"/").concat(this.model,":generateContent?key=").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:i})}),t=await e.json();if(n.vF.log("\uD83E\uDD16 GEMINI RESPONSE (chat):",t),!e.ok)throw this.handleGeminiError(t);let r=this.extractTextFromGeminiResponse(t);return n.vF.log("\uD83D\uDCAC GEMINI MESSAGE (chat):",r),r}catch(e){throw n.vF.error("Error calling Gemini chat API:",e),e}}async generateTasks(e,t){if(!t)throw Error("API key is required for Gemini");let a=r(e);n.vF.log("\uD83D\uDCE4 GEMINI REQUEST (generateTasks) - Full payload:",{url:"".concat(this.baseUrl,"/").concat(this.model,":generateContent"),originalPrompt:e,taskPrompt:a,generationConfig:{temperature:.7,topK:40,topP:.95}});try{let e=await fetch("".concat(this.baseUrl,"/").concat(this.model,":generateContent?key=").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:a}]}],generationConfig:{temperature:.7,topK:40,topP:.95}})}),r=await e.json();if(n.vF.log("\uD83E\uDD16 GEMINI RESPONSE (generateTasks):",r),!e.ok)throw this.handleGeminiError(r);let s=this.extractTextFromGeminiResponse(r);return n.vF.log("\uD83D\uDCAC GEMINI MESSAGE (generateTasks):",s),this.parseTasksFromGeminiResponse(s)}catch(e){throw n.vF.error("Error calling Gemini tasks API:",e),e}}async verifyApiKey(e){if(!e)return!1;try{var t;let a=await fetch("".concat(this.baseUrl,"/").concat(this.model,":generateContent?key=").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:"Test"}]}]})}),r=await a.json();if(n.vF.log("Gemini API Key verification response:",r),a.ok)return!0;let s=(null==r||null==(t=r.error)?void 0:t.message)||"";if(s.includes("API key not valid")||s.includes("invalid")||s.includes("API_KEY_INVALID")||400===a.status)return!1;if(s.includes("quota")||s.includes("limit")||429===a.status)return n.vF.warn("Gemini API quota/limit reached, but key appears valid"),!0;return!1}catch(e){return n.vF.error("Error verifying Gemini API key:",e),!1}}extractTextFromGeminiResponse(e){var t,a,r,s,i;let l=null==e||null==(a=e.candidates)||null==(t=a[0])?void 0:t.content;if(!l){let t=null==e||null==(i=e.promptFeedback)?void 0:i.blockReason;if(t)throw Error("Content blocked by API for reason: ".concat(t,"."));throw n.vF.error("Invalid Gemini API response format:",e),Error("The AI did not return a valid response. Please try again.")}let o=null==(s=l.parts)||null==(r=s[0])?void 0:r.text;if(!o)throw n.vF.error("No text found in Gemini response parts:",l),Error("No text content in response");return o}parseTasksFromGeminiResponse(e){try{return s(e)}catch(t){throw n.vF.error("Failed to parse JSON from Gemini response:",e,t),Error("Failed to parse task structure from AI response")}}handleGeminiError(e){var t;let a=(null==e||null==(t=e.error)?void 0:t.message)||"An unknown API error occurred.";return a.includes("API key not valid")?Error("Invalid API Key. Please check it in the settings."):Error("Gemini API Error: ".concat(a))}constructor(){this.baseUrl="https://generativelanguage.googleapis.com/v1beta/models",this.model="gemini-2.5-flash"}}class l{async chat(e,t){if(!this.isPuterAvailable())throw Error("Puter.com is not available. Please make sure the Puter.js library is loaded.");try{let a=t.map(e=>({role:"model"===e.role?"assistant":e.role,content:e.content}));a.push({role:"user",content:e}),n.vF.log("\uD83D\uDCE4 PUTER REQUEST (chat) - Full payload:",{puterHistory:a,prompt:e,historyLength:t.length,originalHistory:t}),n.vF.log("\uD83D\uDD0D PUTER CHAT DEBUG - Sending chat history:",a);let r=await window.puter.ai.chat(a);n.vF.log("\uD83D\uDD0D PUTER CHAT DEBUG - Raw response:",r);let s=this.extractTextFromPuterResponse(r);return n.vF.log("\uD83D\uDCAC PUTER MESSAGE (chat):",s),s}catch(e){throw n.vF.error("Puter AI chat error:",e),Error("Puter AI Error: ".concat(e instanceof Error?e.message:"Unknown error"))}}async generateTasks(e){if(!this.isPuterAvailable())throw Error("Puter.com is not available. Please make sure the Puter.js library is loaded.");let t=r(e);n.vF.log("\uD83D\uDCE4 PUTER REQUEST (generateTasks) - Full payload:",{originalPrompt:e,taskPrompt:t,requestData:[{role:"user",content:t}]});try{n.vF.log("\uD83D\uDD0D PUTER DEBUG - Making API call to puter.ai.chat...");let e=await window.puter.ai.chat([{role:"user",content:t}]);n.vF.log("\uD83D\uDD0D PUTER DEBUG - Raw response:",e),n.vF.log("\uD83D\uDD0D PUTER DEBUG - Response type:",typeof e),n.vF.log("\uD83D\uDD0D PUTER DEBUG - Response keys:",e?Object.keys(e):"null/undefined");let a=this.extractTextFromPuterResponse(e);return n.vF.log("\uD83D\uDD0D PUTER DEBUG - Extracted response text:",a),n.vF.log("\uD83D\uDCAC PUTER MESSAGE (generateTasks):",a),this.parseTasksFromPuterResponse(a)}catch(e){if(n.vF.error("Error with Puter AI task breakdown:",e),e instanceof SyntaxError)throw Error("The AI response was not in the expected format. Please try again.");throw e}}extractTextFromPuterResponse(e){if("string"==typeof e)return e;if(e&&e.message&&e.message.content)return e.message.content;if(e&&e.content)return e.content;throw n.vF.error("\uD83D\uDD0D PUTER DEBUG - Unexpected response structure:",e),Error("Invalid response format from Puter AI")}parseTasksFromPuterResponse(e){try{let t=s(e);if(!t.tasks||!Array.isArray(t.tasks))throw n.vF.error("\uD83D\uDD0D PUTER DEBUG - Invalid result structure:",t),Error("Invalid response format: missing tasks array");return n.vF.log("\uD83D\uDD0D PUTER DEBUG - Success! Returning result:",t),t}catch(t){throw n.vF.error("\uD83D\uDD0D PUTER DEBUG - No JSON found in response:",e),Error("No valid JSON found in AI response")}}isPuterAvailable(){return window.puter}}class o{async chat(e,t,a){if(!a)throw Error("API key is required for OpenAI");let r=[...t.map(e=>({role:"model"===e.role?"assistant":e.role,content:e.content})),{role:"user",content:e}];try{let e=await fetch("".concat(this.baseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({model:this.model,messages:r,temperature:.7})}),t=await e.json();if(n.vF.log("\uD83E\uDD16 OPENAI RESPONSE (chat):",t),!e.ok)throw this.handleOpenAIError(t);let s=this.extractTextFromOpenAIResponse(t);return n.vF.log("\uD83D\uDCAC OPENAI MESSAGE (chat):",s),s}catch(e){throw n.vF.error("Error calling OpenAI chat API:",e),e}}async generateTasks(e,t){if(!t)throw Error("API key is required for OpenAI");let a=r(e);try{let e=await fetch("".concat(this.baseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({model:this.model,messages:[{role:"user",content:a}],temperature:.7})}),r=await e.json();if(n.vF.log("\uD83E\uDD16 OPENAI RESPONSE (generateTasks):",r),!e.ok)throw this.handleOpenAIError(r);let s=this.extractTextFromOpenAIResponse(r);return n.vF.log("\uD83D\uDCAC OPENAI MESSAGE (generateTasks):",s),this.parseTasksFromOpenAIResponse(s)}catch(e){throw n.vF.error("Error calling OpenAI tasks API:",e),e}}async verifyApiKey(e){if(!e)return!1;try{let t=await fetch("".concat(this.baseUrl,"/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({model:this.model,messages:[{role:"user",content:"Test"}],max_tokens:1})}),a=await t.json();return n.vF.log("OpenAI API Key verification response:",a),t.ok}catch(e){return n.vF.error("Error verifying OpenAI API key:",e),!1}}extractTextFromOpenAIResponse(e){var t,a,r;let s=null==e||null==(r=e.choices)||null==(a=r[0])||null==(t=a.message)?void 0:t.content;if(!s)throw n.vF.error("Invalid OpenAI API response format:",e),Error("The AI did not return a valid response. Please try again.");return s}parseTasksFromOpenAIResponse(e){try{return s(e)}catch(t){throw n.vF.error("Failed to parse JSON from OpenAI response:",e,t),Error("Failed to parse task structure from AI response")}}handleOpenAIError(e){var t,a;let r=(null==e||null==(t=e.error)?void 0:t.message)||"An unknown API error occurred.";return(null==e||null==(a=e.error)?void 0:a.code)==="invalid_api_key"?Error("Invalid API Key. Please check it in the settings."):Error("OpenAI API Error: ".concat(r))}constructor(){this.baseUrl="https://api.openai.com/v1",this.model="gpt-4o-mini"}}function d(e){switch(e){case"gemini":return new i;case"puter":return new l;case"openai":return new o;default:throw Error("Unsupported AI provider: ".concat(e))}}async function c(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"gemini";try{let s=d(r),n=a.map(e=>({role:e.role,content:e.parts.map(e=>e.text).join(" ")}));return await s.chat(e,n,t)}catch(e){throw n.vF.error("Error with ".concat(r," chat:"),e),e}}async function u(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"gemini";try{let r=d(a);return await r.generateTasks(e,t)}catch(e){throw n.vF.error("Error with ".concat(a," task generation:"),e),e}}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"gemini";try{let a=d(t);if(a.verifyApiKey)return await a.verifyApiKey(e);return!0}catch(e){return n.vF.error("Error verifying ".concat(t," API key:"),e),!1}}},7313:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>d,av:()=>c,j7:()=>o,tU:()=>l});var r=a(5155),s=a(2115),n=a(9669),i=a(9434);let l=n.bL,o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.B8,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...s})});o.displayName=n.B8.displayName;let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.l9,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...s})});d.displayName=n.l9.displayName;let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.UC,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s})});c.displayName=n.UC.displayName},7528:()=>{},9215:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>M});var r=a(5155),s=a(2115),n=a(9434);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",a),...s})});i.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});l.displayName="CardHeader";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",a),...s})});o.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})}).displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter";var c=a(285),u=a(2523),h=a(2730);function p(){let{addTask:e}=(0,h.r)(),[t,a]=(0,s.useState)(""),n=()=>{t.trim()&&(e({title:t,status:"pending"}),a(""))};return(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(u.p,{placeholder:"Enter a new goal...",value:t,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"===e.key&&n()},className:"flex-1"}),(0,r.jsx)(c.$,{onClick:n,disabled:!t.trim(),children:"Create Goal"})]})}var m=a(5143),f=a(402),g=a(1206),x=a(8266),v=a(6981),k=a(518);let y=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(v.bL,{ref:t,className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...s,children:(0,r.jsx)(v.C1,{className:(0,n.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(k.A,{className:"h-4 w-4"})})})});y.displayName=v.bL.displayName;var w=a(3096),b=a(295),j=a(3158),A=a(9556),N=a(5943),T=a(8046),E=a(9829),C=a(8718),I=a(7223),P=a(6279),S=a(4165),R=a(4838);let F=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("textarea",{className:(0,n.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...s})});F.displayName="Textarea";var D=a(6671),U=a(3297);function G(e){let{task:t,level:a,addSubtask:i,aiBreakdown:l,setActiveTab:o}=e,{toggleTaskStatus:d,toggleCollapsed:p,updateTask:m,deleteTask:g,apiKey:v,aiProvider:k,recentlyAddedTaskIds:G,setRecentlyAddedTaskIds:O,setActiveChatTask:B,undoLastDeletion:z,exportTaskAsPlainText:L}=(0,h.r)(),[$,_]=(0,s.useState)(!1),[M,K]=(0,s.useState)(t.title),[J,H]=(0,s.useState)(!1),[q,V]=(0,s.useState)(""),[Q,Y]=(0,s.useState)(!1),[Z,W]=(0,s.useState)(!1),[X,ee]=(0,s.useState)(""),[et,ea]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(G.includes(t.id)){let e=setTimeout(()=>{O([])},2e3);return()=>clearTimeout(e)}},[G,t.id,O]);let{attributes:er,listeners:es,setNodeRef:en,transform:ei,transition:el,isDragging:eo}=(0,f.gl)({id:t.id}),ed={transform:x.Ks.Transform.toString(ei),transition:el,opacity:eo?.5:1},ec=()=>{M.trim()&&m(t.id,{title:M}),_(!1)},eu=()=>{q.trim()&&(i(t.id,q),V(""),H(!1),t.collapsed&&p(t.id))},eh=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("gemini"===k&&!v)return void D.oR.error("Please add an API key in the settings to use Gemini AI features.");try{Y(!0),W(!1);let a=e?X.trim():void 0;if(l)await l(t.id,t.title,a);else try{let e=a?"".concat(t.title," (Context: ").concat(a,")"):t.title,r=await (0,P.s$)(e,v,k);r&&r.tasks.length>0?(r.tasks.forEach(e=>{i(t.id,e.title)}),D.oR.success('Generated new subtasks for "'.concat(t.title,'".'))):D.oR.info("The AI didn't generate any tasks for \"".concat(t.title,'".'))}catch(e){U.vF.error("AI generation failed:",e),e instanceof Error?D.oR.error(e.message):D.oR.error("An unknown error occurred. Please try again.")}t.collapsed&&p(t.id)}finally{Y(!1)}},ep=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"simple",a=L(t.id,"simple"===e?{includeCompleted:!0,includeStatus:!1,includeBullets:!1}:{includeCompleted:!0,includeStatus:!0,includeBullets:!0});a?navigator.clipboard.writeText(a).then(()=>{D.oR.success('Task "'.concat(t.title,'" exported as ').concat("simple"===e?"simple text":"detailed format"," to clipboard!"))}).catch(()=>{let r=new Blob([a],{type:"text/plain"}),s=URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download="".concat(t.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()).concat("simple"===e?"_simple":"_detailed",".txt"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s),D.oR.success('Task "'.concat(t.title,'" exported as ').concat("simple"===e?"simple text":"detailed format"," file!"))}):D.oR.error("Failed to export task")},em=t.children.length>0,ef="completed"===t.status,eg=24*a;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.lG,{open:Z,onOpenChange:W,children:(0,r.jsxs)(S.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(S.c7,{children:[(0,r.jsx)(S.L3,{children:"Add Context for AI"}),(0,r.jsxs)(S.rr,{children:['Provide any additional context for "',t.title,'" to help the AI generate more relevant tasks. This is optional.']})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsx)(F,{placeholder:"e.g., This is for a personal fitness plan\nI prefer home workouts and have limited equipment...\n2 levels with 3 tasks each",className:"min-h-[100px]",value:X,onChange:e=>ee(e.target.value)})}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(c.$,{variant:"outline",onClick:()=>ee(e=>e.includes("Use multiple levels")?e:e+"\nUse multiple levels if necessary — up to N levels deep with 2–4 branches per level."),children:"Multi level and branches"})}),(0,r.jsxs)(S.Es,{children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>eh(!1),disabled:Q,children:"Skip Context"}),(0,r.jsx)(c.$,{onClick:()=>eh(!0),disabled:Q,children:"Use Context"})]})]})}),(0,r.jsx)(S.lG,{open:et,onOpenChange:ea,children:(0,r.jsxs)(S.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(S.c7,{children:[(0,r.jsx)(S.L3,{children:"Delete Task"}),(0,r.jsxs)(S.rr,{children:['Are you sure you want to delete "',t.title,'"?',t.children.length>0&&(0,r.jsxs)("span",{className:"text-destructive block mt-2",children:["This will also delete all ",t.children.length," subtask",t.children.length>1?"s":"","."]}),(0,r.jsx)("span",{className:"block mt-2",children:"This action can be undone within 5 seconds."})]})]}),(0,r.jsxs)(S.Es,{children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>ea(!1),children:"Cancel"}),(0,r.jsx)(c.$,{variant:"destructive",onClick:()=>{g(t.id),ea(!1),(0,D.oR)('Task "'.concat(t.title,'" deleted.'),{action:{label:"Undo",onClick:()=>z()},duration:5e3})},children:"Delete"})]})]})}),(0,r.jsxs)("div",{ref:en,style:ed,className:(0,n.cn)("group relative mb-1 rounded-md",eo&&"z-10",G.includes(t.id)&&"bg-yellow-100 dark:bg-yellow-900/50 animate-pulse"),children:[(0,r.jsxs)("div",{className:(0,n.cn)("flex items-center gap-2 rounded-md border p-2 transition-colors hover:bg-muted/40",ef&&"bg-muted/30",0===a&&"bg-blue-100 dark:bg-blue-900/50"),style:{paddingLeft:"".concat(eg+8,"px")},children:[(0,r.jsx)("button",{className:"cursor-grab opacity-0 group-hover:opacity-100 focus:opacity-100",...er,...es,children:(0,r.jsx)(b.A,{className:"h-4 w-4 text-muted-foreground"})}),em?(0,r.jsx)("button",{onClick:()=>{p(t.id)},className:"flex h-5 w-5 items-center justify-center rounded-sm hover:bg-muted",children:t.collapsed?(0,r.jsx)(j.A,{className:"h-4 w-4"}):(0,r.jsx)(A.A,{className:"h-4 w-4"})}):(0,r.jsx)("div",{className:"w-5"}),(0,r.jsx)(y,{id:"task-".concat(t.id),checked:ef,onCheckedChange:()=>{d(t.id)}}),$?(0,r.jsxs)("div",{className:"flex flex-1 items-center gap-2",children:[(0,r.jsx)(u.p,{value:M,onChange:e=>K(e.target.value),onKeyDown:e=>{"Enter"===e.key?ec():"Escape"===e.key&&_(!1)},className:"flex-1",autoFocus:!0}),(0,r.jsx)(c.$,{size:"sm",onClick:ec,children:"Save"}),(0,r.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>_(!1),children:"Cancel"})]}):(0,r.jsx)("label",{htmlFor:"task-".concat(t.id),className:(0,n.cn)("flex-1 cursor-pointer select-none",ef&&"text-muted-foreground line-through"),children:t.title}),!$&&(0,r.jsxs)("div",{className:"flex gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{_(!0),K(t.title)},title:"Edit",children:(0,r.jsx)(N.A,{className:"h-4 w-4"})}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>H(!0),title:"Add subtask",children:(0,r.jsx)(T.A,{className:"h-4 w-4"})}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{B(t),o("chat")},title:"Start Chat",children:(0,r.jsx)(w.ywh,{className:"h-4 w-4"})}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{if("gemini"===k&&!v)return void D.oR.error("Please add an API key in the settings to use Gemini AI features.");ee(""),W(!0)},disabled:Q||"gemini"===k&&!v,title:"AI breakdown",children:(0,r.jsx)(E.A,{className:(0,n.cn)("h-4 w-4",Q&&"animate-pulse")})}),(0,r.jsxs)(R.rI,{children:[(0,r.jsx)(R.ty,{asChild:!0,children:(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Export options",children:(0,r.jsx)(C.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(R.SQ,{align:"end",children:[(0,r.jsx)(R._2,{onClick:()=>ep("simple"),children:"Simple text (indented only)"}),(0,r.jsx)(R._2,{onClick:()=>ep("detailed"),children:"Detailed (with bullets & status)"})]})]}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:bg-destructive/10",onClick:()=>{ea(!0)},title:"Delete",children:(0,r.jsx)(I.A,{className:"h-4 w-4"})})]})]}),J&&(0,r.jsxs)("div",{className:"ml-14 mt-1 flex items-center gap-2 rounded-md border p-2",style:{marginLeft:"".concat(eg+56,"px")},children:[(0,r.jsx)(u.p,{placeholder:"Enter subtask name...",value:q,onChange:e=>V(e.target.value),onKeyDown:e=>{"Enter"===e.key?eu():"Escape"===e.key&&H(!1)},className:"flex-1",autoFocus:!0}),(0,r.jsx)(c.$,{size:"sm",onClick:eu,children:"Add"}),(0,r.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>H(!1),children:"Cancel"})]})]})]})}var O=a(172);function B(e){let{setActiveTab:t}=e,{tasks:a,addSubtask:n,reorderTasks:i,breakdownTaskWithAI:l,findTask:o,clearLastBreakdown:d,setRecentlyAddedTaskIds:c,scrollToTaskId:u,setScrollToTaskId:p}=(0,h.r)(),[x,v]=(0,s.useState)(null),[k,y]=(0,s.useState)(!1),w=(0,s.useRef)({});(0,s.useEffect)(()=>{if(u){let e=w.current[u];e&&(e.scrollIntoView({behavior:"auto",block:"center"}),p(null))}},[u,p]);let b=(0,m.FR)((0,m.MS)(m.AN,{activationConstraint:{distance:8}})),j=async(e,t,a)=>{y(!0);let r=await l(e,a);r.success?D.oR.success(r.message):D.oR.error(r.message),y(!1)},A=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map(e=>(0,r.jsxs)("div",{style:{marginTop:0===a?"2rem":0},ref:t=>{t&&(w.current[e.id]=t)},children:[(0,r.jsx)(G,{task:e,level:a,addSubtask:(e,t)=>{"string"==typeof t?n(e,{title:t,status:"pending"}):n(e,t)},aiBreakdown:j,setActiveTab:t}),!e.collapsed&&e.children.length>0&&(0,r.jsx)("div",{children:(0,r.jsx)(f.gB,{items:e.children.map(e=>e.id),strategy:f._G,children:A(e.children,a+1)})})]},e.id))},N=x?o(x):null,T=a.map(e=>e.id);return(0,r.jsxs)(r.Fragment,{children:[k&&(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-background/80 z-50",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 p-4 rounded-md bg-card border shadow-md",children:[(0,r.jsx)(O.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{children:"Generating tasks with AI..."})]})}),(0,r.jsxs)(m.Mp,{sensors:b,collisionDetection:m.fp,onDragStart:e=>{v(e.active.id)},onDragOver:e=>{let{active:t,over:a}=e;if(!a||t.id===a.id)return;let r=t.id,s=a.id,n=o(r),i=o(s);if(!n||!i)return;let l=(e,t)=>e.id===t||e.children.some(e=>l(e,t));if(l(n,s))return},onDragEnd:e=>{v(null);let{active:t,over:r}=e;if(r){if(t.id!==r.id){let e=t.id,s=r.id,n=o(e),l=o(s);if(!n||!l)return;let d=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(let r=0;r<t.length;r++){if(t[r].id===e)return{parent:a,index:r};if(t[r].children.length>0){let a=d(e,t[r].children,t[r]);if(null!==a.parent)return a}}return{parent:null,index:-1}},{parent:c,index:u}=d(e,a),{parent:h,index:p}=d(s,a);if(c===h)if(null===c)i((0,f.be)(a,u,p));else{let e=(0,f.be)(c.children,u,p),t=(e,a,r)=>e.map(e=>e.id===a?{...e,children:r}:e.children&&e.children.length>0?{...e,children:t(e.children,a,r)}:e);i(t(a,c.id,e))}}d()}},modifiers:[g.FN],children:[(0,r.jsx)("div",{className:"space-y-1",children:0===a.length?(0,r.jsx)("div",{className:"rounded-md border border-dashed p-6 text-center text-muted-foreground",children:"No tasks yet. Create your first task below."}):(0,r.jsx)(f.gB,{items:T,strategy:f._G,children:A(a)})}),(0,r.jsx)(m.Hd,{children:x&&N&&(0,r.jsx)("div",{className:"w-full opacity-70",children:(0,r.jsx)(G,{task:N,level:0,addSubtask:()=>{}})})})]})]})}var z=a(7313),L=a(8240),$=a(4823);function _(e){let{setActiveTab:t}=e,[a,n]=(0,s.useState)(""),[u,p]=(0,s.useState)(!1),[m,f]=(0,s.useState)(!1),[g,x]=(0,s.useState)(!1),[v,k]=(0,s.useState)(""),y=(0,h.r)(e=>e.apiKey),w=(0,h.r)(e=>e.aiProvider),b=(0,h.r)(e=>e.activeChatTask);(0,h.r)(e=>e.setActiveChatTask);let j=(0,h.r)(e=>e.getMainTask),A=(0,h.r)(e=>e.getTaskBreadcrumb);(0,h.r)(e=>e.findTask);let N=(0,h.r)(e=>e.chatConversations),T=(0,h.r)(e=>e.setChatConversation),E=(0,h.r)(e=>e.setScrollToTaskId),{breakdownTaskWithAI:C}=(0,h.r)(),I=(0,s.useRef)(null),R=()=>{var e;null==(e=I.current)||e.scrollIntoView({behavior:"auto"})},G=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a="  ".repeat(t),r="".concat(a,"- ").concat(e.title).concat("completed"===e.status?" ✓":"","\n");for(let a of e.children||[])r+=G(a,t+1);return r};(0,s.useEffect)(()=>{R()},[N,b]);let B=async()=>{if(a.trim()&&b){let e=j(b);if(!e)return;let t=[...N[e.id]||[],{text:a,role:"user"}];T(e.id,t),n(""),p(!0);let r=A(b.id),s=j(b),i=s?G(s):"",l=[{role:"user",parts:[{text:"[CONTEXT FOR AI: You are helping with task planning. Current task hierarchy:\n\n".concat(r?"Current Position: ".concat(r):"Current Task: ".concat(b.title),'\nCurrent Focus: "').concat(b.title,'"\n\nComplete Task Structure:\n').concat(i,"\n\nPlease provide advice relevant to the current task while being aware of existing subtasks to avoid duplication. Tasks marked with ✓ are completed.]")}]},...t.map(e=>({role:e.role,parts:[{text:e.text}]}))];try{let r=await (0,P.zv)(a,y,l,w);r&&T(e.id,[...t,{text:r,role:"model"}])}catch(a){U.vF.error("Error chatting with AI:",a),T(e.id,[...t,{text:"Error: Could not connect to the AI.",role:"model"}])}finally{p(!1)}}},z=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!b)return;f(!0),x(!1);let a=e?v.trim():void 0,r=await C(b.id,a);r.success?(D.oR.success(r.message),t("tasks"),E(b.id)):D.oR.error(r.message),f(!1)},_=b?j(b):null,M=_&&N[_.id]||[];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.lG,{open:g,onOpenChange:x,children:(0,r.jsxs)(S.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(S.c7,{children:[(0,r.jsx)(S.L3,{children:"Add Context for AI"}),(0,r.jsxs)(S.rr,{children:['Provide any additional context for "',null==_?void 0:_.title,'" to help the AI generate more relevant tasks. This is optional.']})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsx)(F,{placeholder:"e.g., This is for a personal fitness plan\nI prefer home workouts and have limited equipment...\n2 levels with 3 tasks each",className:"min-h-[100px]",value:v,onChange:e=>k(e.target.value)})}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)(c.$,{variant:"outline",onClick:()=>k(e=>e.includes("Use multiple levels")?e:e+"\nUse multiple levels if necessary — up to N levels deep with 2–4 branches per level."),children:"Multi level and branches"})}),(0,r.jsxs)(S.Es,{children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>z(!1),disabled:m,children:"Skip Context"}),(0,r.jsx)(c.$,{onClick:()=>z(!0),disabled:m,children:"Use Context"})]})]})}),(0,r.jsxs)(i,{children:[(0,r.jsxs)(l,{className:"flex flex-row items-center justify-between",children:[(0,r.jsxs)(o,{className:"space-y-2",children:[(0,r.jsx)("div",{children:b?"Let's talk about the task: \"".concat(b.title,'". What would you like to discuss?'):"Chat with AI"}),b&&_&&b.id!==_.id&&(0,r.jsxs)("div",{className:"text-sm font-normal text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-blue-500",children:"ℹ️"}),'This conversation includes context from "',_.title,'"']})]}),b&&(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(c.$,{variant:"outline",onClick:()=>{if("gemini"===w&&!y)return void D.oR.error("Please add an API key in the settings to use Gemini AI features.");k(""),x(!0)},disabled:m,children:[m?(0,r.jsx)(O.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Breakdown Task"]}),(0,r.jsx)(c.$,{variant:"outline",onClick:()=>{if(b){let e=j(b);e&&T(e.id,[])}},children:"Clear Context"})]})]}),(0,r.jsxs)(d,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"h-96 overflow-y-auto rounded-md border p-4 space-y-2",children:[M.map((e,t)=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,r.jsx)("div",{className:"rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-primary text-primary-foreground":"bg-muted"),children:"user"===e.role?e.text:(0,r.jsx)(L.oz,{remarkPlugins:[$.A],children:e.text})})},t)),u&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("div",{className:"rounded-lg px-4 py-2 bg-muted",children:(0,r.jsxs)("div",{className:"typing-indicator",children:[(0,r.jsx)("span",{}),(0,r.jsx)("span",{}),(0,r.jsx)("span",{})]})})}),(0,r.jsx)("div",{ref:I})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(F,{value:a,onChange:e=>n(e.target.value),placeholder:"Type your message... (use Ctrl+Enter or Cmd+Enter to send)",onKeyDown:e=>{(e.ctrlKey||e.metaKey)&&"Enter"===e.key&&B()}}),(0,r.jsx)(c.$,{onClick:B,children:"Send"})]})]})]})]})}function M(e){let{activeTab:t,setActiveTab:a}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z.av,{value:"tasks",style:{display:"tasks"===t?"block":"none"},children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(B,{setActiveTab:a}),(0,r.jsxs)(i,{children:[(0,r.jsx)(l,{children:(0,r.jsx)(o,{children:"Add a New Goal"})}),(0,r.jsx)(d,{children:(0,r.jsx)(p,{})})]})]})}),(0,r.jsx)(z.av,{value:"chat",style:{display:"chat"===t?"block":"none"},children:(0,r.jsx)(_,{setActiveTab:a})})]})}a(7528)},9434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var r=a(2596),s=a(9688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}}}]);